import * as $rjs_core from '../../runtime/core.js';import * as M0 from "./private/kw.rkt.js";import * as M1 from "../../runtime/paramz.rkt.js";import * as M2 from "./private/list.rkt.js";import * as M3 from "./private/map.rkt.js";import * as M4 from "./private/member.rkt.js";import * as M5 from "../../runtime/kernel.rkt.js";import * as M6 from "./private/more-scheme.rkt.js";import * as M7 from "./private/path.rkt.js";import * as M8 from "./private/reverse.rkt.js";import * as M9 from "./private/for.rkt.js";import * as M10 from "../../runtime/unsafe.rkt.js";var simple_form_path = function(p2076) {if (M7.path_string_p(p2076)) {var if_res1086 = M5.rvoid();} else {var if_res1086 = M5.raise_argument_error($rjs_core.Symbol.make("simple-form-path"),"path-string?",p2076);}if_res1086;return M5.simplify_path(M5.path__gt_complete_path(p2076));};var resolve_all2077 = function(path2082, wrt2083) {if (wrt2083) {var if_res1087 = M5.not(M5.complete_path_p(path2082));} else {var if_res1087 = false;}if (if_res1087) {var if_res1088 = M5.path__gt_complete_path(path2082,wrt2083);} else {var if_res1088 = path2082;}var orig_path2084 = if_res1088;var loop2085 = function(full_path2086, seen_paths2087) {var resolved2088 = M5.resolve_path(full_path2086);if (M5.equal_p(resolved2088,full_path2086)) {var if_res1092 = do_normalize_path2081(resolved2088,false);} else {if (M5.relative_path_p(resolved2088)) {var let_result1089 = M5.split_path(full_path2086);var base2090 = let_result1089.getAt(0);var name2091 = let_result1089.getAt(1);var dir_p2092 = let_result1089.getAt(2);var if_res1090 = M5.build_path(base2090,resolved2088);} else {var if_res1090 = resolved2088;}var path2089 = if_res1090;if (M4.member(path2089,seen_paths2087)) {var if_res1091 = M5.error($rjs_core.Symbol.make("normalize-path"),"circular reference found\n  path: ~a",path2089);} else {var with_handlers_predicate82094 = M5.exn_fail_filesystem_p;var with_handlers_handler92095 = function(x2096) {return M5.error($rjs_core.Symbol.make("normalize-path"),"circular reference found\n  path: ~a",path2089);};var bpz2097 = M5.continuation_mark_set_first(false,M1.__rjs_quoted__.break_enabled_key);var spath2093 = M6.__rjs_quoted__.call_handled_body(bpz2097,function(e2098) {return M6.__rjs_quoted__.select_handler_by_no_breaks(e2098,bpz2097,M5.list(M5.cons(with_handlers_predicate82094,with_handlers_handler92095)));},function() {return M5.simplify_path(path2089);});var if_res1091 = loop2085(spath2093,M5.cons(path2089,seen_paths2087));}var if_res1092 = if_res1091;}return if_res1092;};return loop2085(orig_path2084,M5.list(orig_path2084));};var resolve2078 = function(path2099) {if (M5.equal_p(path2099,M5.resolve_path(path2099))) {var if_res1093 = path2099;} else {var if_res1093 = resolve_all2077(path2099,false);}return if_res1093;};var cl1094 = function(orig_path2100) {return do_normalize_path2081(orig_path2100,M5.current_directory());};var cl1095 = function(orig_path2101, wrt2102) {if (M7.path_string_p(wrt2102)) {var if_res1097 = M5.complete_path_p(wrt2102);} else {var if_res1097 = false;}if (if_res1097) {var if_res1098 = M5.rvoid();} else {var if_res1098 = M5.raise_argument_error($rjs_core.Symbol.make("normalize-path"),"(and/c path-string? complete-path?)",wrt2102);}if_res1098;return do_normalize_path2081(orig_path2101,wrt2102);};var normalize_path2079 = $rjs_core.attachProcedureArity(function() {var fixed_lam1096 = {'1':cl1094,'2':cl1095}[arguments.length];if (fixed_lam1096!==undefined) {return fixed_lam1096.apply(null,arguments);} else {return M5.error("case-lambda: invalid case");}},[1,2]);var error_not_a_dir2080 = function(path2103) {return M5.error($rjs_core.Symbol.make("normalize-path"),"element within the input path is not a directory or does not exist\n  element: ~a",path2103);};var do_normalize_path2081 = function(orig_path2104, wrt2105) {var normalize2106 = function(path2107) {var let_result1099 = M5.split_path(path2107);var base2108 = let_result1099.getAt(0);var name2109 = let_result1099.getAt(1);var dir_p2110 = let_result1099.getAt(2);if (M5.eq_p(name2109,$rjs_core.Symbol.make("up"))) {var up2111 = function(base2112) {if (M5.directory_exists_p(base2112)) {var let_result1101 = M5.split_path(base2112);var prev2113 = let_result1101.getAt(0);var name2114 = let_result1101.getAt(1);var dir_p2115 = let_result1101.getAt(2);if (M5.not(prev2113)) {var if_res1105 = M5.error($rjs_core.Symbol.make("normalize-path"),"root has no parent directory\n  root path: ~a",orig_path2104);} else {if (M5.eq_p(prev2113,$rjs_core.Symbol.make("relative"))) {var if_res1102 = wrt2105;} else {var if_res1102 = normalize2106(prev2113);}var prev2116 = if_res1102;if (M5.eq_p(name2114,$rjs_core.Symbol.make("same"))) {var if_res1104 = up2111(prev2116);} else {if (M5.eq_p(name2114,$rjs_core.Symbol.make("up"))) {var if_res1103 = up2111(up2111(prev2116));} else {var if_res1103 = prev2116;}var if_res1104 = if_res1103;}var if_res1105 = if_res1104;}var if_res1106 = if_res1105;} else {var if_res1106 = error_not_a_dir2080(base2112);}return if_res1106;};if (M5.eq_p(base2108,$rjs_core.Symbol.make("relative"))) {var if_res1100 = wrt2105;} else {var if_res1100 = resolve_all2077(base2108,wrt2105);}var if_res1115 = up2111(if_res1100);} else {if (M5.eq_p(name2109,$rjs_core.Symbol.make("same"))) {if (M5.eq_p(base2108,$rjs_core.Symbol.make("relative"))) {var if_res1108 = wrt2105;} else {var n2117 = normalize2106(base2108);if (M5.directory_exists_p(n2117)) {var if_res1107 = n2117;} else {var if_res1107 = error_not_a_dir2080(n2117);}var if_res1108 = if_res1107;}var if_res1114 = if_res1108;} else {if (M5.not(base2108)) {var if_res1113 = M5.path__gt_complete_path(path2107);} else {if (M5.eq_p(base2108,$rjs_core.Symbol.make("relative"))) {var if_res1109 = normalize2106(wrt2105);} else {var if_res1109 = normalize2106(base2108);}var base2118 = if_res1109;if (M5.directory_exists_p(base2118)) {var if_res1110 = M5.build_path(base2118,name2109);} else {var if_res1110 = error_not_a_dir2080(base2118);}var path2119 = if_res1110;var resolved2120 = M5.cleanse_path(resolve2078(path2119));if (M5.relative_path_p(resolved2120)) {var if_res1112 = normalize2106(M5.build_path(base2118,resolved2120));} else {if (M5.complete_path_p(resolved2120)) {var if_res1111 = resolved2120;} else {var if_res1111 = M5.path__gt_complete_path(resolved2120,base2118);}var if_res1112 = if_res1111;}var if_res1113 = if_res1112;}var if_res1114 = if_res1113;}var if_res1115 = if_res1114;}return if_res1115;};return normalize2106(M5.cleanse_path(orig_path2104));};var normalize_path = normalize_path2079;var do_explode_path = function(who2121, orig_path2122) {var l2123 = M5.explode_path(orig_path2122);var lst2124 = l2123;if (M5.list_p(lst2124)) {var if_res1116 = M5.rvoid();} else {var if_res1116 = M9.__rjs_quoted__.in_list(lst2124);}if_res1116;var for_loop2125 = function(fold_var2126, lst2127) {if (M5.pair_p(lst2127)) {var p2128 = M10.unsafe_car(lst2127);if (true) {var fold_var2130 = fold_var2126;if (M5.not(M5.path_for_some_system_p(p2128))) {var if_res1117 = M5.raise_argument_error(who2121,"(and/c path-for-some-system? simple-form?)",orig_path2122);} else {var if_res1117 = M5.rvoid();}if_res1117;var fold_var2131 = M5.rvoid();var fold_var2129 = M5.values(fold_var2131);if (true) {var if_res1118 = for_loop2125(fold_var2129,M10.unsafe_cdr(lst2127));} else {var if_res1118 = fold_var2129;}var if_res1119 = if_res1118;} else {var if_res1119 = fold_var2126;}var if_res1120 = if_res1119;} else {var if_res1120 = fold_var2126;}return if_res1120;};for_loop2125(M5.rvoid(),lst2124);return l2123;};var find_relative_path5 = function(more_than_root_p12132, more_than_root_p22133, directory32134, filename42135) {var directory2136 = directory32134;var filename2137 = filename42135;if (more_than_root_p22133) {var if_res1121 = more_than_root_p12132;} else {var if_res1121 = false;}var more_than_root_p2138 = if_res1121;var dir2139 = do_explode_path($rjs_core.Symbol.make("find-relative-path"),directory2136);var file2140 = do_explode_path($rjs_core.Symbol.make("find-relative-path"),filename2137);if (M5.equal_p(M5.car(dir2139),M5.car(file2140))) {var or_part2141 = M5.not(more_than_root_p2138);if (or_part2141) {var if_res1125 = or_part2141;} else {var or_part2142 = M5.not(M5.eq_p($rjs_core.Symbol.make("unix"),M5.path_convention_type(directory2136)));if (or_part2142) {var if_res1124 = or_part2142;} else {var or_part2143 = M5.null_p(M5.cdr(dir2139));if (or_part2143) {var if_res1123 = or_part2143;} else {var or_part2144 = M5.null_p(M5.cdr(file2140));if (or_part2144) {var if_res1122 = or_part2144;} else {var if_res1122 = M5.equal_p(M5.cadr(dir2139),M5.cadr(file2140));}var if_res1123 = if_res1122;}var if_res1124 = if_res1123;}var if_res1125 = if_res1124;}var if_res1126 = if_res1125;} else {var if_res1126 = false;}if (if_res1126) {var loop2145 = function(dir2146, file2147) {if (M5.null_p(dir2146)) {if (M5.null_p(file2147)) {var if_res1127 = filename2137;} else {var if_res1127 = M5.apply(M5.build_path,file2147);}var if_res1131 = if_res1127;} else {if (M5.null_p(file2147)) {if (M5.string_p(filename2137)) {var if_res1128 = M5.system_path_convention_type();} else {var if_res1128 = M5.path_convention_type(filename2137);}var if_res1130 = M5.apply(M5.build_path_by_convention_type,if_res1128,M3.map(function(x2148) {return $rjs_core.Symbol.make("up");},dir2146));} else {if (M5.equal_p(M5.car(dir2146),M5.car(file2147))) {var if_res1129 = loop2145(M5.cdr(dir2146),M5.cdr(file2147));} else {var if_res1129 = M5.apply(M5.build_path,M5.append(M3.map(function(x2149) {return $rjs_core.Symbol.make("up");},dir2146),file2147));}var if_res1130 = if_res1129;}var if_res1131 = if_res1130;}return if_res1131;};var if_res1132 = loop2145(M5.cdr(dir2139),M5.cdr(file2140));} else {var if_res1132 = filename2137;}return if_res1132;};var unpack6 = function(given_kws2150, given_args2151, directory32152, filename42153) {var more_than_root_p22154 = M5.pair_p(given_kws2150);if (more_than_root_p22154) {var if_res1133 = M5.car(given_args2151);} else {var if_res1133 = M5.rvoid();}var more_than_root_p12155 = if_res1133;return find_relative_path5(more_than_root_p12155,more_than_root_p22154,directory32152,filename42153);};var cl1136 = function(given_kws2160, given_args2161, directory2162, filename2163) {return unpack6(given_kws2160,given_args2161,directory2162,filename2163);};var temp1138 = $rjs_core.attachProcedureArity(function() {var fixed_lam1137 = {'4':cl1136}[arguments.length];if (fixed_lam1137!==undefined) {return fixed_lam1137.apply(null,arguments);} else {return M5.error("case-lambda: invalid case");}},[4]);var cl1134 = function(directory2165, filename2166) {return unpack6(M5.rnull,M5.rnull,directory2165,filename2166);};var find_relative_path2164 = $rjs_core.attachProcedureArity(function() {var fixed_lam1135 = {'2':cl1134}[arguments.length];if (fixed_lam1135!==undefined) {return fixed_lam1135.apply(null,arguments);} else {return M5.error("case-lambda: invalid case");}},[2]);var find_relative_path7 = M0.__rjs_quoted__.make_optional_keyword_procedure(function(given_kws2156, given_argc2157) {if (M5._eq_(given_argc2157,4)) {var l12158 = given_kws2156;if (M5.null_p(l12158)) {var if_res1140 = l12158;} else {if (M5.eq_p(M5.car(l12158),$rjs_core.Keyword.make('#:more-than-root?'))) {var if_res1139 = M5.cdr(l12158);} else {var if_res1139 = l12158;}var if_res1140 = if_res1139;}var l12159 = if_res1140;var if_res1141 = M5.null_p(l12159);} else {var if_res1141 = false;}return if_res1141;},temp1138,M5.rnull,$rjs_core.Pair.makeList($rjs_core.Keyword.make('#:more-than-root?')),find_relative_path2164);var file_name = function(who2167, name2168, dir_ok_p2169) {var or_part2170 = M7.path_string_p(name2168);if (or_part2170) {var if_res1142 = or_part2170;} else {var if_res1142 = M5.path_for_some_system_p(name2168);}if (if_res1142) {var if_res1143 = M5.rvoid();} else {var if_res1143 = M5.raise_argument_error(who2167,"(or/c path-string? path-for-some-system?)",name2168);}if_res1143;var let_result1144 = M5.split_path(name2168);var base2171 = let_result1144.getAt(0);var file2172 = let_result1144.getAt(1);var dir_p2173 = let_result1144.getAt(2);var or_part2174 = dir_ok_p2169;if (or_part2174) {var if_res1145 = or_part2174;} else {var if_res1145 = M5.not(dir_p2173);}if (if_res1145) {if (M5.path_for_some_system_p(file2172)) {var if_res1146 = file2172;} else {var if_res1146 = false;}var if_res1147 = if_res1146;} else {var if_res1147 = false;}return if_res1147;};var file_name_from_path = function(name2175) {return file_name($rjs_core.Symbol.make("file-name-from-path"),name2175,false);};var path_only = function(name2176) {var or_part2177 = M7.path_string_p(name2176);if (or_part2177) {var if_res1148 = or_part2177;} else {var if_res1148 = M5.path_for_some_system_p(name2176);}if (if_res1148) {var if_res1149 = M5.rvoid();} else {var if_res1149 = M5.raise_argument_error($rjs_core.Symbol.make("path-only"),"(or/c path-string? path-for-some-system?)",name2176);}if_res1149;var let_result1150 = M5.split_path(name2176);var base2178 = let_result1150.getAt(0);var file2179 = let_result1150.getAt(1);var dir_p2180 = let_result1150.getAt(2);if (dir_p2180) {if (M5.string_p(name2176)) {var if_res1151 = M5.string__gt_path(name2176);} else {var if_res1151 = name2176;}var if_res1153 = if_res1151;} else {if (M5.path_for_some_system_p(base2178)) {var if_res1152 = base2178;} else {var if_res1152 = false;}var if_res1153 = if_res1152;}return if_res1153;};var path_has_extension_p = function(name2181, sfx2182) {if (M7.path_string_p(name2181)) {var if_res1154 = M5.rvoid();} else {var if_res1154 = M5.raise_argument_error($rjs_core.Symbol.make("path-extension=?"),"path-string?",name2181);}if_res1154;var or_part2183 = M5.bytes_p(sfx2182);if (or_part2183) {var if_res1155 = or_part2183;} else {var if_res1155 = M5.string_p(sfx2182);}if (if_res1155) {var if_res1156 = M5.rvoid();} else {var if_res1156 = M5.raise_argument_error($rjs_core.Symbol.make("path-extension=?"),"(or/c bytes? string?)",name2181);}if_res1156;var let_result1157 = M5.split_path(name2181);var base2184 = let_result1157.getAt(0);var file2185 = let_result1157.getAt(1);var dir_p2186 = let_result1157.getAt(2);if (base2184) {if (M5.path_p(file2185)) {var bs2187 = M5.path_element__gt_bytes(file2185);if (M5.bytes_p(sfx2182)) {var if_res1158 = sfx2182;} else {var if_res1158 = M5.string__gt_bytes_by_utf_8(sfx2182);}var sfx2188 = if_res1158;var len2189 = M5.bytes_length(bs2187);var slen2190 = M5.bytes_length(sfx2188);if (M5._gt_(len2189,slen2190)) {var if_res1159 = M5.bytes_eq__p(sfx2188,M5.subbytes(bs2187,len2189-slen2190));} else {var if_res1159 = false;}var if_res1160 = if_res1159;} else {var if_res1160 = false;}var if_res1161 = if_res1160;} else {var if_res1161 = false;}return if_res1161;};var path_get_extension = function(name2191) {var name2192 = file_name($rjs_core.Symbol.make("path-get-extension"),name2191,true);if (name2192) {var if_res1162 = M5.path__gt_bytes(name2192);} else {var if_res1162 = false;}var name2193 = if_res1162;if (name2193) {var if_res1163 = M5.regexp_match("/(?<=.)([.][^.]+)$/",name2193);} else {var if_res1163 = false;}var c303012194 = if_res1163;if (c303012194) {var if_res1164 = M5.cadr(c303012194);} else {var if_res1164 = false;}return if_res1164;};var filename_extension = function(name2195) {var name2196 = file_name($rjs_core.Symbol.make("filename-extension"),name2195,false);if (name2196) {var if_res1165 = M5.path__gt_bytes(name2196);} else {var if_res1165 = false;}var name2197 = if_res1165;if (name2197) {var if_res1166 = M5.regexp_match("/[.]([^.]+)$/",name2197);} else {var if_res1166 = false;}var c303102198 = if_res1166;if (c303102198) {var if_res1167 = M5.cadr(c303102198);} else {var if_res1167 = false;}return if_res1167;};var some_system_path__gt_string = function(path2199) {if (M5.path_for_some_system_p(path2199)) {var if_res1168 = M5.rvoid();} else {var if_res1168 = M5.raise_argument_error($rjs_core.Symbol.make("some-system-path->string"),"path-for-some-system?",path2199);}if_res1168;return M5.bytes__gt_string_by_utf_8(M5.path__gt_bytes(path2199));};var string__gt_some_system_path = function(path2200, kind2201) {if (M5.string_p(path2200)) {var if_res1169 = M5.rvoid();} else {var if_res1169 = M5.raise_argument_error($rjs_core.Symbol.make("string->some-system-path"),"string?",path2200);}if_res1169;var or_part2202 = M5.eq_p(kind2201,$rjs_core.Symbol.make("unix"));if (or_part2202) {var if_res1170 = or_part2202;} else {var if_res1170 = M5.eq_p(kind2201,$rjs_core.Symbol.make("windows"));}if (if_res1170) {var if_res1171 = M5.rvoid();} else {var if_res1171 = M5.raise_argument_error($rjs_core.Symbol.make("string->some-system-path"),"(or/c 'unix 'windows)",kind2201);}if_res1171;return M5.bytes__gt_path(M5.string__gt_bytes_by_utf_8(path2200),kind2201);};var path_element_p = function(path2203) {if (M5.path_for_some_system_p(path2203)) {var let_result1172 = M5.split_path(path2203);var base2204 = let_result1172.getAt(0);var name2205 = let_result1172.getAt(1);var d_p2206 = let_result1172.getAt(2);if (M5.eq_p(base2204,$rjs_core.Symbol.make("relative"))) {var if_res1173 = M5.path_for_some_system_p(name2205);} else {var if_res1173 = false;}var if_res1174 = if_res1173;} else {var if_res1174 = false;}return if_res1174;};var shrink_path_wrt = function(fn2207, other_fns2208) {if (M5.path_p(fn2207)) {var if_res1175 = M5.rvoid();} else {var if_res1175 = M5.raise_argument_error($rjs_core.Symbol.make("shrink-path-wrt"),"path?",0,fn2207,other_fns2208);}if_res1175;var let_result1176 = M5.values();if (M5.list_p(other_fns2208)) {var if_res1177 = M3.andmap(M5.path_p,other_fns2208);} else {var if_res1177 = false;}if (if_res1177) {var if_res1178 = M5.rvoid();} else {var if_res1178 = M5.raise_argument_error($rjs_core.Symbol.make("shrink-path-wrt"),"(listof path?)",1,fn2207,other_fns2208);}if_res1178;var let_result1179 = M5.values();var exp2209 = M8.alt_reverse(M5.explode_path(fn2207));var other_exps2210 = M2.filter(function(x2211) {return M5.not(M5.equal_p(exp2209,x2211));},M3.map(function(fn2212) {return M8.alt_reverse(M5.explode_path(fn2212));},other_fns2208));if (M5.null_p(other_exps2210)) {var if_res1181 = false;} else {var loop2214 = function(other_exps2215, size2216) {if (M5.null_p(other_exps2215)) {var if_res1180 = size2216;} else {var new_size2217 = find_exp_diff(M5.car(other_exps2215),exp2209);var if_res1180 = loop2214(M5.cdr(other_exps2215),M5.max(new_size2217,size2216));}return if_res1180;};var size2213 = loop2214(other_exps2210,1);var if_res1181 = M5.apply(M5.build_path,M8.alt_reverse(take_n(size2213,exp2209)));}return if_res1181;};var take_n = function(n2218, lst2219) {var loop2220 = function(n2221, lst2222) {if (M5.zero_p(n2221)) {var if_res1183 = M5.rnull;} else {if (M5.null_p(lst2222)) {var if_res1182 = M5.rnull;} else {var if_res1182 = M5.cons(M5.car(lst2222),loop2220(n2221-1,M5.cdr(lst2222)));}var if_res1183 = if_res1182;}return if_res1183;};return loop2220(n2218,lst2219);};var find_exp_diff = function(p12223, p22224) {var loop2225 = function(p12226, p22227, i2228) {var or_part2229 = M5.null_p(p12226);if (or_part2229) {var if_res1184 = or_part2229;} else {var if_res1184 = M5.null_p(p22227);}if (if_res1184) {var if_res1186 = i2228;} else {var f12230 = M5.car(p12226);var f22231 = M5.car(p22227);if (M5.equal_p(f12230,f22231)) {var if_res1185 = loop2225(M5.cdr(p12226),M5.cdr(p22227),i2228+1);} else {var if_res1185 = i2228;}var if_res1186 = if_res1185;}return if_res1186;};return loop2225(p12223,p22224,1);};var __rjs_quoted__ = {};__rjs_quoted__.find_relative_path7 = find_relative_path7;__rjs_quoted__.find_relative_path5 = find_relative_path5;export { __rjs_quoted__,shrink_path_wrt,path_element_p,string__gt_some_system_path,some_system_path__gt_string,path_only,file_name_from_path,filename_extension,path_get_extension,path_has_extension_p,normalize_path,simple_form_path };