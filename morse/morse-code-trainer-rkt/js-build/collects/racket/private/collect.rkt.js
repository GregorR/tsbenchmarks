import * as $rjs_core from '../../../runtime/core.js';import * as M0 from "../../../runtime/paramz.rkt.js";import * as M1 from "./reading-param.rkt.js";import * as M2 from "./config.rkt.js";import * as M3 from "../../../runtime/kernel.rkt.js";import * as M4 from "./path.rkt.js";import * as M5 from "./path-list.rkt.js";var _check_relpath = function(who3546, s3547) {if (M4.path_string_p(s3547)) {var if_res2180 = M3.rvoid();} else {var if_res2180 = M3.raise_argument_error(who3546,"path-string?",s3547);}if_res2180;if (M3.__rjs_quoted__.relative_path_p(s3547)) {var if_res2181 = M3.rvoid();} else {var if_res2181 = M3.__rjs_quoted__.raise_arguments_error(who3546,"invalid relative path","path",s3547);}return if_res2181;};var _check_collection = function(who3548, collection3549, collection_path3550) {_check_relpath(who3548,collection3549);return M3.for_each(function(p3551) {return _check_relpath(who3548,p3551);},collection_path3550);};var _check_fail = function(who3552, fail3553) {if (M3.procedure_p(fail3553)) {var if_res2182 = M3.procedure_arity_includes_p(fail3553,1);} else {var if_res2182 = false;}if (if_res2182) {var if_res2183 = M3.rvoid();} else {var if_res2183 = M3.raise_argument_error(who3552,"(any/c . -> . any)",fail3553);}return if_res2183;};var collection_path = function(fail3554, collection3555, collection_path3556) {_check_collection($rjs_core.Symbol.make("collection-path"),collection3555,collection_path3556);_check_fail($rjs_core.Symbol.make("collection-path"),fail3554);return find_col_file(fail3554,collection3555,collection_path3556,false,false);};var collection_file_path = function(fail3557, check_compiled_p3558, file_name3559, collection3560, collection_path3561) {_check_relpath($rjs_core.Symbol.make("collection-file-path"),file_name3559);_check_collection($rjs_core.Symbol.make("collection-file-path"),collection3560,collection_path3561);_check_fail($rjs_core.Symbol.make("collection-file-path"),fail3557);return find_col_file(fail3557,collection3560,collection_path3561,file_name3559,check_compiled_p3558);};var get_config_table = function(d3562) {if (d3562) {var if_res2184 = M3.__rjs_quoted__.build_path(d3562,"config.rktd");} else {var if_res2184 = false;}var p3563 = if_res2184;if (p3563) {if (M3.__rjs_quoted__.file_exists_p(p3563)) {var if_res2186 = M3.__rjs_quoted__.with_input_from_file(p3563,function() {var v3565 = M1.call_with_default_reading_parameterization(M3.__rjs_quoted__.read);if (M3.__rjs_quoted__.hash_p(v3565)) {var if_res2185 = v3565;} else {var if_res2185 = false;}return if_res2185;});} else {var if_res2186 = false;}var if_res2187 = if_res2186;} else {var if_res2187 = false;}var or_part3564 = if_res2187;if (or_part3564) {var if_res2188 = or_part3564;} else {var if_res2188 = $rjs_core.Hash.makeEqual([], false);}return if_res2188;};var get_installation_name = function(config_table3566) {return M3.hash_ref(config_table3566,$rjs_core.Symbol.make("installation-name"),M3.__rjs_quoted__.version());};var coerce_to_path = function(p3567) {if (M3.string_p(p3567)) {var if_res2191 = collects_relative_path__gt_complete_path(M3.__rjs_quoted__.string__gt_path(p3567));} else {if (M3.bytes_p(p3567)) {var if_res2190 = collects_relative_path__gt_complete_path(M3.__rjs_quoted__.bytes__gt_path(p3567));} else {if (M3.__rjs_quoted__.path_p(p3567)) {var if_res2189 = collects_relative_path__gt_complete_path(p3567);} else {var if_res2189 = p3567;}var if_res2190 = if_res2189;}var if_res2191 = if_res2190;}return if_res2191;};var collects_relative_path__gt_complete_path = function(p3568) {if (M3.__rjs_quoted__.complete_path_p(p3568)) {var if_res2193 = p3568;} else {var or_part3569 = M2.find_main_collects();if (or_part3569) {var if_res2192 = or_part3569;} else {var if_res2192 = M3.__rjs_quoted__.current_directory();}var if_res2193 = M3.__rjs_quoted__.path__gt_complete_path(p3568,if_res2192);}return if_res2193;};var add_config_search = function(ht3570, key3571, orig_l3572) {var l3573 = M3.hash_ref(ht3570,key3571,false);if (l3573) {var loop3574 = function(l3575) {if (M3.null_p(l3575)) {var if_res2195 = M3.rnull;} else {if (M3.not(M3.car(l3575))) {var if_res2194 = M3.append(orig_l3572,loop3574(M3.cdr(l3575)));} else {var if_res2194 = M3.cons(coerce_to_path(M3.car(l3575)),loop3574(M3.cdr(l3575)));}var if_res2195 = if_res2194;}return if_res2195;};var if_res2196 = loop3574(l3573);} else {var if_res2196 = orig_l3572;}return if_res2196;};var find_library_collection_links = function() {var ht3576 = get_config_table(M2.find_main_config());var or_part3578 = M3.hash_ref(ht3576,$rjs_core.Symbol.make("links-file"),false);if (or_part3578) {var if_res2198 = or_part3578;} else {var or_part3579 = M3.hash_ref(ht3576,$rjs_core.Symbol.make("share-dir"),false);if (or_part3579) {var if_res2197 = or_part3579;} else {var if_res2197 = M3.__rjs_quoted__.build_path($rjs_core.Symbol.make("up"),"share");}var if_res2198 = M3.__rjs_quoted__.build_path(if_res2197,"links.rktd");}var lf3577 = coerce_to_path(if_res2198);var temp2202 = M3.list(false);if (M3.__rjs_quoted__.use_user_specific_search_paths()) {var if_res2200 = M3.__rjs_quoted__.use_collection_link_paths();} else {var if_res2200 = false;}if (if_res2200) {var if_res2201 = M3.list(M3.__rjs_quoted__.build_path(M3.__rjs_quoted__.find_system_path($rjs_core.Symbol.make("addon-dir")),get_installation_name(ht3576),"links.rktd"));} else {var if_res2201 = M3.rnull;}if (M3.__rjs_quoted__.use_collection_link_paths()) {var if_res2199 = add_config_search(ht3576,$rjs_core.Symbol.make("links-search-files"),M3.list(lf3577));} else {var if_res2199 = M3.rnull;}return M3.append(temp2202,if_res2201,if_res2199);};var links_cache = M3.make_weak_hash();var stamp_prompt_tag = M3.make_continuation_prompt_tag($rjs_core.Symbol.make("stamp"));var file__gt_stamp = function(path3580, old_stamp3581) {if (old_stamp3581) {if (M3.cdr(old_stamp3581)) {var if_res2203 = M3.not(M3.__rjs_quoted__.sync_by_timeout(0,M3.cdr(old_stamp3581)));} else {var if_res2203 = false;}var if_res2204 = if_res2203;} else {var if_res2204 = false;}if (if_res2204) {var if_res2220 = old_stamp3581;} else {var if_res2220 = M3.call_with_continuation_prompt(function() {var __context2216 = $rjs_core.Marks.getFrames();var __context2217;try {__context2217 = $rjs_core.Marks.enterFrame();$rjs_core.Marks.setMark(M0.exception_handler_key,function(exn3582) {if (M3.__rjs_quoted__.exn_fail_filesystem_p(exn3582)) {var if_res2205 = function() {return false;};} else {var if_res2205 = function() {return M3.raise(exn3582);};}return M3.abort_current_continuation(stamp_prompt_tag,if_res2205);});if (M3.vector_ref(M3.system_type($rjs_core.Symbol.make("fs-change")),2)) {var loop3584 = function(path3585) {var let_result2206 = M3.__rjs_quoted__.split_path(path3585);var base3586 = let_result2206.getAt(0);var name3587 = let_result2206.getAt(1);var dir_p3588 = let_result2206.getAt(2);if (M3.__rjs_quoted__.path_p(base3586)) {if (M3.__rjs_quoted__.directory_exists_p(base3586)) {var if_res2207 = M3.__rjs_quoted__.filesystem_change_evt(base3586,function() {return false;});} else {var if_res2207 = loop3584(base3586);}var if_res2208 = if_res2207;} else {var if_res2208 = false;}return if_res2208;};var if_res2209 = loop3584(path3580);} else {var if_res2209 = false;}var dir_evt3583 = if_res2209;if (M3.not(M3.__rjs_quoted__.file_exists_p(path3580))) {var if_res2215 = M3.cons(false,dir_evt3583);} else {if (M3.vector_ref(M3.system_type($rjs_core.Symbol.make("fs-change")),2)) {var if_res2210 = M3.__rjs_quoted__.filesystem_change_evt(path3580,function() {return false;});} else {var if_res2210 = false;}var evt3589 = if_res2210;if (dir_evt3583) {var if_res2211 = M3.__rjs_quoted__.filesystem_change_evt_cancel(dir_evt3583);} else {var if_res2211 = M3.rvoid();}if_res2211;var p3590 = M3.__rjs_quoted__.open_input_file(path3580);var if_res2215 = M3.cons(M3.__rjs_quoted__.dynamic_wind(M3.rvoid,function() {var bstr3591 = M3.__rjs_quoted__.read_bytes(8192,p3590);if (M3.bytes_p(bstr3591)) {var if_res2212 = M3._gt__eq_(M3.__rjs_quoted__.bytes_length(bstr3591),8192);} else {var if_res2212 = false;}if (if_res2212) {var loop3592 = function() {var bstr3593 = M3.__rjs_quoted__.read_bytes(8192,p3590);if (M3.__rjs_quoted__.eof_object_p(bstr3593)) {var if_res2213 = M3.rnull;} else {var if_res2213 = M3.cons(bstr3593,loop3592());}return if_res2213;};var if_res2214 = M3.apply(M3.__rjs_quoted__.bytes_append,M3.cons(bstr3591,loop3592()));} else {var if_res2214 = bstr3591;}return if_res2214;},function() {return M3.__rjs_quoted__.close_input_port(p3590);}),evt3589);}var __wcm_result2218 = if_res2215;} finally {$rjs_core.Marks.updateFrame(__context2216,__context2217);}return __wcm_result2218;},stamp_prompt_tag);}return if_res2220;};var no_file_stamp_p = function(a3594) {var or_part3595 = M3.not(a3594);if (or_part3595) {var if_res2221 = or_part3595;} else {var if_res2221 = M3.not(M3.car(a3594));}return if_res2221;};var get_linked_collections = function(links_path3596) {return M3.__rjs_quoted__.call_with_escape_continuation(function(esc3597) {var make_handler3598 = function(ts3599) {return function(exn3600) {if (M3.__rjs_quoted__.exn_fail_p(exn3600)) {var l3601 = M3.__rjs_quoted__.current_logger();if (M3.__rjs_quoted__.log_level_p(l3601,$rjs_core.Symbol.make("error"))) {var if_res2222 = M3.__rjs_quoted__.log_message(l3601,$rjs_core.Symbol.make("error"),M3.format("error reading collection links file ~s: ~a",links_path3596,M3.__rjs_quoted__.exn_message(exn3600)),M3.current_continuation_marks());} else {var if_res2222 = M3.rvoid();}var if_res2223 = if_res2222;} else {var if_res2223 = M3.rvoid();}if_res2223;if (ts3599) {var if_res2224 = M3.hash_set_bang_(links_cache,links_path3596,M3.cons(ts3599,$rjs_core.Hash.makeEq([], false)));} else {var if_res2224 = M3.rvoid();}if_res2224;if (M3.__rjs_quoted__.exn_fail_p(exn3600)) {var if_res2225 = esc3597(M3.make_hasheq());} else {var if_res2225 = exn3600;}return if_res2225;};};var __context2251 = $rjs_core.Marks.getFrames();var __context2252;try {__context2252 = $rjs_core.Marks.enterFrame();$rjs_core.Marks.setMark(M0.exception_handler_key,make_handler3598(false));var links_stamp_plus_cache3602 = M3.hash_ref(links_cache,links_path3596,$rjs_core.Pair.make(false, $rjs_core.Hash.makeEq([], false)));var a_links_stamp3603 = M3.car(links_stamp_plus_cache3602);var ts3604 = file__gt_stamp(links_path3596,a_links_stamp3603);if (M3.not(M3.equal_p(ts3604,a_links_stamp3603))) {var __context2246 = $rjs_core.Marks.getFrames();var __context2247;try {__context2247 = __context2246;$rjs_core.Marks.setMark(M0.exception_handler_key,make_handler3598(ts3604));var __wcm_result2248 = M1.call_with_default_reading_parameterization(function() {if (no_file_stamp_p(ts3604)) {var if_res2228 = M3.rnull;} else {var p3606 = M3.__rjs_quoted__.open_input_file(links_path3596,$rjs_core.Symbol.make("binary"));var if_res2228 = M3.__rjs_quoted__.dynamic_wind(M3.rvoid,function() {var begin_res2226 = M3.__rjs_quoted__.read(p3606);if (M3.__rjs_quoted__.eof_object_p(M3.__rjs_quoted__.read(p3606))) {var if_res2227 = M3.rvoid();} else {var if_res2227 = M3.error("expected a single S-expression");}if_res2227;return begin_res2226;},function() {return M3.__rjs_quoted__.close_input_port(p3606);});}var v3605 = if_res2228;if (M3.list_p(v3605)) {var if_res2237 = M3.andmap(function(p3607) {if (M3.list_p(p3607)) {var or_part3608 = M3._eq_(2,M3.length(p3607));if (or_part3608) {var if_res2229 = or_part3608;} else {var if_res2229 = M3._eq_(3,M3.length(p3607));}if (if_res2229) {var or_part3609 = M3.string_p(M3.car(p3607));if (or_part3609) {var if_res2231 = or_part3609;} else {var or_part3610 = M3.eq_p($rjs_core.Symbol.make("root"),M3.car(p3607));if (or_part3610) {var if_res2230 = or_part3610;} else {var if_res2230 = M3.eq_p($rjs_core.Symbol.make("static-root"),M3.car(p3607));}var if_res2231 = if_res2230;}if (if_res2231) {if (M4.path_string_p(M3.cadr(p3607))) {var or_part3611 = M3.null_p(M3.cddr(p3607));if (or_part3611) {var if_res2232 = or_part3611;} else {var if_res2232 = M3.regexp_p(M3.caddr(p3607));}var if_res2233 = if_res2232;} else {var if_res2233 = false;}var if_res2234 = if_res2233;} else {var if_res2234 = false;}var if_res2235 = if_res2234;} else {var if_res2235 = false;}var if_res2236 = if_res2235;} else {var if_res2236 = false;}return if_res2236;},v3605);} else {var if_res2237 = false;}if (if_res2237) {var if_res2238 = M3.rvoid();} else {var if_res2238 = M3.error("ill-formed content");}if_res2238;var ht3612 = M3.make_hasheq();var let_result2239 = M3.__rjs_quoted__.split_path(links_path3596);var base3614 = let_result2239.getAt(0);var name3615 = let_result2239.getAt(1);var dir_p3616 = let_result2239.getAt(2);var dir3613 = base3614;M3.for_each(function(p3617) {var or_part3618 = M3.null_p(M3.cddr(p3617));if (or_part3618) {var if_res2240 = or_part3618;} else {var if_res2240 = M3.__rjs_quoted__.regexp_match_p(M3.caddr(p3617),M3.__rjs_quoted__.version());}if (if_res2240) {var dir3619 = M3.__rjs_quoted__.simplify_path(M3.__rjs_quoted__.path__gt_complete_path(M3.cadr(p3617),dir3613));if (M3.eq_p(M3.car(p3617),$rjs_core.Symbol.make("static-root"))) {var if_res2244 = M3.for_each(function(sub3620) {if (M3.__rjs_quoted__.directory_exists_p(M3.__rjs_quoted__.build_path(dir3619,sub3620))) {var k3621 = M3.__rjs_quoted__.string__gt_symbol(M3.__rjs_quoted__.path__gt_string(sub3620));var if_res2241 = M3.hash_set_bang_(ht3612,k3621,M3.cons(dir3619,M3.hash_ref(ht3612,k3621,M3.rnull)));} else {var if_res2241 = M3.rvoid();}return if_res2241;},M3.__rjs_quoted__.directory_list(dir3619));} else {if (M3.eq_p(M3.car(p3617),$rjs_core.Symbol.make("root"))) {if (M3.hash_ref(ht3612,false,false)) {var if_res2242 = M3.rvoid();} else {var if_res2242 = M3.hash_set_bang_(ht3612,false,M3.rnull);}if_res2242;var if_res2243 = M3.__rjs_quoted__.hash_for_each(ht3612,function(k3622, v3623) {return M3.hash_set_bang_(ht3612,k3622,M3.cons(dir3619,v3623));});} else {var s3624 = M3.__rjs_quoted__.string__gt_symbol(M3.car(p3617));var if_res2243 = M3.hash_set_bang_(ht3612,s3624,M3.cons(M3.box(dir3619),M3.hash_ref(ht3612,s3624,M3.rnull)));}var if_res2244 = if_res2243;}var if_res2245 = if_res2244;} else {var if_res2245 = M3.rvoid();}return if_res2245;},v3605);M3.__rjs_quoted__.hash_for_each(ht3612,function(k3625, v3626) {return M3.hash_set_bang_(ht3612,k3625,M3.reverse(v3626));});M3.hash_set_bang_(links_cache,links_path3596,M3.cons(ts3604,ht3612));return ht3612;});} finally {$rjs_core.Marks.updateFrame(__context2246,__context2247);}var if_res2250 = __wcm_result2248;} else {var if_res2250 = M3.cdr(links_stamp_plus_cache3602);}var __wcm_result2253 = if_res2250;} finally {$rjs_core.Marks.updateFrame(__context2251,__context2252);}return __wcm_result2253;});};var normalize_collection_reference = function(collection3627, collection_path3628) {if (M3.string_p(collection3627)) {var m3629 = M3.__rjs_quoted__.regexp_match_positions("/\\/+/",collection3627);if (m3629) {if (M3._eq_(M3.caar(m3629),M3.sub1(M3.string_length(collection3627)))) {var if_res2255 = M3.values(M3.substring(collection3627,0,M3.caar(m3629)),collection_path3628);} else {var if_res2255 = M3.values(M3.substring(collection3627,0,M3.caar(m3629)),M3.cons(M3.substring(collection3627,M3.cdar(m3629)),collection_path3628));}var if_res2256 = if_res2255;} else {var if_res2256 = M3.values(collection3627,collection_path3628);}var if_res2259 = if_res2256;} else {var let_result2257 = M3.__rjs_quoted__.split_path(collection3627);var base3630 = let_result2257.getAt(0);var name3631 = let_result2257.getAt(1);var dir_p3632 = let_result2257.getAt(2);if (M3.eq_p(base3630,$rjs_core.Symbol.make("relative"))) {var if_res2258 = M3.values(name3631,collection_path3628);} else {var if_res2258 = normalize_collection_reference(base3630,M3.cons(name3631,collection_path3628));}var if_res2259 = if_res2258;}return if_res2259;};var find_col_file = function(fail3633, collection3634, collection_path3635, file_name3636, check_compiled_p3637) {var let_result2260 = normalize_collection_reference(collection3634,collection_path3635);var collection3638 = let_result2260.getAt(0);var collection_path3639 = let_result2260.getAt(1);if (M3.__rjs_quoted__.path_p(collection3638)) {var if_res2261 = M3.__rjs_quoted__.path__gt_string(collection3638);} else {var if_res2261 = collection3638;}var sym3641 = M3.__rjs_quoted__.string__gt_symbol(if_res2261);var loop3642 = function(l3643) {if (M3.null_p(l3643)) {var if_res2264 = M3.rnull;} else {if (M3.not(M3.car(l3643))) {var if_res2263 = M3.append(M3.__rjs_quoted__.current_library_collection_paths(),loop3642(M3.cdr(l3643)));} else {if (M3.__rjs_quoted__.hash_p(M3.car(l3643))) {var if_res2262 = M3.append(M3.map(M3.box,M3.hash_ref(M3.car(l3643),sym3641,M3.rnull)),M3.hash_ref(M3.car(l3643),false,M3.rnull),loop3642(M3.cdr(l3643)));} else {var ht3644 = get_linked_collections(M3.car(l3643));var if_res2262 = M3.append(M3.hash_ref(ht3644,sym3641,M3.rnull),M3.hash_ref(ht3644,false,M3.rnull),loop3642(M3.cdr(l3643)));}var if_res2263 = if_res2262;}var if_res2264 = if_res2263;}return if_res2264;};var all_paths3640 = loop3642(M3.__rjs_quoted__.current_library_collection_links());var done3645 = function(p3646) {if (file_name3636) {var if_res2265 = M3.__rjs_quoted__.build_path(p3646,file_name3636);} else {var if_res2265 = p3646;}return if_res2265;};var _times_build_path_rep3647 = function(p3648, c3649) {if (M3.__rjs_quoted__.path_p(p3648)) {var if_res2266 = M3.__rjs_quoted__.build_path(p3648,c3649);} else {var if_res2266 = M3.unbox(p3648);}return if_res2266;};var _times_directory_exists_p3650 = function(orig3651, p3652) {if (M3.__rjs_quoted__.path_p(orig3651)) {var if_res2267 = M3.__rjs_quoted__.directory_exists_p(p3652);} else {var if_res2267 = true;}return if_res2267;};var to_string3653 = function(p3654) {if (M3.__rjs_quoted__.path_p(p3654)) {var if_res2268 = M3.__rjs_quoted__.path__gt_string(p3654);} else {var if_res2268 = p3654;}return if_res2268;};var cloop3655 = function(paths3656, found_col3657) {if (M3.null_p(paths3656)) {if (found_col3657) {var if_res2277 = done3645(found_col3657);} else {if (M3.null_p(collection_path3639)) {var if_res2270 = "";} else {var loop3659 = function(cp3660) {if (M3.null_p(M3.cdr(cp3660))) {var if_res2269 = M3.list(to_string3653(M3.car(cp3660)));} else {var if_res2269 = M3.list_times_(to_string3653(M3.car(cp3660)),"/",loop3659(M3.cdr(cp3660)));}return if_res2269;};var if_res2270 = M3.apply(M3.string_append,loop3659(collection_path3639));}var rest_coll3658 = if_res2270;var filter3661 = function(f3662, l3663) {if (M3.null_p(l3663)) {var if_res2272 = M3.rnull;} else {if (f3662(M3.car(l3663))) {var if_res2271 = M3.cons(M3.car(l3663),filter3661(f3662,M3.cdr(l3663)));} else {var if_res2271 = filter3661(f3662,M3.cdr(l3663));}var if_res2272 = if_res2271;}return if_res2272;};if (M3.null_p(collection_path3639)) {var if_res2276 = to_string3653(collection3638);} else {var if_res2276 = M3.string_append(to_string3653(collection3638),"/",rest_coll3658);}var len3665 = M3.length(all_paths3640);var clen3666 = M3.length(M3.__rjs_quoted__.current_library_collection_paths());if (M3._lt_(len3665-clen3666,5)) {var if_res2274 = all_paths3640;} else {var if_res2274 = M3.append(M3.__rjs_quoted__.current_library_collection_paths(),M3.list(M3.format("... [~a additional linked and package directories]",len3665-clen3666)));}var temp2275 = M3.apply(M3.string_append,M3.map(function(p3664) {return M3.format("\n ~a ~a"," ",p3664);},if_res2274));if (M3.ormap(M3.__rjs_quoted__.box_p,all_paths3640)) {var if_res2273 = M3.format("\n   sub-collection: ~s\n  in parent directories:~a",rest_coll3658,M3.apply(M3.string_append,M3.map(function(p3667) {return M3.format("\n   ~a",M3.unbox(p3667));},filter3661(M3.__rjs_quoted__.box_p,all_paths3640))));} else {var if_res2273 = "";}var if_res2277 = fail3633(M3.format("collection not found\n  collection: ~s\n  in collection directories:~a~a",if_res2276,temp2275,if_res2273));}var if_res2290 = if_res2277;} else {var dir3668 = _times_build_path_rep3647(M3.car(paths3656),collection3638);if (_times_directory_exists_p3650(M3.car(paths3656),dir3668)) {var cpath3669 = M3.apply(M3.__rjs_quoted__.build_path,dir3668,collection_path3639);if (M3.null_p(collection_path3639)) {var if_res2278 = true;} else {var if_res2278 = M3.__rjs_quoted__.directory_exists_p(cpath3669);}if (if_res2278) {if (file_name3636) {var or_part3670 = file_exists_p_by_maybe_compiled(cpath3669,file_name3636,check_compiled_p3637);if (or_part3670) {var if_res2283 = or_part3670;} else {if (M3.__rjs_quoted__.path_p(file_name3636)) {var if_res2279 = M3.__rjs_quoted__.path__gt_string(file_name3636);} else {var if_res2279 = file_name3636;}var file_name3672 = if_res2279;var len3673 = M3.string_length(file_name3672);if (M3._gt__eq_(len3673,4)) {if (M3.string_eq__p(".rkt",M3.substring(file_name3672,len3673-4))) {var if_res2280 = M3.string_append(M3.substring(file_name3672,0,len3673-4),".ss");} else {var if_res2280 = false;}var if_res2281 = if_res2280;} else {var if_res2281 = false;}var alt_file_name3671 = if_res2281;if (alt_file_name3671) {var if_res2282 = file_exists_p_by_maybe_compiled(cpath3669,alt_file_name3671,check_compiled_p3637);} else {var if_res2282 = false;}var if_res2283 = if_res2282;}if (if_res2283) {var if_res2286 = done3645(cpath3669);} else {var temp2285 = M3.cdr(paths3656);var or_part3674 = found_col3657;if (or_part3674) {var if_res2284 = or_part3674;} else {var if_res2284 = cpath3669;}var if_res2286 = cloop3655(temp2285,if_res2284);}var if_res2287 = if_res2286;} else {var if_res2287 = done3645(cpath3669);}var if_res2288 = if_res2287;} else {var if_res2288 = cloop3655(M3.cdr(paths3656),found_col3657);}var if_res2289 = if_res2288;} else {var if_res2289 = cloop3655(M3.cdr(paths3656),found_col3657);}var if_res2290 = if_res2289;}return if_res2290;};return cloop3655(all_paths3640,false);};var file_exists_p_by_maybe_compiled = function(dir3675, path3676, check_compiled_p3677) {var or_part3678 = M3.__rjs_quoted__.file_exists_p(M3.__rjs_quoted__.build_path(dir3675,path3676));if (or_part3678) {var if_res2294 = or_part3678;} else {if (check_compiled_p3677) {var try_path3679 = M4.path_add_extension(path3676,new Uint8Array([46,122,111]));var modes3680 = M3.__rjs_quoted__.use_compiled_file_paths();var roots3681 = M3.__rjs_quoted__.current_compiled_file_roots();var if_res2293 = M3.ormap(function(d3682) {return M3.ormap(function(mode3683) {var p3684 = M3.__rjs_quoted__.build_path(dir3675,mode3683,try_path3679);if (M3.eq_p(d3682,$rjs_core.Symbol.make("same"))) {var if_res2292 = p3684;} else {if (M3.__rjs_quoted__.relative_path_p(d3682)) {var if_res2291 = M3.__rjs_quoted__.build_path(p3684,d3682);} else {var if_res2291 = M4.reroot_path(p3684,d3682);}var if_res2292 = if_res2291;}return M3.__rjs_quoted__.file_exists_p(if_res2292);},modes3680);},roots3681);} else {var if_res2293 = false;}var if_res2294 = if_res2293;}return if_res2294;};var cl2295 = function() {return find_library_collection_paths(M3.rnull,M3.rnull);};var cl2296 = function(extra_collects_dirs3685) {return find_library_collection_paths(extra_collects_dirs3685,M3.rnull);};var cl2297 = function(extra_collects_dirs3686, post_collects_dirs3687) {var user_too_p3688 = M3.__rjs_quoted__.use_user_specific_search_paths();var cons_if3689 = function(f3691, r3692) {if (f3691) {var if_res2299 = M3.cons(f3691,r3692);} else {var if_res2299 = r3692;}return if_res2299;};var config_table3690 = get_config_table(M2.find_main_config());if (user_too_p3688) {var c3693 = M3.__rjs_quoted__.environment_variables_ref(M3.__rjs_quoted__.current_environment_variables(),new Uint8Array([80,76,84,67,79,76,76,69,67,84,83]));if (c3693) {var if_res2303 = M3.__rjs_quoted__.bytes__gt_string_by_locale(c3693,"?");} else {var if_res2303 = "";}var if_res2304 = if_res2303;} else {var if_res2304 = "";}if (user_too_p3688) {var if_res2302 = M3.__rjs_quoted__.build_path(M3.__rjs_quoted__.find_system_path($rjs_core.Symbol.make("addon-dir")),get_installation_name(config_table3690),"collects");} else {var if_res2302 = false;}var loop3694 = function(l3695) {if (M3.null_p(l3695)) {var if_res2301 = M3.rnull;} else {var collects_path3696 = M3.car(l3695);var v3697 = M2.exe_relative_path__gt_complete_path(collects_path3696);if (v3697) {var if_res2300 = M3.cons(M3.__rjs_quoted__.simplify_path(M3.__rjs_quoted__.path__gt_complete_path(v3697,M3.__rjs_quoted__.current_directory())),loop3694(M3.cdr(l3695)));} else {var if_res2300 = loop3694(M3.cdr(l3695));}var if_res2301 = if_res2300;}return if_res2301;};return M5.path_list_string__gt_path_list(if_res2304,add_config_search(config_table3690,$rjs_core.Symbol.make("collects-search-dirs"),cons_if3689(if_res2302,loop3694(M3.append(extra_collects_dirs3686,M3.list(M3.__rjs_quoted__.find_system_path($rjs_core.Symbol.make("collects-dir"))),post_collects_dirs3687)))));};var find_library_collection_paths = $rjs_core.attachProcedureArity(function() {var fixed_lam2298 = {'0':cl2295,'1':cl2296,'2':cl2297}[arguments.length];if (fixed_lam2298!==undefined) {return fixed_lam2298.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[0,1,2]);var __rjs_quoted__ = {};export { __rjs_quoted__,find_library_collection_links,find_library_collection_paths,collection_file_path,collection_path,find_col_file };