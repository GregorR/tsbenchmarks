import * as $rjs_core from '../../../runtime/core.js';import * as M0 from "./kw.rkt.js";import * as M1 from "./qq-and-or.rkt.js";import * as M2 from "./map.rkt.js";import * as M3 from "../../../runtime/kernel.rkt.js";import * as M4 from "./reverse.rkt.js";import * as M5 from "./for.rkt.js";var real__gt_decimal_string44550 = function(n34551, digits14552, digits24553) {var n4554 = n34551;if (digits24553) {var if_res2775 = digits14552;} else {var if_res2775 = 2;}var digits4555 = if_res2775;if (M3.exact_nonnegative_integer_p(digits4555)) {var if_res2776 = M3.rvoid();} else {var if_res2776 = M3.raise_argument_error($rjs_core.Symbol.make("real->decimal-string"),"exact-nonnegative-integer?",digits4555);}if_res2776;var e4556 = M3.expt(10,digits4555);var num4557 = M3.round(M3.abs(e4556*M3.inexact__gt_exact(n4554)));var or_part4558 = M3.negative_p(n4554);if (or_part4558) {var if_res2780 = or_part4558;} else {var if_res2780 = M3.equal_p(n4554,-0.0);}if (if_res2780) {var if_res2781 = "-";} else {var if_res2781 = "";}var temp2779 = M3.quotient(num4557,e4556);if (M3.zero_p(digits4555)) {var if_res2778 = "";} else {var s4559 = M3.number__gt_string(M3.remainder(num4557,e4556));if (M3._eq_(M3.string_length(s4559),digits4555)) {var if_res2777 = s4559;} else {var if_res2777 = M3.string_append(M3.make_string(digits4555-M3.string_length(s4559),"0"),s4559);}var if_res2778 = if_res2777;}return M3.format("~a~a.~a",if_res2781,temp2779,if_res2778);};var cl2782 = function(n4560) {return real__gt_decimal_string44550(n4560,false,false);};var cl2783 = function(n4561, digits14562) {return real__gt_decimal_string44550(n4561,digits14562,true);};var real__gt_decimal_string = $rjs_core.attachProcedureArity(function() {var fixed_lam2784 = {'1':cl2782,'2':cl2783}[arguments.length];if (fixed_lam2784!==undefined) {return fixed_lam2784.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[1,2]);var regexp_quote_chars_s = "/[][.*?+|(){}\\$^]/";var regexp_quote_chars_b = "/[][.*?+|(){}\\$^]/";var regexp_quote94563 = function(s84564, case_sens_p64565, case_sens_p74566) {var s4567 = s84564;if (case_sens_p74566) {var if_res2785 = case_sens_p64565;} else {var if_res2785 = true;}var case_sens_p4568 = if_res2785;if (M3.bytes_p(s4567)) {var if_res2787 = true;} else {if (M3.string_p(s4567)) {var if_res2786 = false;} else {var if_res2786 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-quote"),"(or/c string? bytes?)",s4567);}var if_res2787 = if_res2786;}var b_p4569 = if_res2787;if (b_p4569) {var if_res2788 = M3.regexp_replace_times_(regexp_quote_chars_b,s4567,new Uint8Array([92,92,38]));} else {var if_res2788 = M3.regexp_replace_times_(regexp_quote_chars_s,s4567,"\\\\&");}var s4570 = if_res2788;if (case_sens_p4568) {var if_res2790 = s4570;} else {if (b_p4569) {var if_res2789 = M3.bytes_append(new Uint8Array([40,63,105,58]),s4570,new Uint8Array([41]));} else {var if_res2789 = M3.string_append("(?i:",s4570,")");}var if_res2790 = if_res2789;}return if_res2790;};var cl2791 = function(s4571) {return regexp_quote94563(s4571,false,false);};var cl2792 = function(s4572, case_sens_p64573) {return regexp_quote94563(s4572,case_sens_p64573,true);};var regexp_quote = $rjs_core.attachProcedureArity(function() {var fixed_lam2793 = {'1':cl2791,'2':cl2792}[arguments.length];if (fixed_lam2793!==undefined) {return fixed_lam2793.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[1,2]);var regexp_replace_quote = function(s4574) {if (M3.bytes_p(s4574)) {var if_res2795 = M3.regexp_replace_times_("/[&\\]/",s4574,new Uint8Array([92,92,38]));} else {if (M3.string_p(s4574)) {var if_res2794 = M3.regexp_replace_times_("/[&\\]/",s4574,"\\\\&");} else {var if_res2794 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace-quote"),"(or/c string? bytes?)",s4574);}var if_res2795 = if_res2794;}return if_res2795;};var make_regexp_tweaker = function(tweaker4575) {var t4576 = M3.make_hash();return function(rx4577, n4578) {var run_tweak4579 = function() {if (M3.pregexp_p(rx4577)) {var tweaked4580 = tweaker4575(M3.object_name(rx4577),n4578);var or_part4581 = M3.regexp_p(tweaked4580);if (or_part4581) {var if_res2796 = or_part4581;} else {var if_res2796 = M3.byte_regexp_p(tweaked4580);}if (if_res2796) {var if_res2798 = tweaked4580;} else {if (M3.bytes_p(tweaked4580)) {var if_res2797 = M3.bytes__gt_string_by_utf_8(tweaked4580);} else {var if_res2797 = tweaked4580;}var if_res2798 = M3.pregexp(if_res2797);}var if_res2819 = if_res2798;} else {if (M3.regexp_p(rx4577)) {var tweaked4582 = tweaker4575(M3.object_name(rx4577),n4578);var or_part4583 = M3.regexp_p(tweaked4582);if (or_part4583) {var if_res2799 = or_part4583;} else {var if_res2799 = M3.byte_regexp_p(tweaked4582);}if (if_res2799) {var if_res2801 = tweaked4582;} else {if (M3.bytes_p(tweaked4582)) {var if_res2800 = M3.bytes__gt_string_by_utf_8(tweaked4582);} else {var if_res2800 = tweaked4582;}var if_res2801 = M3.regexp(if_res2800);}var if_res2818 = if_res2801;} else {if (M3.byte_pregexp_p(rx4577)) {var tweaked4584 = tweaker4575(M3.object_name(rx4577),n4578);var or_part4585 = M3.regexp_p(tweaked4584);if (or_part4585) {var if_res2802 = or_part4585;} else {var if_res2802 = M3.byte_regexp_p(tweaked4584);}if (if_res2802) {var if_res2804 = tweaked4584;} else {if (M3.bytes_p(tweaked4584)) {var if_res2803 = tweaked4584;} else {var if_res2803 = M3.string__gt_bytes_by_utf_8(tweaked4584);}var if_res2804 = M3.byte_pregexp(if_res2803);}var if_res2817 = if_res2804;} else {if (M3.byte_regexp_p(rx4577)) {var tweaked4586 = tweaker4575(M3.object_name(rx4577),n4578);var or_part4587 = M3.regexp_p(tweaked4586);if (or_part4587) {var if_res2805 = or_part4587;} else {var if_res2805 = M3.byte_regexp_p(tweaked4586);}if (if_res2805) {var if_res2807 = tweaked4586;} else {if (M3.bytes_p(tweaked4586)) {var if_res2806 = tweaked4586;} else {var if_res2806 = M3.string__gt_bytes_by_utf_8(tweaked4586);}var if_res2807 = M3.byte_regexp(if_res2806);}var if_res2816 = if_res2807;} else {if (M3.string_p(rx4577)) {var tweaked4588 = tweaker4575((function(x4589) {return x4589;})(rx4577),n4578);var or_part4590 = M3.regexp_p(tweaked4588);if (or_part4590) {var if_res2808 = or_part4590;} else {var if_res2808 = M3.byte_regexp_p(tweaked4588);}if (if_res2808) {var if_res2810 = tweaked4588;} else {if (M3.bytes_p(tweaked4588)) {var if_res2809 = M3.bytes__gt_string_by_utf_8(tweaked4588);} else {var if_res2809 = tweaked4588;}var if_res2810 = M3.regexp(if_res2809);}var if_res2815 = if_res2810;} else {if (M3.bytes_p(rx4577)) {var tweaked4591 = tweaker4575((function(x4592) {return x4592;})(rx4577),n4578);var or_part4593 = M3.regexp_p(tweaked4591);if (or_part4593) {var if_res2811 = or_part4593;} else {var if_res2811 = M3.byte_regexp_p(tweaked4591);}if (if_res2811) {var if_res2813 = tweaked4591;} else {if (M3.bytes_p(tweaked4591)) {var if_res2812 = tweaked4591;} else {var if_res2812 = M3.string__gt_bytes_by_utf_8(tweaked4591);}var if_res2813 = M3.byte_regexp(if_res2812);}var if_res2814 = if_res2813;} else {var if_res2814 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-tweaker"),"(or/c regexp? byte-regexp? string? bytes?)",rx4577);}var if_res2815 = if_res2814;}var if_res2816 = if_res2815;}var if_res2817 = if_res2816;}var if_res2818 = if_res2817;}var if_res2819 = if_res2818;}return if_res2819;};var key4594 = M3.cons(n4578,rx4577);var or_part4595 = M3.hash_ref(t4576,key4594,false);if (or_part4595) {var if_res2820 = or_part4595;} else {var rx_times_4596 = run_tweak4579();M3.hash_set_bang_(t4576,key4594,rx_times_4596);var if_res2820 = rx_times_4596;}return if_res2820;};};var regexp_try_match214597 = function(pattern194598, input_port204599, start_k114600, end_k124601, out134602, prefix144603, start_k154604, end_k164605, out174606, prefix184607) {var pattern4608 = pattern194598;var input_port4609 = input_port204599;if (start_k154604) {var if_res2821 = start_k114600;} else {var if_res2821 = 0;}var start_k4610 = if_res2821;if (end_k164605) {var if_res2822 = end_k124601;} else {var if_res2822 = false;}var end_k4611 = if_res2822;if (out174606) {var if_res2823 = out134602;} else {var if_res2823 = false;}var out4612 = if_res2823;if (prefix184607) {var if_res2824 = prefix144603;} else {var if_res2824 = new Uint8Array([]);}var prefix4613 = if_res2824;if (M3.input_port_p(input_port4609)) {var if_res2825 = M3.rvoid();} else {var if_res2825 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-try-match"),"input-port?",input_port4609);}if_res2825;var or_part4614 = M3.not(out4612);if (or_part4614) {var if_res2826 = or_part4614;} else {var if_res2826 = M3.output_port_p(out4612);}if (if_res2826) {var if_res2827 = M3.rvoid();} else {var if_res2827 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-try-match"),"(or/c output-port? #f)",out4612);}if_res2827;var m4615 = M3.regexp_match_peek_positions(pattern4608,input_port4609,start_k4610,end_k4611,false,prefix4613);if (m4615) {var drop4616 = M3.caar(m4615);var s4617 = M3.read_bytes(drop4616,input_port4609);if (out4612) {var if_res2828 = M3.write_bytes(s4617,out4612);} else {var if_res2828 = M3.rvoid();}if_res2828;var s4618 = M3.read_bytes(M3.cdar(m4615)-drop4616,input_port4609);var if_res2830 = M3.cons(s4618,M2.map(function(p4619) {if (p4619) {var if_res2829 = M3.subbytes(s4618,M3.car(p4619)-drop4616,M3.cdr(p4619)-drop4616);} else {var if_res2829 = false;}return if_res2829;},M3.cdr(m4615)));} else {var if_res2830 = false;}return if_res2830;};var cl2831 = function(pattern4620, input_port4621) {return regexp_try_match214597(pattern4620,input_port4621,false,false,false,false,false,false,false,false);};var cl2832 = function(pattern4622, input_port4623, start_k4624, end_k4625, out4626, prefix144627) {return regexp_try_match214597(pattern4622,input_port4623,start_k4624,end_k4625,out4626,prefix144627,true,true,true,true);};var cl2833 = function(pattern4628, input_port4629, start_k4630, end_k4631, out134632) {return regexp_try_match214597(pattern4628,input_port4629,start_k4630,end_k4631,out134632,false,true,true,true,false);};var cl2834 = function(pattern4633, input_port4634, start_k4635, end_k124636) {return regexp_try_match214597(pattern4633,input_port4634,start_k4635,end_k124636,false,false,true,true,false,false);};var cl2835 = function(pattern4637, input_port4638, start_k114639) {return regexp_try_match214597(pattern4637,input_port4638,start_k114639,false,false,false,true,false,false,false);};var regexp_try_match = $rjs_core.attachProcedureArity(function() {var fixed_lam2836 = {'2':cl2831,'6':cl2832,'5':cl2833,'4':cl2834,'3':cl2835}[arguments.length];if (fixed_lam2836!==undefined) {return fixed_lam2836.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[2,3,4,5,6]);var bstring_length = function(s4640) {if (M3.bytes_p(s4640)) {var if_res2837 = M3.bytes_length(s4640);} else {var if_res2837 = M3.string_length(s4640);}return if_res2837;};var no_empty_edge_matches = make_regexp_tweaker(function(rx4641, n4642) {if (M3.bytes_p(rx4641)) {var if_res2838 = M3.bytes_append(new Uint8Array([40,63,58]),rx4641,new Uint8Array([41,40,63,60,61]),M3.make_bytes(n4642,M3.char__gt_integer(".")),new Uint8Array([41]));} else {var if_res2838 = M3.format("(?:~a)(?<=~a)",rx4641,M3.make_bytes(n4642,M3.char__gt_integer(".")));}return if_res2838;});var regexp_match_positions_times_33 = function(match_select234643, match_select244644, pattern314645, string324646, start254647, end264648, ipre274649, start284650, end294651, ipre304652) {var pattern4653 = pattern314645;var string4654 = string324646;if (start284650) {var if_res2839 = start254647;} else {var if_res2839 = 0;}var start4655 = if_res2839;if (end294651) {var if_res2840 = end264648;} else {var if_res2840 = false;}var end4656 = if_res2840;if (ipre304652) {var if_res2841 = ipre274649;} else {var if_res2841 = new Uint8Array([]);}var ipre4657 = if_res2841;if (match_select244644) {var if_res2842 = match_select234643;} else {var if_res2842 = M3.car;}var match_select4658 = if_res2842;if (M3.procedure_p(match_select4658)) {var if_res2843 = M3.rvoid();} else {var if_res2843 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"procedure?",match_select4658);}if_res2843;if (M3.eq_p(match_select4658,M3.car)) {if (M3.path_p(string4654)) {var or_part4660 = M3.string_p(pattern4653);if (or_part4660) {var if_res2844 = or_part4660;} else {var if_res2844 = M3.regexp_p(pattern4653);}if (if_res2844) {var if_res2845 = M3.path__gt_string(string4654);} else {var if_res2845 = M3.path__gt_bytes(string4654);}var if_res2846 = if_res2845;} else {var if_res2846 = string4654;}var string4659 = if_res2846;if (M3.string_p(string4659)) {var if_res2848 = M3.string_length(string4659);} else {if (M3.bytes_p(string4659)) {var if_res2847 = M3.bytes_length(string4659);} else {var if_res2847 = false;}var if_res2848 = if_res2847;}var len4661 = if_res2848;if (M3.bytes_p(pattern4653)) {var if_res2852 = M3.byte_regexp(pattern4653);} else {if (M3.string_p(pattern4653)) {var if_res2851 = M3.regexp(pattern4653);} else {if (M3.regexp_p(pattern4653)) {var if_res2850 = pattern4653;} else {if (M3.byte_regexp_p(pattern4653)) {var if_res2849 = pattern4653;} else {var if_res2849 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern4653);}var if_res2850 = if_res2849;}var if_res2851 = if_res2850;}var if_res2852 = if_res2851;}var orig_rx4662 = if_res2852;var max_lookbehind4663 = M3.regexp_max_lookbehind(orig_rx4662);if (false) {if (M3.input_port_p(string4659)) {var if_res2853 = M3.rvoid();} else {var if_res2853 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"input-port?",string4659);}var if_res2856 = if_res2853;} else {var or_part4664 = len4661;if (or_part4664) {var if_res2854 = or_part4664;} else {var if_res2854 = M3.input_port_p(string4659);}if (if_res2854) {var if_res2855 = M3.rvoid();} else {var if_res2855 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c string? bytes? path? input-port?)",string4659);}var if_res2856 = if_res2855;}if_res2856;if (M3.number_p(start4655)) {if (M3.exact_p(start4655)) {if (M3.integer_p(start4655)) {var if_res2857 = M3._gt__eq_(start4655,0);} else {var if_res2857 = false;}var if_res2858 = if_res2857;} else {var if_res2858 = false;}var if_res2859 = if_res2858;} else {var if_res2859 = false;}if (if_res2859) {var if_res2860 = M3.rvoid();} else {var if_res2860 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"exact-nonnegative-integer?",start4655);}if_res2860;var or_part4665 = M3.not(end4656);if (or_part4665) {var if_res2864 = or_part4665;} else {if (M3.number_p(end4656)) {if (M3.exact_p(end4656)) {if (M3.integer_p(end4656)) {var if_res2861 = M3._gt__eq_(end4656,0);} else {var if_res2861 = false;}var if_res2862 = if_res2861;} else {var if_res2862 = false;}var if_res2863 = if_res2862;} else {var if_res2863 = false;}var if_res2864 = if_res2863;}if (if_res2864) {var if_res2865 = M3.rvoid();} else {var if_res2865 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c exact-nonnegative-integer? #f)",end4656);}if_res2865;if (M3.bytes_p(ipre4657)) {var if_res2866 = M3.rvoid();} else {var if_res2866 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"bytes?",ipre4657);}if_res2866;var or_part4666 = M3.input_port_p(string4659);if (or_part4666) {var if_res2868 = or_part4666;} else {if (len4661) {var if_res2867 = M3._lt__eq_(start4655,len4661);} else {var if_res2867 = false;}var if_res2868 = if_res2867;}if (if_res2868) {var if_res2869 = M3.rvoid();} else {var if_res2869 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-positions*"),M3.format("starting offset index out of range [0,~a]: ",len4661),start4655);}if_res2869;var or_part4667 = M3.not(end4656);if (or_part4667) {var if_res2873 = or_part4667;} else {if (M3._lt__eq_(start4655,end4656)) {var or_part4668 = M3.input_port_p(string4659);if (or_part4668) {var if_res2871 = or_part4668;} else {if (len4661) {var if_res2870 = M3._lt__eq_(end4656,len4661);} else {var if_res2870 = false;}var if_res2871 = if_res2870;}var if_res2872 = if_res2871;} else {var if_res2872 = false;}var if_res2873 = if_res2872;}if (if_res2873) {var if_res2874 = M3.rvoid();} else {var if_res2874 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-positions*"),M3.format("ending offset index out of range [~a,~a]: ",start4655,len4661),end4656);}if_res2874;var loop4669 = function(acc4670, start4671, end4672, ipre4673, 0_ok_p4674) {if (0_ok_p4674) {var if_res2875 = orig_rx4662;} else {var if_res2875 = no_empty_edge_matches(orig_rx4662,M3.add1(M3.bytes_length(ipre4673)));}var rx4675 = if_res2875;if (false) {var if_res2876 = M3.input_port_p(string4659);} else {var if_res2876 = false;}if (if_res2876) {if (M3.positive_p(start4671)) {var s4677 = M3.make_bytes(4096);var loop4678 = function(n4679) {if (M3._eq_(n4679,start4671)) {var if_res2878 = M3.rvoid();} else {var m4680 = M3.read_bytes_avail_bang_(s4677,string4659,0,M3.min(start4671-n4679,4096));if (M3.eof_object_p(m4680)) {var if_res2877 = M3.rvoid();} else {var if_res2877 = loop4678(n4679+m4680);}var if_res2878 = if_res2877;}return if_res2878;};var if_res2879 = loop4678(0);} else {var if_res2879 = M3.rvoid();}var _4676 = if_res2879;if (false) {var if_res2880 = false;} else {var if_res2880 = 0;}var discarded_by_leftovers4681 = if_res2880;if (false) {var if_res2881 = M3.open_output_bytes();} else {var if_res2881 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s4683, start4684, end4685, flush_p4686, breakable_p4687) {var c4688 = end4685-start4684;discarded_by_leftovers4681 = c4688+discarded_by_leftovers4681;return c4688;},M3.rvoid);}var spitout4682 = if_res2881;if (end4672) {var if_res2882 = end4672-start4671;} else {var if_res2882 = false;}var end4689 = if_res2882;var let_result2883 = M3.regexp_match_by_end(rx4675,string4659,0,end4689,spitout4682,ipre4673,max_lookbehind4663);var ms4690 = let_result2883.getAt(0);var ipre4691 = let_result2883.getAt(1);if (ms4690) {var if_res2884 = M3.car(ms4690);} else {var if_res2884 = false;}var m4692 = if_res2884;if (false) {var if_res2885 = M3.get_output_bytes(spitout4682);} else {var if_res2885 = discarded_by_leftovers4681;}var discarded_by_leftovers4693 = if_res2885;if (false) {var if_res2886 = bstring_length(discarded_by_leftovers4693);} else {var if_res2886 = discarded_by_leftovers4693;}var skipped4694 = if_res2886;if (m4692) {var if_res2887 = bstring_length(m4692);} else {var if_res2887 = false;}var got4695 = if_res2887;if (end4689) {if (m4692) {var if_res2888 = end4689-skipped4694-got4695;} else {var if_res2888 = false;}var if_res2889 = if_res2888;} else {var if_res2889 = false;}var end4696 = if_res2889;if (m4692) {var 0_ok_p4697 = M3.not(M3.zero_p(got4695));var if_res2890 = loop4669(false(discarded_by_leftovers4693,ms4690,acc4670),0,end4696,ipre4691,0_ok_p4697);} else {var if_res2890 = false(acc4670,discarded_by_leftovers4693);}var if_res2898 = if_res2890;} else {if (false) {var if_res2891 = M3.regexp_match_peek_positions_by_end(rx4675,string4659,start4671,end4672,false,ipre4673,max_lookbehind4663);} else {var if_res2891 = M3.regexp_match_positions_by_end(rx4675,string4659,start4671,end4672,false,ipre4673,max_lookbehind4663);}var let_result2892 = if_res2891;var m4698 = let_result2892.getAt(0);var ipre4699 = let_result2892.getAt(1);if (M3.not(m4698)) {var if_res2897 = (function(acc4700, start4701, end4702) {return acc4700;})(acc4670,start4671,end4672);} else {var mstart4703 = M3.caar(m4698);var mend4704 = M3.cdar(m4698);var 0_ok_p4705 = M3.not(M3._eq_(mstart4703,mend4704));if (function(loop4706, acc4707, start4708, end4709, ms4710) {var mstart4711 = M3.caar(ms4710);var mend4712 = M3.cdar(ms4710);if (end4709) {var if_res2893 = end4709-mend4712;} else {var if_res2893 = false;}return M3.append(M2.map(function(p4713) {return M3.cons(mend4712+M3.car(p4713),mend4712+M3.cdr(p4713));},loop4706($rjs_core.Pair.Empty,0,if_res2893)),M3.cons(M3.car(ms4710),acc4707));}) {var if_res2894 = M3.input_port_p(string4659);} else {var if_res2894 = false;}if (if_res2894) {var if_res2896 = (function(loop4714, acc4715, start4716, end4717, ms4718) {var mstart4719 = M3.caar(ms4718);var mend4720 = M3.cdar(ms4718);if (end4717) {var if_res2895 = end4717-mend4720;} else {var if_res2895 = false;}return M3.append(M2.map(function(p4721) {return M3.cons(mend4720+M3.car(p4721),mend4720+M3.cdr(p4721));},loop4714($rjs_core.Pair.Empty,0,if_res2895)),M3.cons(M3.car(ms4718),acc4715));})(function(acc4722, new_start4723, new_end4724) {return loop4669(acc4722,new_start4723,new_end4724,ipre4699,0_ok_p4705);},acc4670,start4671,end4672,m4698);} else {var if_res2896 = loop4669((function(start4725, ms4726, acc4727) {return M3.cons(M3.car(ms4726),acc4727);})(start4671,m4698,acc4670),mend4704,end4672,ipre4699,0_ok_p4705);}var if_res2897 = if_res2896;}var if_res2898 = if_res2897;}return if_res2898;};var if_res2962 = M3.reverse(loop4669($rjs_core.Pair.Empty,start4655,end4656,ipre4657,true));} else {if (M3.path_p(string4654)) {var or_part4729 = M3.string_p(pattern4653);if (or_part4729) {var if_res2899 = or_part4729;} else {var if_res2899 = M3.regexp_p(pattern4653);}if (if_res2899) {var if_res2900 = M3.path__gt_string(string4654);} else {var if_res2900 = M3.path__gt_bytes(string4654);}var if_res2901 = if_res2900;} else {var if_res2901 = string4654;}var string4728 = if_res2901;if (M3.string_p(string4728)) {var if_res2903 = M3.string_length(string4728);} else {if (M3.bytes_p(string4728)) {var if_res2902 = M3.bytes_length(string4728);} else {var if_res2902 = false;}var if_res2903 = if_res2902;}var len4730 = if_res2903;if (M3.bytes_p(pattern4653)) {var if_res2907 = M3.byte_regexp(pattern4653);} else {if (M3.string_p(pattern4653)) {var if_res2906 = M3.regexp(pattern4653);} else {if (M3.regexp_p(pattern4653)) {var if_res2905 = pattern4653;} else {if (M3.byte_regexp_p(pattern4653)) {var if_res2904 = pattern4653;} else {var if_res2904 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern4653);}var if_res2905 = if_res2904;}var if_res2906 = if_res2905;}var if_res2907 = if_res2906;}var orig_rx4731 = if_res2907;var max_lookbehind4732 = M3.regexp_max_lookbehind(orig_rx4731);if (false) {if (M3.input_port_p(string4728)) {var if_res2908 = M3.rvoid();} else {var if_res2908 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"input-port?",string4728);}var if_res2911 = if_res2908;} else {var or_part4733 = len4730;if (or_part4733) {var if_res2909 = or_part4733;} else {var if_res2909 = M3.input_port_p(string4728);}if (if_res2909) {var if_res2910 = M3.rvoid();} else {var if_res2910 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c string? bytes? path? input-port?)",string4728);}var if_res2911 = if_res2910;}if_res2911;if (M3.number_p(start4655)) {if (M3.exact_p(start4655)) {if (M3.integer_p(start4655)) {var if_res2912 = M3._gt__eq_(start4655,0);} else {var if_res2912 = false;}var if_res2913 = if_res2912;} else {var if_res2913 = false;}var if_res2914 = if_res2913;} else {var if_res2914 = false;}if (if_res2914) {var if_res2915 = M3.rvoid();} else {var if_res2915 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"exact-nonnegative-integer?",start4655);}if_res2915;var or_part4734 = M3.not(end4656);if (or_part4734) {var if_res2919 = or_part4734;} else {if (M3.number_p(end4656)) {if (M3.exact_p(end4656)) {if (M3.integer_p(end4656)) {var if_res2916 = M3._gt__eq_(end4656,0);} else {var if_res2916 = false;}var if_res2917 = if_res2916;} else {var if_res2917 = false;}var if_res2918 = if_res2917;} else {var if_res2918 = false;}var if_res2919 = if_res2918;}if (if_res2919) {var if_res2920 = M3.rvoid();} else {var if_res2920 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"(or/c exact-nonnegative-integer? #f)",end4656);}if_res2920;if (M3.bytes_p(ipre4657)) {var if_res2921 = M3.rvoid();} else {var if_res2921 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-positions*"),"bytes?",ipre4657);}if_res2921;var or_part4735 = M3.input_port_p(string4728);if (or_part4735) {var if_res2923 = or_part4735;} else {if (len4730) {var if_res2922 = M3._lt__eq_(start4655,len4730);} else {var if_res2922 = false;}var if_res2923 = if_res2922;}if (if_res2923) {var if_res2924 = M3.rvoid();} else {var if_res2924 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-positions*"),M3.format("starting offset index out of range [0,~a]: ",len4730),start4655);}if_res2924;var or_part4736 = M3.not(end4656);if (or_part4736) {var if_res2928 = or_part4736;} else {if (M3._lt__eq_(start4655,end4656)) {var or_part4737 = M3.input_port_p(string4728);if (or_part4737) {var if_res2926 = or_part4737;} else {if (len4730) {var if_res2925 = M3._lt__eq_(end4656,len4730);} else {var if_res2925 = false;}var if_res2926 = if_res2925;}var if_res2927 = if_res2926;} else {var if_res2927 = false;}var if_res2928 = if_res2927;}if (if_res2928) {var if_res2929 = M3.rvoid();} else {var if_res2929 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-positions*"),M3.format("ending offset index out of range [~a,~a]: ",start4655,len4730),end4656);}if_res2929;var loop4738 = function(acc4739, start4740, end4741, ipre4742, 0_ok_p4743) {if (0_ok_p4743) {var if_res2930 = orig_rx4731;} else {var if_res2930 = no_empty_edge_matches(orig_rx4731,M3.add1(M3.bytes_length(ipre4742)));}var rx4744 = if_res2930;if (false) {var if_res2931 = M3.input_port_p(string4728);} else {var if_res2931 = false;}if (if_res2931) {if (M3.positive_p(start4740)) {var s4746 = M3.make_bytes(4096);var loop4747 = function(n4748) {if (M3._eq_(n4748,start4740)) {var if_res2933 = M3.rvoid();} else {var m4749 = M3.read_bytes_avail_bang_(s4746,string4728,0,M3.min(start4740-n4748,4096));if (M3.eof_object_p(m4749)) {var if_res2932 = M3.rvoid();} else {var if_res2932 = loop4747(n4748+m4749);}var if_res2933 = if_res2932;}return if_res2933;};var if_res2934 = loop4747(0);} else {var if_res2934 = M3.rvoid();}var _4745 = if_res2934;if (false) {var if_res2935 = false;} else {var if_res2935 = 0;}var discarded_by_leftovers4750 = if_res2935;if (false) {var if_res2936 = M3.open_output_bytes();} else {var if_res2936 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s4752, start4753, end4754, flush_p4755, breakable_p4756) {var c4757 = end4754-start4753;discarded_by_leftovers4750 = c4757+discarded_by_leftovers4750;return c4757;},M3.rvoid);}var spitout4751 = if_res2936;if (end4741) {var if_res2937 = end4741-start4740;} else {var if_res2937 = false;}var end4758 = if_res2937;var let_result2938 = M3.regexp_match_by_end(rx4744,string4728,0,end4758,spitout4751,ipre4742,max_lookbehind4732);var ms4759 = let_result2938.getAt(0);var ipre4760 = let_result2938.getAt(1);if (ms4759) {var if_res2939 = M3.car(ms4759);} else {var if_res2939 = false;}var m4761 = if_res2939;if (false) {var if_res2940 = M3.get_output_bytes(spitout4751);} else {var if_res2940 = discarded_by_leftovers4750;}var discarded_by_leftovers4762 = if_res2940;if (false) {var if_res2941 = bstring_length(discarded_by_leftovers4762);} else {var if_res2941 = discarded_by_leftovers4762;}var skipped4763 = if_res2941;if (m4761) {var if_res2942 = bstring_length(m4761);} else {var if_res2942 = false;}var got4764 = if_res2942;if (end4758) {if (m4761) {var if_res2943 = end4758-skipped4763-got4764;} else {var if_res2943 = false;}var if_res2944 = if_res2943;} else {var if_res2944 = false;}var end4765 = if_res2944;if (m4761) {var 0_ok_p4766 = M3.not(M3.zero_p(got4764));var if_res2945 = loop4738(false(discarded_by_leftovers4762,ms4759,acc4739),0,end4765,ipre4760,0_ok_p4766);} else {var if_res2945 = false(acc4739,discarded_by_leftovers4762);}var if_res2961 = if_res2945;} else {if (false) {var if_res2946 = M3.regexp_match_peek_positions_by_end(rx4744,string4728,start4740,end4741,false,ipre4742,max_lookbehind4732);} else {var if_res2946 = M3.regexp_match_positions_by_end(rx4744,string4728,start4740,end4741,false,ipre4742,max_lookbehind4732);}var let_result2947 = if_res2946;var m4767 = let_result2947.getAt(0);var ipre4768 = let_result2947.getAt(1);if (M3.not(m4767)) {var if_res2960 = (function(acc4769, start4770, end4771) {return acc4769;})(acc4739,start4740,end4741);} else {var mstart4772 = M3.caar(m4767);var mend4773 = M3.cdar(m4767);var 0_ok_p4774 = M3.not(M3._eq_(mstart4772,mend4773));if (function(loop4775, acc4776, start4777, end4778, ms4779) {var mend4780 = M3.cdar(ms4779);if (end4778) {var if_res2948 = end4778-mend4780;} else {var if_res2948 = false;}var rest4781 = loop4775($rjs_core.Pair.Empty,0,if_res2948);var s4782 = match_select4658(ms4779);if (M3.pair_p(s4782)) {var if_res2949 = M3.exact_integer_p(M3.car(s4782));} else {var if_res2949 = false;}var or_part4783 = if_res2949;if (or_part4783) {var if_res2950 = or_part4783;} else {var if_res2950 = M3.not(s4782);}if (if_res2950) {var if_res2952 = function(p4784) {return M3.cons(mend4780+M3.car(p4784),mend4780+M3.cdr(p4784));};} else {var if_res2952 = function(ps4785) {return M2.map(function(p4786) {if (p4786) {var if_res2951 = M3.cons(mend4780+M3.car(p4786),mend4780+M3.cdr(p4786));} else {var if_res2951 = false;}return if_res2951;},ps4785);};}return M3.append(M2.map(if_res2952,rest4781),M3.cons(s4782,acc4776));}) {var if_res2953 = M3.input_port_p(string4728);} else {var if_res2953 = false;}if (if_res2953) {var if_res2959 = (function(loop4787, acc4788, start4789, end4790, ms4791) {var mend4792 = M3.cdar(ms4791);if (end4790) {var if_res2954 = end4790-mend4792;} else {var if_res2954 = false;}var rest4793 = loop4787($rjs_core.Pair.Empty,0,if_res2954);var s4794 = match_select4658(ms4791);if (M3.pair_p(s4794)) {var if_res2955 = M3.exact_integer_p(M3.car(s4794));} else {var if_res2955 = false;}var or_part4795 = if_res2955;if (or_part4795) {var if_res2956 = or_part4795;} else {var if_res2956 = M3.not(s4794);}if (if_res2956) {var if_res2958 = function(p4796) {return M3.cons(mend4792+M3.car(p4796),mend4792+M3.cdr(p4796));};} else {var if_res2958 = function(ps4797) {return M2.map(function(p4798) {if (p4798) {var if_res2957 = M3.cons(mend4792+M3.car(p4798),mend4792+M3.cdr(p4798));} else {var if_res2957 = false;}return if_res2957;},ps4797);};}return M3.append(M2.map(if_res2958,rest4793),M3.cons(s4794,acc4788));})(function(acc4799, new_start4800, new_end4801) {return loop4738(acc4799,new_start4800,new_end4801,ipre4768,0_ok_p4774);},acc4739,start4740,end4741,m4767);} else {var if_res2959 = loop4738((function(start4802, ms4803, acc4804) {return M3.cons(match_select4658(ms4803),acc4804);})(start4740,m4767,acc4739),mend4773,end4741,ipre4768,0_ok_p4774);}var if_res2960 = if_res2959;}var if_res2961 = if_res2960;}return if_res2961;};var if_res2962 = M3.reverse(loop4738($rjs_core.Pair.Empty,start4655,end4656,ipre4657,true));}return if_res2962;};var unpack34 = function(given_kws4805, given_args4806, pattern314807, string324808, start254809, end264810, ipre274811, start284812, end294813, ipre304814) {var match_select244815 = M3.pair_p(given_kws4805);if (match_select244815) {var if_res2963 = M3.car(given_args4806);} else {var if_res2963 = M3.rvoid();}var match_select234816 = if_res2963;return regexp_match_positions_times_33(match_select234816,match_select244815,pattern314807,string324808,start254809,end264810,ipre274811,start284812,end294813,ipre304814);};var cl2969 = function(given_kws4821, given_args4822, pattern4823, string4824) {return unpack34(given_kws4821,given_args4822,pattern4823,string4824,false,false,false,false,false,false);};var cl2970 = function(given_kws4825, given_args4826, pattern4827, string4828, start4829, end4830, ipre274831) {return unpack34(given_kws4825,given_args4826,pattern4827,string4828,start4829,end4830,ipre274831,true,true,true);};var cl2971 = function(given_kws4832, given_args4833, pattern4834, string4835, start4836, end264837) {return unpack34(given_kws4832,given_args4833,pattern4834,string4835,start4836,end264837,false,true,true,false);};var cl2972 = function(given_kws4838, given_args4839, pattern4840, string4841, start254842) {return unpack34(given_kws4838,given_args4839,pattern4840,string4841,start254842,false,false,true,false,false);};var temp2974 = $rjs_core.attachProcedureArity(function() {var fixed_lam2973 = {'4':cl2969,'7':cl2970,'6':cl2971,'5':cl2972}[arguments.length];if (fixed_lam2973!==undefined) {return fixed_lam2973.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[4,5,6,7]);var cl2964 = function(pattern4844, string4845) {return unpack34(M3.rnull,M3.rnull,pattern4844,string4845,false,false,false,false,false,false);};var cl2965 = function(pattern4846, string4847, start4848, end4849, ipre274850) {return unpack34(M3.rnull,M3.rnull,pattern4846,string4847,start4848,end4849,ipre274850,true,true,true);};var cl2966 = function(pattern4851, string4852, start4853, end264854) {return unpack34(M3.rnull,M3.rnull,pattern4851,string4852,start4853,end264854,false,true,true,false);};var cl2967 = function(pattern4855, string4856, start254857) {return unpack34(M3.rnull,M3.rnull,pattern4855,string4856,start254857,false,false,true,false,false);};var regexp_match_positions_times_4843 = $rjs_core.attachProcedureArity(function() {var fixed_lam2968 = {'2':cl2964,'5':cl2965,'4':cl2966,'3':cl2967}[arguments.length];if (fixed_lam2968!==undefined) {return fixed_lam2968.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[2,3,4,5]);var regexp_match_positions_times_35 = M0.__rjs_quoted__.make_optional_keyword_procedure(function(given_kws4817, given_argc4818) {if (M3._gt__eq_(given_argc4818,4)) {var if_res2975 = M3._lt__eq_(given_argc4818,7);} else {var if_res2975 = false;}if (if_res2975) {var l14819 = given_kws4817;if (M3.null_p(l14819)) {var if_res2977 = l14819;} else {if (M3.eq_p(M3.car(l14819),$rjs_core.Keyword.make('#:match-select'))) {var if_res2976 = M3.cdr(l14819);} else {var if_res2976 = l14819;}var if_res2977 = if_res2976;}var l14820 = if_res2977;var if_res2978 = M3.null_p(l14820);} else {var if_res2978 = false;}return if_res2978;},temp2974,M3.rnull,$rjs_core.Pair.makeList($rjs_core.Keyword.make('#:match-select')),regexp_match_positions_times_4843);var regexp_match_peek_positions_times_46 = function(match_select364858, match_select374859, pattern444860, string454861, start384862, end394863, ipre404864, start414865, end424866, ipre434867) {var pattern4868 = pattern444860;var string4869 = string454861;if (start414865) {var if_res2979 = start384862;} else {var if_res2979 = 0;}var start4870 = if_res2979;if (end424866) {var if_res2980 = end394863;} else {var if_res2980 = false;}var end4871 = if_res2980;if (ipre434867) {var if_res2981 = ipre404864;} else {var if_res2981 = new Uint8Array([]);}var ipre4872 = if_res2981;if (match_select374859) {var if_res2982 = match_select364858;} else {var if_res2982 = M3.car;}var match_select4873 = if_res2982;if (M3.procedure_p(match_select4873)) {var if_res2983 = M3.rvoid();} else {var if_res2983 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"procedure?",match_select4873);}if_res2983;if (M3.eq_p(match_select4873,M3.car)) {if (M3.path_p(string4869)) {var or_part4875 = M3.string_p(pattern4868);if (or_part4875) {var if_res2984 = or_part4875;} else {var if_res2984 = M3.regexp_p(pattern4868);}if (if_res2984) {var if_res2985 = M3.path__gt_string(string4869);} else {var if_res2985 = M3.path__gt_bytes(string4869);}var if_res2986 = if_res2985;} else {var if_res2986 = string4869;}var string4874 = if_res2986;if (M3.string_p(string4874)) {var if_res2988 = M3.string_length(string4874);} else {if (M3.bytes_p(string4874)) {var if_res2987 = M3.bytes_length(string4874);} else {var if_res2987 = false;}var if_res2988 = if_res2987;}var len4876 = if_res2988;if (M3.bytes_p(pattern4868)) {var if_res2992 = M3.byte_regexp(pattern4868);} else {if (M3.string_p(pattern4868)) {var if_res2991 = M3.regexp(pattern4868);} else {if (M3.regexp_p(pattern4868)) {var if_res2990 = pattern4868;} else {if (M3.byte_regexp_p(pattern4868)) {var if_res2989 = pattern4868;} else {var if_res2989 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern4868);}var if_res2990 = if_res2989;}var if_res2991 = if_res2990;}var if_res2992 = if_res2991;}var orig_rx4877 = if_res2992;var max_lookbehind4878 = M3.regexp_max_lookbehind(orig_rx4877);if (true) {if (M3.input_port_p(string4874)) {var if_res2993 = M3.rvoid();} else {var if_res2993 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"input-port?",string4874);}var if_res2996 = if_res2993;} else {var or_part4879 = len4876;if (or_part4879) {var if_res2994 = or_part4879;} else {var if_res2994 = M3.input_port_p(string4874);}if (if_res2994) {var if_res2995 = M3.rvoid();} else {var if_res2995 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c string? bytes? path? input-port?)",string4874);}var if_res2996 = if_res2995;}if_res2996;if (M3.number_p(start4870)) {if (M3.exact_p(start4870)) {if (M3.integer_p(start4870)) {var if_res2997 = M3._gt__eq_(start4870,0);} else {var if_res2997 = false;}var if_res2998 = if_res2997;} else {var if_res2998 = false;}var if_res2999 = if_res2998;} else {var if_res2999 = false;}if (if_res2999) {var if_res3000 = M3.rvoid();} else {var if_res3000 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"exact-nonnegative-integer?",start4870);}if_res3000;var or_part4880 = M3.not(end4871);if (or_part4880) {var if_res3004 = or_part4880;} else {if (M3.number_p(end4871)) {if (M3.exact_p(end4871)) {if (M3.integer_p(end4871)) {var if_res3001 = M3._gt__eq_(end4871,0);} else {var if_res3001 = false;}var if_res3002 = if_res3001;} else {var if_res3002 = false;}var if_res3003 = if_res3002;} else {var if_res3003 = false;}var if_res3004 = if_res3003;}if (if_res3004) {var if_res3005 = M3.rvoid();} else {var if_res3005 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c exact-nonnegative-integer? #f)",end4871);}if_res3005;if (M3.bytes_p(ipre4872)) {var if_res3006 = M3.rvoid();} else {var if_res3006 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"bytes?",ipre4872);}if_res3006;var or_part4881 = M3.input_port_p(string4874);if (or_part4881) {var if_res3008 = or_part4881;} else {if (len4876) {var if_res3007 = M3._lt__eq_(start4870,len4876);} else {var if_res3007 = false;}var if_res3008 = if_res3007;}if (if_res3008) {var if_res3009 = M3.rvoid();} else {var if_res3009 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),M3.format("starting offset index out of range [0,~a]: ",len4876),start4870);}if_res3009;var or_part4882 = M3.not(end4871);if (or_part4882) {var if_res3013 = or_part4882;} else {if (M3._lt__eq_(start4870,end4871)) {var or_part4883 = M3.input_port_p(string4874);if (or_part4883) {var if_res3011 = or_part4883;} else {if (len4876) {var if_res3010 = M3._lt__eq_(end4871,len4876);} else {var if_res3010 = false;}var if_res3011 = if_res3010;}var if_res3012 = if_res3011;} else {var if_res3012 = false;}var if_res3013 = if_res3012;}if (if_res3013) {var if_res3014 = M3.rvoid();} else {var if_res3014 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),M3.format("ending offset index out of range [~a,~a]: ",start4870,len4876),end4871);}if_res3014;var loop4884 = function(acc4885, start4886, end4887, ipre4888, 0_ok_p4889) {if (0_ok_p4889) {var if_res3015 = orig_rx4877;} else {var if_res3015 = no_empty_edge_matches(orig_rx4877,M3.add1(M3.bytes_length(ipre4888)));}var rx4890 = if_res3015;if (false) {var if_res3016 = M3.input_port_p(string4874);} else {var if_res3016 = false;}if (if_res3016) {if (M3.positive_p(start4886)) {var s4892 = M3.make_bytes(4096);var loop4893 = function(n4894) {if (M3._eq_(n4894,start4886)) {var if_res3018 = M3.rvoid();} else {var m4895 = M3.read_bytes_avail_bang_(s4892,string4874,0,M3.min(start4886-n4894,4096));if (M3.eof_object_p(m4895)) {var if_res3017 = M3.rvoid();} else {var if_res3017 = loop4893(n4894+m4895);}var if_res3018 = if_res3017;}return if_res3018;};var if_res3019 = loop4893(0);} else {var if_res3019 = M3.rvoid();}var _4891 = if_res3019;if (false) {var if_res3020 = false;} else {var if_res3020 = 0;}var discarded_by_leftovers4896 = if_res3020;if (false) {var if_res3021 = M3.open_output_bytes();} else {var if_res3021 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s4898, start4899, end4900, flush_p4901, breakable_p4902) {var c4903 = end4900-start4899;discarded_by_leftovers4896 = c4903+discarded_by_leftovers4896;return c4903;},M3.rvoid);}var spitout4897 = if_res3021;if (end4887) {var if_res3022 = end4887-start4886;} else {var if_res3022 = false;}var end4904 = if_res3022;var let_result3023 = M3.regexp_match_by_end(rx4890,string4874,0,end4904,spitout4897,ipre4888,max_lookbehind4878);var ms4905 = let_result3023.getAt(0);var ipre4906 = let_result3023.getAt(1);if (ms4905) {var if_res3024 = M3.car(ms4905);} else {var if_res3024 = false;}var m4907 = if_res3024;if (false) {var if_res3025 = M3.get_output_bytes(spitout4897);} else {var if_res3025 = discarded_by_leftovers4896;}var discarded_by_leftovers4908 = if_res3025;if (false) {var if_res3026 = bstring_length(discarded_by_leftovers4908);} else {var if_res3026 = discarded_by_leftovers4908;}var skipped4909 = if_res3026;if (m4907) {var if_res3027 = bstring_length(m4907);} else {var if_res3027 = false;}var got4910 = if_res3027;if (end4904) {if (m4907) {var if_res3028 = end4904-skipped4909-got4910;} else {var if_res3028 = false;}var if_res3029 = if_res3028;} else {var if_res3029 = false;}var end4911 = if_res3029;if (m4907) {var 0_ok_p4912 = M3.not(M3.zero_p(got4910));var if_res3030 = loop4884(false(discarded_by_leftovers4908,ms4905,acc4885),0,end4911,ipre4906,0_ok_p4912);} else {var if_res3030 = false(acc4885,discarded_by_leftovers4908);}var if_res3036 = if_res3030;} else {if (true) {var if_res3031 = M3.regexp_match_peek_positions_by_end(rx4890,string4874,start4886,end4887,false,ipre4888,max_lookbehind4878);} else {var if_res3031 = M3.regexp_match_positions_by_end(rx4890,string4874,start4886,end4887,false,ipre4888,max_lookbehind4878);}var let_result3032 = if_res3031;var m4913 = let_result3032.getAt(0);var ipre4914 = let_result3032.getAt(1);if (M3.not(m4913)) {var if_res3035 = (function(acc4915, start4916, end4917) {return acc4915;})(acc4885,start4886,end4887);} else {var mstart4918 = M3.caar(m4913);var mend4919 = M3.cdar(m4913);var 0_ok_p4920 = M3.not(M3._eq_(mstart4918,mend4919));if (false) {var if_res3033 = M3.input_port_p(string4874);} else {var if_res3033 = false;}if (if_res3033) {var if_res3034 = false(function(acc4921, new_start4922, new_end4923) {return loop4884(acc4921,new_start4922,new_end4923,ipre4914,0_ok_p4920);},acc4885,start4886,end4887,m4913);} else {var if_res3034 = loop4884((function(start4924, ms4925, acc4926) {return M3.cons(M3.car(ms4925),acc4926);})(start4886,m4913,acc4885),mend4919,end4887,ipre4914,0_ok_p4920);}var if_res3035 = if_res3034;}var if_res3036 = if_res3035;}return if_res3036;};var if_res3090 = M3.reverse(loop4884($rjs_core.Pair.Empty,start4870,end4871,ipre4872,true));} else {if (M3.path_p(string4869)) {var or_part4928 = M3.string_p(pattern4868);if (or_part4928) {var if_res3037 = or_part4928;} else {var if_res3037 = M3.regexp_p(pattern4868);}if (if_res3037) {var if_res3038 = M3.path__gt_string(string4869);} else {var if_res3038 = M3.path__gt_bytes(string4869);}var if_res3039 = if_res3038;} else {var if_res3039 = string4869;}var string4927 = if_res3039;if (M3.string_p(string4927)) {var if_res3041 = M3.string_length(string4927);} else {if (M3.bytes_p(string4927)) {var if_res3040 = M3.bytes_length(string4927);} else {var if_res3040 = false;}var if_res3041 = if_res3040;}var len4929 = if_res3041;if (M3.bytes_p(pattern4868)) {var if_res3045 = M3.byte_regexp(pattern4868);} else {if (M3.string_p(pattern4868)) {var if_res3044 = M3.regexp(pattern4868);} else {if (M3.regexp_p(pattern4868)) {var if_res3043 = pattern4868;} else {if (M3.byte_regexp_p(pattern4868)) {var if_res3042 = pattern4868;} else {var if_res3042 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern4868);}var if_res3043 = if_res3042;}var if_res3044 = if_res3043;}var if_res3045 = if_res3044;}var orig_rx4930 = if_res3045;var max_lookbehind4931 = M3.regexp_max_lookbehind(orig_rx4930);if (true) {if (M3.input_port_p(string4927)) {var if_res3046 = M3.rvoid();} else {var if_res3046 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"input-port?",string4927);}var if_res3049 = if_res3046;} else {var or_part4932 = len4929;if (or_part4932) {var if_res3047 = or_part4932;} else {var if_res3047 = M3.input_port_p(string4927);}if (if_res3047) {var if_res3048 = M3.rvoid();} else {var if_res3048 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c string? bytes? path? input-port?)",string4927);}var if_res3049 = if_res3048;}if_res3049;if (M3.number_p(start4870)) {if (M3.exact_p(start4870)) {if (M3.integer_p(start4870)) {var if_res3050 = M3._gt__eq_(start4870,0);} else {var if_res3050 = false;}var if_res3051 = if_res3050;} else {var if_res3051 = false;}var if_res3052 = if_res3051;} else {var if_res3052 = false;}if (if_res3052) {var if_res3053 = M3.rvoid();} else {var if_res3053 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"exact-nonnegative-integer?",start4870);}if_res3053;var or_part4933 = M3.not(end4871);if (or_part4933) {var if_res3057 = or_part4933;} else {if (M3.number_p(end4871)) {if (M3.exact_p(end4871)) {if (M3.integer_p(end4871)) {var if_res3054 = M3._gt__eq_(end4871,0);} else {var if_res3054 = false;}var if_res3055 = if_res3054;} else {var if_res3055 = false;}var if_res3056 = if_res3055;} else {var if_res3056 = false;}var if_res3057 = if_res3056;}if (if_res3057) {var if_res3058 = M3.rvoid();} else {var if_res3058 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"(or/c exact-nonnegative-integer? #f)",end4871);}if_res3058;if (M3.bytes_p(ipre4872)) {var if_res3059 = M3.rvoid();} else {var if_res3059 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),"bytes?",ipre4872);}if_res3059;var or_part4934 = M3.input_port_p(string4927);if (or_part4934) {var if_res3061 = or_part4934;} else {if (len4929) {var if_res3060 = M3._lt__eq_(start4870,len4929);} else {var if_res3060 = false;}var if_res3061 = if_res3060;}if (if_res3061) {var if_res3062 = M3.rvoid();} else {var if_res3062 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),M3.format("starting offset index out of range [0,~a]: ",len4929),start4870);}if_res3062;var or_part4935 = M3.not(end4871);if (or_part4935) {var if_res3066 = or_part4935;} else {if (M3._lt__eq_(start4870,end4871)) {var or_part4936 = M3.input_port_p(string4927);if (or_part4936) {var if_res3064 = or_part4936;} else {if (len4929) {var if_res3063 = M3._lt__eq_(end4871,len4929);} else {var if_res3063 = false;}var if_res3064 = if_res3063;}var if_res3065 = if_res3064;} else {var if_res3065 = false;}var if_res3066 = if_res3065;}if (if_res3066) {var if_res3067 = M3.rvoid();} else {var if_res3067 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match-peek-positions*"),M3.format("ending offset index out of range [~a,~a]: ",start4870,len4929),end4871);}if_res3067;var loop4937 = function(acc4938, start4939, end4940, ipre4941, 0_ok_p4942) {if (0_ok_p4942) {var if_res3068 = orig_rx4930;} else {var if_res3068 = no_empty_edge_matches(orig_rx4930,M3.add1(M3.bytes_length(ipre4941)));}var rx4943 = if_res3068;if (false) {var if_res3069 = M3.input_port_p(string4927);} else {var if_res3069 = false;}if (if_res3069) {if (M3.positive_p(start4939)) {var s4945 = M3.make_bytes(4096);var loop4946 = function(n4947) {if (M3._eq_(n4947,start4939)) {var if_res3071 = M3.rvoid();} else {var m4948 = M3.read_bytes_avail_bang_(s4945,string4927,0,M3.min(start4939-n4947,4096));if (M3.eof_object_p(m4948)) {var if_res3070 = M3.rvoid();} else {var if_res3070 = loop4946(n4947+m4948);}var if_res3071 = if_res3070;}return if_res3071;};var if_res3072 = loop4946(0);} else {var if_res3072 = M3.rvoid();}var _4944 = if_res3072;if (false) {var if_res3073 = false;} else {var if_res3073 = 0;}var discarded_by_leftovers4949 = if_res3073;if (false) {var if_res3074 = M3.open_output_bytes();} else {var if_res3074 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s4951, start4952, end4953, flush_p4954, breakable_p4955) {var c4956 = end4953-start4952;discarded_by_leftovers4949 = c4956+discarded_by_leftovers4949;return c4956;},M3.rvoid);}var spitout4950 = if_res3074;if (end4940) {var if_res3075 = end4940-start4939;} else {var if_res3075 = false;}var end4957 = if_res3075;var let_result3076 = M3.regexp_match_by_end(rx4943,string4927,0,end4957,spitout4950,ipre4941,max_lookbehind4931);var ms4958 = let_result3076.getAt(0);var ipre4959 = let_result3076.getAt(1);if (ms4958) {var if_res3077 = M3.car(ms4958);} else {var if_res3077 = false;}var m4960 = if_res3077;if (false) {var if_res3078 = M3.get_output_bytes(spitout4950);} else {var if_res3078 = discarded_by_leftovers4949;}var discarded_by_leftovers4961 = if_res3078;if (false) {var if_res3079 = bstring_length(discarded_by_leftovers4961);} else {var if_res3079 = discarded_by_leftovers4961;}var skipped4962 = if_res3079;if (m4960) {var if_res3080 = bstring_length(m4960);} else {var if_res3080 = false;}var got4963 = if_res3080;if (end4957) {if (m4960) {var if_res3081 = end4957-skipped4962-got4963;} else {var if_res3081 = false;}var if_res3082 = if_res3081;} else {var if_res3082 = false;}var end4964 = if_res3082;if (m4960) {var 0_ok_p4965 = M3.not(M3.zero_p(got4963));var if_res3083 = loop4937(false(discarded_by_leftovers4961,ms4958,acc4938),0,end4964,ipre4959,0_ok_p4965);} else {var if_res3083 = false(acc4938,discarded_by_leftovers4961);}var if_res3089 = if_res3083;} else {if (true) {var if_res3084 = M3.regexp_match_peek_positions_by_end(rx4943,string4927,start4939,end4940,false,ipre4941,max_lookbehind4931);} else {var if_res3084 = M3.regexp_match_positions_by_end(rx4943,string4927,start4939,end4940,false,ipre4941,max_lookbehind4931);}var let_result3085 = if_res3084;var m4966 = let_result3085.getAt(0);var ipre4967 = let_result3085.getAt(1);if (M3.not(m4966)) {var if_res3088 = (function(acc4968, start4969, end4970) {return acc4968;})(acc4938,start4939,end4940);} else {var mstart4971 = M3.caar(m4966);var mend4972 = M3.cdar(m4966);var 0_ok_p4973 = M3.not(M3._eq_(mstart4971,mend4972));if (false) {var if_res3086 = M3.input_port_p(string4927);} else {var if_res3086 = false;}if (if_res3086) {var if_res3087 = false(function(acc4974, new_start4975, new_end4976) {return loop4937(acc4974,new_start4975,new_end4976,ipre4967,0_ok_p4973);},acc4938,start4939,end4940,m4966);} else {var if_res3087 = loop4937((function(start4977, ms4978, acc4979) {return M3.cons(match_select4873(ms4978),acc4979);})(start4939,m4966,acc4938),mend4972,end4940,ipre4967,0_ok_p4973);}var if_res3088 = if_res3087;}var if_res3089 = if_res3088;}return if_res3089;};var if_res3090 = M3.reverse(loop4937($rjs_core.Pair.Empty,start4870,end4871,ipre4872,true));}return if_res3090;};var unpack47 = function(given_kws4980, given_args4981, pattern444982, string454983, start384984, end394985, ipre404986, start414987, end424988, ipre434989) {var match_select374990 = M3.pair_p(given_kws4980);if (match_select374990) {var if_res3091 = M3.car(given_args4981);} else {var if_res3091 = M3.rvoid();}var match_select364991 = if_res3091;return regexp_match_peek_positions_times_46(match_select364991,match_select374990,pattern444982,string454983,start384984,end394985,ipre404986,start414987,end424988,ipre434989);};var cl3097 = function(given_kws4996, given_args4997, pattern4998, string4999) {return unpack47(given_kws4996,given_args4997,pattern4998,string4999,false,false,false,false,false,false);};var cl3098 = function(given_kws5000, given_args5001, pattern5002, string5003, start5004, end5005, ipre405006) {return unpack47(given_kws5000,given_args5001,pattern5002,string5003,start5004,end5005,ipre405006,true,true,true);};var cl3099 = function(given_kws5007, given_args5008, pattern5009, string5010, start5011, end395012) {return unpack47(given_kws5007,given_args5008,pattern5009,string5010,start5011,end395012,false,true,true,false);};var cl3100 = function(given_kws5013, given_args5014, pattern5015, string5016, start385017) {return unpack47(given_kws5013,given_args5014,pattern5015,string5016,start385017,false,false,true,false,false);};var temp3102 = $rjs_core.attachProcedureArity(function() {var fixed_lam3101 = {'4':cl3097,'7':cl3098,'6':cl3099,'5':cl3100}[arguments.length];if (fixed_lam3101!==undefined) {return fixed_lam3101.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[4,5,6,7]);var cl3092 = function(pattern5019, string5020) {return unpack47(M3.rnull,M3.rnull,pattern5019,string5020,false,false,false,false,false,false);};var cl3093 = function(pattern5021, string5022, start5023, end5024, ipre405025) {return unpack47(M3.rnull,M3.rnull,pattern5021,string5022,start5023,end5024,ipre405025,true,true,true);};var cl3094 = function(pattern5026, string5027, start5028, end395029) {return unpack47(M3.rnull,M3.rnull,pattern5026,string5027,start5028,end395029,false,true,true,false);};var cl3095 = function(pattern5030, string5031, start385032) {return unpack47(M3.rnull,M3.rnull,pattern5030,string5031,start385032,false,false,true,false,false);};var regexp_match_peek_positions_times_5018 = $rjs_core.attachProcedureArity(function() {var fixed_lam3096 = {'2':cl3092,'5':cl3093,'4':cl3094,'3':cl3095}[arguments.length];if (fixed_lam3096!==undefined) {return fixed_lam3096.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[2,3,4,5]);var regexp_match_peek_positions_times_48 = M0.__rjs_quoted__.make_optional_keyword_procedure(function(given_kws4992, given_argc4993) {if (M3._gt__eq_(given_argc4993,4)) {var if_res3103 = M3._lt__eq_(given_argc4993,7);} else {var if_res3103 = false;}if (if_res3103) {var l14994 = given_kws4992;if (M3.null_p(l14994)) {var if_res3105 = l14994;} else {if (M3.eq_p(M3.car(l14994),$rjs_core.Keyword.make('#:match-select'))) {var if_res3104 = M3.cdr(l14994);} else {var if_res3104 = l14994;}var if_res3105 = if_res3104;}var l14995 = if_res3105;var if_res3106 = M3.null_p(l14995);} else {var if_res3106 = false;}return if_res3106;},temp3102,M3.rnull,$rjs_core.Pair.makeList($rjs_core.Keyword.make('#:match-select')),regexp_match_peek_positions_times_5018);var get_buf_plus_sub = function(string5033, pattern5034) {if (M3.string_p(string5033)) {var or_part5036 = M3.byte_regexp_p(pattern5034);if (or_part5036) {var if_res3107 = or_part5036;} else {var if_res3107 = M3.bytes_p(pattern5034);}var if_res3108 = if_res3107;} else {var if_res3108 = false;}if (if_res3108) {var if_res3109 = M3.string__gt_bytes_by_utf_8(string5033,M3.char__gt_integer("?"));} else {var if_res3109 = string5033;}var buf5035 = if_res3109;var or_part5037 = M3.bytes_p(buf5035);if (or_part5037) {var if_res3112 = or_part5037;} else {if (M3.path_p(string5033)) {var or_part5038 = M3.bytes_p(pattern5034);if (or_part5038) {var if_res3110 = or_part5038;} else {var if_res3110 = M3.byte_regexp_p(pattern5034);}var if_res3111 = if_res3110;} else {var if_res3111 = false;}var if_res3112 = if_res3111;}if (if_res3112) {var if_res3113 = M3.subbytes;} else {var if_res3113 = M3.substring;}return M3.values(buf5035,if_res3113);};var regexp_split575039 = function(pattern555040, string565041, start495042, end505043, ipre515044, start525045, end535046, ipre545047) {var pattern5048 = pattern555040;var string5049 = string565041;if (start525045) {var if_res3114 = start495042;} else {var if_res3114 = 0;}var start5050 = if_res3114;if (end535046) {var if_res3115 = end505043;} else {var if_res3115 = false;}var end5051 = if_res3115;if (ipre545047) {var if_res3116 = ipre515044;} else {var if_res3116 = new Uint8Array([]);}var ipre5052 = if_res3116;var let_result3117 = get_buf_plus_sub(string5049,pattern5048);var buf5053 = let_result3117.getAt(0);var sub5054 = let_result3117.getAt(1);if (M3.path_p(buf5053)) {var or_part5056 = M3.string_p(pattern5048);if (or_part5056) {var if_res3118 = or_part5056;} else {var if_res3118 = M3.regexp_p(pattern5048);}if (if_res3118) {var if_res3119 = M3.path__gt_string(buf5053);} else {var if_res3119 = M3.path__gt_bytes(buf5053);}var if_res3120 = if_res3119;} else {var if_res3120 = buf5053;}var buf5055 = if_res3120;if (M3.string_p(buf5055)) {var if_res3122 = M3.string_length(buf5055);} else {if (M3.bytes_p(buf5055)) {var if_res3121 = M3.bytes_length(buf5055);} else {var if_res3121 = false;}var if_res3122 = if_res3121;}var len5057 = if_res3122;if (M3.bytes_p(pattern5048)) {var if_res3126 = M3.byte_regexp(pattern5048);} else {if (M3.string_p(pattern5048)) {var if_res3125 = M3.regexp(pattern5048);} else {if (M3.regexp_p(pattern5048)) {var if_res3124 = pattern5048;} else {if (M3.byte_regexp_p(pattern5048)) {var if_res3123 = pattern5048;} else {var if_res3123 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"(or/c regexp? byte-regexp? string? bytes?)",pattern5048);}var if_res3124 = if_res3123;}var if_res3125 = if_res3124;}var if_res3126 = if_res3125;}var orig_rx5058 = if_res3126;var max_lookbehind5059 = M3.regexp_max_lookbehind(orig_rx5058);if (false) {if (M3.input_port_p(buf5055)) {var if_res3127 = M3.rvoid();} else {var if_res3127 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"input-port?",buf5055);}var if_res3130 = if_res3127;} else {var or_part5060 = len5057;if (or_part5060) {var if_res3128 = or_part5060;} else {var if_res3128 = M3.input_port_p(buf5055);}if (if_res3128) {var if_res3129 = M3.rvoid();} else {var if_res3129 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"(or/c string? bytes? path? input-port?)",buf5055);}var if_res3130 = if_res3129;}if_res3130;if (M3.number_p(start5050)) {if (M3.exact_p(start5050)) {if (M3.integer_p(start5050)) {var if_res3131 = M3._gt__eq_(start5050,0);} else {var if_res3131 = false;}var if_res3132 = if_res3131;} else {var if_res3132 = false;}var if_res3133 = if_res3132;} else {var if_res3133 = false;}if (if_res3133) {var if_res3134 = M3.rvoid();} else {var if_res3134 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"exact-nonnegative-integer?",start5050);}if_res3134;var or_part5061 = M3.not(end5051);if (or_part5061) {var if_res3138 = or_part5061;} else {if (M3.number_p(end5051)) {if (M3.exact_p(end5051)) {if (M3.integer_p(end5051)) {var if_res3135 = M3._gt__eq_(end5051,0);} else {var if_res3135 = false;}var if_res3136 = if_res3135;} else {var if_res3136 = false;}var if_res3137 = if_res3136;} else {var if_res3137 = false;}var if_res3138 = if_res3137;}if (if_res3138) {var if_res3139 = M3.rvoid();} else {var if_res3139 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"(or/c exact-nonnegative-integer? #f)",end5051);}if_res3139;if (M3.bytes_p(ipre5052)) {var if_res3140 = M3.rvoid();} else {var if_res3140 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-split"),"bytes?",ipre5052);}if_res3140;var or_part5062 = M3.input_port_p(buf5055);if (or_part5062) {var if_res3142 = or_part5062;} else {if (len5057) {var if_res3141 = M3._lt__eq_(start5050,len5057);} else {var if_res3141 = false;}var if_res3142 = if_res3141;}if (if_res3142) {var if_res3143 = M3.rvoid();} else {var if_res3143 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-split"),M3.format("starting offset index out of range [0,~a]: ",len5057),start5050);}if_res3143;var or_part5063 = M3.not(end5051);if (or_part5063) {var if_res3147 = or_part5063;} else {if (M3._lt__eq_(start5050,end5051)) {var or_part5064 = M3.input_port_p(buf5055);if (or_part5064) {var if_res3145 = or_part5064;} else {if (len5057) {var if_res3144 = M3._lt__eq_(end5051,len5057);} else {var if_res3144 = false;}var if_res3145 = if_res3144;}var if_res3146 = if_res3145;} else {var if_res3146 = false;}var if_res3147 = if_res3146;}if (if_res3147) {var if_res3148 = M3.rvoid();} else {var if_res3148 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-split"),M3.format("ending offset index out of range [~a,~a]: ",start5050,len5057),end5051);}if_res3148;var loop5065 = function(acc5066, start5067, end5068, ipre5069, 0_ok_p5070) {if (0_ok_p5070) {var if_res3149 = orig_rx5058;} else {var if_res3149 = no_empty_edge_matches(orig_rx5058,M3.add1(M3.bytes_length(ipre5069)));}var rx5071 = if_res3149;if (function(leftovers5072, ms5073, acc5074) {return M3.cons(leftovers5072,acc5074);}) {var if_res3150 = M3.input_port_p(buf5055);} else {var if_res3150 = false;}if (if_res3150) {if (M3.positive_p(start5067)) {var s5076 = M3.make_bytes(4096);var loop5077 = function(n5078) {if (M3._eq_(n5078,start5067)) {var if_res3152 = M3.rvoid();} else {var m5079 = M3.read_bytes_avail_bang_(s5076,buf5055,0,M3.min(start5067-n5078,4096));if (M3.eof_object_p(m5079)) {var if_res3151 = M3.rvoid();} else {var if_res3151 = loop5077(n5078+m5079);}var if_res3152 = if_res3151;}return if_res3152;};var if_res3153 = loop5077(0);} else {var if_res3153 = M3.rvoid();}var _5075 = if_res3153;if (true) {var if_res3154 = false;} else {var if_res3154 = 0;}var discarded_by_leftovers5080 = if_res3154;if (true) {var if_res3155 = M3.open_output_bytes();} else {var if_res3155 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s5082, start5083, end5084, flush_p5085, breakable_p5086) {var c5087 = end5084-start5083;discarded_by_leftovers5080 = c5087+discarded_by_leftovers5080;return c5087;},M3.rvoid);}var spitout5081 = if_res3155;if (end5068) {var if_res3156 = end5068-start5067;} else {var if_res3156 = false;}var end5088 = if_res3156;var let_result3157 = M3.regexp_match_by_end(rx5071,buf5055,0,end5088,spitout5081,ipre5069,max_lookbehind5059);var ms5089 = let_result3157.getAt(0);var ipre5090 = let_result3157.getAt(1);if (ms5089) {var if_res3158 = M3.car(ms5089);} else {var if_res3158 = false;}var m5091 = if_res3158;if (true) {var if_res3159 = M3.get_output_bytes(spitout5081);} else {var if_res3159 = discarded_by_leftovers5080;}var discarded_by_leftovers5092 = if_res3159;if (true) {var if_res3160 = bstring_length(discarded_by_leftovers5092);} else {var if_res3160 = discarded_by_leftovers5092;}var skipped5093 = if_res3160;if (m5091) {var if_res3161 = bstring_length(m5091);} else {var if_res3161 = false;}var got5094 = if_res3161;if (end5088) {if (m5091) {var if_res3162 = end5088-skipped5093-got5094;} else {var if_res3162 = false;}var if_res3163 = if_res3162;} else {var if_res3163 = false;}var end5095 = if_res3163;if (m5091) {var 0_ok_p5096 = M3.not(M3.zero_p(got5094));var if_res3165 = loop5065((function(leftovers5097, ms5098, acc5099) {return M3.cons(leftovers5097,acc5099);})(discarded_by_leftovers5092,ms5089,acc5066),0,end5095,ipre5090,0_ok_p5096);} else {var if_res3165 = (function(acc5100, leftover5101) {if (leftover5101) {var if_res3164 = M3.cons(leftover5101,acc5100);} else {var if_res3164 = acc5100;}return if_res3164;})(acc5066,discarded_by_leftovers5092);}var if_res3172 = if_res3165;} else {if (false) {var if_res3166 = M3.regexp_match_peek_positions_by_end(rx5071,buf5055,start5067,end5068,false,ipre5069,max_lookbehind5059);} else {var if_res3166 = M3.regexp_match_positions_by_end(rx5071,buf5055,start5067,end5068,false,ipre5069,max_lookbehind5059);}var let_result3167 = if_res3166;var m5102 = let_result3167.getAt(0);var ipre5103 = let_result3167.getAt(1);if (M3.not(m5102)) {var if_res3171 = (function(acc5104, start5105, end5106) {if (end5106) {var if_res3168 = sub5054(buf5055,start5105,end5106);} else {var if_res3168 = sub5054(buf5055,start5105);}return M3.cons(if_res3168,acc5104);})(acc5066,start5067,end5068);} else {var mstart5107 = M3.caar(m5102);var mend5108 = M3.cdar(m5102);var 0_ok_p5109 = M3.not(M3._eq_(mstart5107,mend5108));if (false) {var if_res3169 = M3.input_port_p(buf5055);} else {var if_res3169 = false;}if (if_res3169) {var if_res3170 = false(function(acc5110, new_start5111, new_end5112) {return loop5065(acc5110,new_start5111,new_end5112,ipre5103,0_ok_p5109);},acc5066,start5067,end5068,m5102);} else {var if_res3170 = loop5065((function(start5113, ms5114, acc5115) {return M3.cons(sub5054(buf5055,start5113,M3.caar(ms5114)),acc5115);})(start5067,m5102,acc5066),mend5108,end5068,ipre5103,0_ok_p5109);}var if_res3171 = if_res3170;}var if_res3172 = if_res3171;}return if_res3172;};return M3.reverse(loop5065($rjs_core.Pair.Empty,start5050,end5051,ipre5052,true));};var cl3173 = function(pattern5116, string5117) {return regexp_split575039(pattern5116,string5117,false,false,false,false,false,false);};var cl3174 = function(pattern5118, string5119, start5120, end5121, ipre515122) {return regexp_split575039(pattern5118,string5119,start5120,end5121,ipre515122,true,true,true);};var cl3175 = function(pattern5123, string5124, start5125, end505126) {return regexp_split575039(pattern5123,string5124,start5125,end505126,false,true,true,false);};var cl3176 = function(pattern5127, string5128, start495129) {return regexp_split575039(pattern5127,string5128,start495129,false,false,true,false,false);};var regexp_split = $rjs_core.attachProcedureArity(function() {var fixed_lam3177 = {'2':cl3173,'5':cl3174,'4':cl3175,'3':cl3176}[arguments.length];if (fixed_lam3177!==undefined) {return fixed_lam3177.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[2,3,4,5]);var core835131 = function(pattern805132, string815133, orig_replacement825134, start745135, end755136, ipre765137, start775138, end785139, ipre795140) {var pattern5141 = pattern805132;var string5142 = string815133;var orig_replacement5143 = orig_replacement825134;if (start775138) {var if_res3178 = start745135;} else {var if_res3178 = 0;}var start5144 = if_res3178;if (end785139) {var if_res3179 = end755136;} else {var if_res3179 = false;}var end5145 = if_res3179;if (ipre795140) {var if_res3180 = ipre765137;} else {var if_res3180 = new Uint8Array([]);}var ipre5146 = if_res3180;var let_result3181 = get_buf_plus_sub(string5142,pattern5141);var buf5147 = let_result3181.getAt(0);var sub5148 = let_result3181.getAt(1);var or_part5150 = M3.string_p(pattern5141);if (or_part5150) {var if_res3182 = or_part5150;} else {var if_res3182 = M3.regexp_p(pattern5141);}if (if_res3182) {var if_res3183 = M3.string_p(string5142);} else {var if_res3183 = false;}var needs_string_p5149 = if_res3183;if (M3.not(needs_string_p5149)) {var if_res3184 = M3.string_p(orig_replacement5143);} else {var if_res3184 = false;}if (if_res3184) {var if_res3185 = M3.string__gt_bytes_by_utf_8(orig_replacement5143);} else {var if_res3185 = orig_replacement5143;}var replacement5151 = if_res3185;var check5152 = function(proc5153, args5154) {var v5155 = M3.apply(proc5153,args5154);if (needs_string_p5149) {var if_res3186 = M3.string_p(v5155);} else {var if_res3186 = M3.bytes_p(v5155);}if (if_res3186) {var if_res3188 = M3.rvoid();} else {if (needs_string_p5149) {var if_res3187 = "expected a string result: ";} else {var if_res3187 = "expected a byte string result: ";}var if_res3188 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-replace* (calling given filter procedure)"),if_res3187,v5155);}if_res3188;return v5155;};if (M3.not(M3.procedure_p(replacement5151))) {var if_res3189 = M3.regexp_match_p("/[\\&]/",replacement5151);} else {var if_res3189 = false;}var need_replac_p5156 = if_res3189;var replac5157 = function(ms5158, str5159) {if (need_replac_p5156) {if (M3.string_p(str5159)) {var if_res3205 = M3.bytes__gt_string_by_utf_8;} else {var if_res3205 = M3.values;}if (M3.string_p(str5159)) {var if_res3190 = M3.string__gt_bytes_by_utf_8(str5159);} else {var if_res3190 = str5159;}var str5160 = if_res3190;var get_match5161 = function(n5162) {if (M3._lt_(n5162,M3.length(ms5158))) {var p5163 = M3.list_ref(ms5158,n5162);if (M3.pair_p(p5163)) {var if_res3191 = sub5148(buf5147,M3.car(p5163),M3.cdr(p5163));} else {var if_res3191 = p5163;}var s5164 = if_res3191;if (M3.string_p(s5164)) {var if_res3192 = M3.string__gt_bytes_by_utf_8(s5164);} else {var if_res3192 = s5164;}var if_res3193 = if_res3192;} else {var if_res3193 = new Uint8Array([]);}return if_res3193;};var loop5165 = function(pos5166) {var m5167 = M3.regexp_match_positions("/[\\&]/",str5160,pos5166);if (m5167) {var temp3203 = M3.subbytes(str5160,pos5166,M3.caar(m5167));if (M3.equal_p(M3.char__gt_integer("&"),M3.bytes_ref(str5160,M3.caar(m5167)))) {var if_res3202 = M3.cons(get_match5161(0),loop5165(M3.cdar(m5167)));} else {if (M3._eq_(M3.cdar(m5167),M3.bytes_length(str5160))) {var if_res3201 = M3.list(get_match5161(0));} else {var next5169 = M3.bytes_ref(str5160,M3.cdar(m5167));if (M3.equal_p(M3.char__gt_integer("&"),next5169)) {var if_res3194 = new Uint8Array([38]);} else {var if_res3194 = false;}var or_part5170 = if_res3194;if (or_part5170) {var if_res3198 = or_part5170;} else {if (M3.equal_p(M3.char__gt_integer("\\"),next5169)) {var if_res3195 = new Uint8Array([92]);} else {var if_res3195 = false;}var or_part5171 = if_res3195;if (or_part5171) {var if_res3197 = or_part5171;} else {if (M3.equal_p(M3.char__gt_integer("$"),next5169)) {var if_res3196 = new Uint8Array([]);} else {var if_res3196 = false;}var if_res3197 = if_res3196;}var if_res3198 = if_res3197;}var c523915168 = if_res3198;if (c523915168) {var if_res3200 = (function(s5172) {return M3.cons(s5172,loop5165(M3.add1(M3.cdar(m5167))));})(c523915168);} else {var n5173 = M3.regexp_match("/^[0-9]+/",str5160,M3.cdar(m5167));if (n5173) {var if_res3199 = M3.cons(get_match5161(M3.string__gt_number(M3.bytes__gt_string_by_utf_8(M3.car(n5173)))),loop5165(M3.cdar(m5167)+M3.bytes_length(M3.car(n5173))));} else {var if_res3199 = M3.cons(get_match5161(0),loop5165(M3.cdar(m5167)));}var if_res3200 = if_res3199;}var if_res3201 = if_res3200;}var if_res3202 = if_res3201;}var if_res3204 = M3.cons(temp3203,if_res3202);} else {var if_res3204 = M3.list(M3.subbytes(str5160,pos5166));}return if_res3204;};var if_res3206 = if_res3205(M3.apply(M3.bytes_append,loop5165(0)));} else {var if_res3206 = str5159;}return if_res3206;};var or_part5174 = M3.string_p(pattern5141);if (or_part5174) {var if_res3209 = or_part5174;} else {var or_part5175 = M3.bytes_p(pattern5141);if (or_part5175) {var if_res3208 = or_part5175;} else {var or_part5176 = M3.regexp_p(pattern5141);if (or_part5176) {var if_res3207 = or_part5176;} else {var if_res3207 = M3.byte_regexp_p(pattern5141);}var if_res3208 = if_res3207;}var if_res3209 = if_res3208;}if (if_res3209) {var or_part5177 = M3.string_p(string5142);if (or_part5177) {var if_res3210 = or_part5177;} else {var if_res3210 = M3.bytes_p(string5142);}if (if_res3210) {var if_res3211 = M3.rvoid();} else {var if_res3211 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"(or/c string? bytes?)",string5142);}if_res3211;var or_part5178 = M3.string_p(replacement5151);if (or_part5178) {var if_res3213 = or_part5178;} else {var or_part5179 = M3.bytes_p(replacement5151);if (or_part5179) {var if_res3212 = or_part5179;} else {var if_res3212 = M3.procedure_p(replacement5151);}var if_res3213 = if_res3212;}if (if_res3213) {var if_res3214 = M3.rvoid();} else {var if_res3214 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"(or/c string? bytes? procedure?)",replacement5151);}if_res3214;if (needs_string_p5149) {var if_res3215 = M3.bytes_p(replacement5151);} else {var if_res3215 = false;}if (if_res3215) {var if_res3216 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-replace*"),"cannot replace a string with a byte string: ",replacement5151);} else {var if_res3216 = M3.rvoid();}var if_res3217 = if_res3216;} else {var if_res3217 = M3.rvoid();}if_res3217;var let_result3218 = M3.values();if (M3.path_p(buf5147)) {var or_part5182 = M3.string_p(pattern5141);if (or_part5182) {var if_res3219 = or_part5182;} else {var if_res3219 = M3.regexp_p(pattern5141);}if (if_res3219) {var if_res3220 = M3.path__gt_string(buf5147);} else {var if_res3220 = M3.path__gt_bytes(buf5147);}var if_res3221 = if_res3220;} else {var if_res3221 = buf5147;}var buf5181 = if_res3221;if (M3.string_p(buf5181)) {var if_res3223 = M3.string_length(buf5181);} else {if (M3.bytes_p(buf5181)) {var if_res3222 = M3.bytes_length(buf5181);} else {var if_res3222 = false;}var if_res3223 = if_res3222;}var len5183 = if_res3223;if (M3.bytes_p(pattern5141)) {var if_res3227 = M3.byte_regexp(pattern5141);} else {if (M3.string_p(pattern5141)) {var if_res3226 = M3.regexp(pattern5141);} else {if (M3.regexp_p(pattern5141)) {var if_res3225 = pattern5141;} else {if (M3.byte_regexp_p(pattern5141)) {var if_res3224 = pattern5141;} else {var if_res3224 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern5141);}var if_res3225 = if_res3224;}var if_res3226 = if_res3225;}var if_res3227 = if_res3226;}var orig_rx5184 = if_res3227;var max_lookbehind5185 = M3.regexp_max_lookbehind(orig_rx5184);if (false) {if (M3.input_port_p(buf5181)) {var if_res3228 = M3.rvoid();} else {var if_res3228 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"input-port?",buf5181);}var if_res3231 = if_res3228;} else {var or_part5186 = len5183;if (or_part5186) {var if_res3229 = or_part5186;} else {var if_res3229 = M3.input_port_p(buf5181);}if (if_res3229) {var if_res3230 = M3.rvoid();} else {var if_res3230 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"(or/c string? bytes? path? input-port?)",buf5181);}var if_res3231 = if_res3230;}if_res3231;if (M3.number_p(start5144)) {if (M3.exact_p(start5144)) {if (M3.integer_p(start5144)) {var if_res3232 = M3._gt__eq_(start5144,0);} else {var if_res3232 = false;}var if_res3233 = if_res3232;} else {var if_res3233 = false;}var if_res3234 = if_res3233;} else {var if_res3234 = false;}if (if_res3234) {var if_res3235 = M3.rvoid();} else {var if_res3235 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"exact-nonnegative-integer?",start5144);}if_res3235;var or_part5187 = M3.not(end5145);if (or_part5187) {var if_res3239 = or_part5187;} else {if (M3.number_p(end5145)) {if (M3.exact_p(end5145)) {if (M3.integer_p(end5145)) {var if_res3236 = M3._gt__eq_(end5145,0);} else {var if_res3236 = false;}var if_res3237 = if_res3236;} else {var if_res3237 = false;}var if_res3238 = if_res3237;} else {var if_res3238 = false;}var if_res3239 = if_res3238;}if (if_res3239) {var if_res3240 = M3.rvoid();} else {var if_res3240 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"(or/c exact-nonnegative-integer? #f)",end5145);}if_res3240;if (M3.bytes_p(ipre5146)) {var if_res3241 = M3.rvoid();} else {var if_res3241 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-replace*"),"bytes?",ipre5146);}if_res3241;var or_part5188 = M3.input_port_p(buf5181);if (or_part5188) {var if_res3243 = or_part5188;} else {if (len5183) {var if_res3242 = M3._lt__eq_(start5144,len5183);} else {var if_res3242 = false;}var if_res3243 = if_res3242;}if (if_res3243) {var if_res3244 = M3.rvoid();} else {var if_res3244 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-replace*"),M3.format("starting offset index out of range [0,~a]: ",len5183),start5144);}if_res3244;var or_part5189 = M3.not(end5145);if (or_part5189) {var if_res3248 = or_part5189;} else {if (M3._lt__eq_(start5144,end5145)) {var or_part5190 = M3.input_port_p(buf5181);if (or_part5190) {var if_res3246 = or_part5190;} else {if (len5183) {var if_res3245 = M3._lt__eq_(end5145,len5183);} else {var if_res3245 = false;}var if_res3246 = if_res3245;}var if_res3247 = if_res3246;} else {var if_res3247 = false;}var if_res3248 = if_res3247;}if (if_res3248) {var if_res3249 = M3.rvoid();} else {var if_res3249 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-replace*"),M3.format("ending offset index out of range [~a,~a]: ",start5144,len5183),end5145);}if_res3249;var loop5191 = function(acc5192, start5193, end5194, ipre5195, 0_ok_p5196) {if (0_ok_p5196) {var if_res3250 = orig_rx5184;} else {var if_res3250 = no_empty_edge_matches(orig_rx5184,M3.add1(M3.bytes_length(ipre5195)));}var rx5197 = if_res3250;if (false) {var if_res3251 = M3.input_port_p(buf5181);} else {var if_res3251 = false;}if (if_res3251) {if (M3.positive_p(start5193)) {var s5199 = M3.make_bytes(4096);var loop5200 = function(n5201) {if (M3._eq_(n5201,start5193)) {var if_res3253 = M3.rvoid();} else {var m5202 = M3.read_bytes_avail_bang_(s5199,buf5181,0,M3.min(start5193-n5201,4096));if (M3.eof_object_p(m5202)) {var if_res3252 = M3.rvoid();} else {var if_res3252 = loop5200(n5201+m5202);}var if_res3253 = if_res3252;}return if_res3253;};var if_res3254 = loop5200(0);} else {var if_res3254 = M3.rvoid();}var _5198 = if_res3254;if (true) {var if_res3255 = false;} else {var if_res3255 = 0;}var discarded_by_leftovers5203 = if_res3255;if (true) {var if_res3256 = M3.open_output_bytes();} else {var if_res3256 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s5205, start5206, end5207, flush_p5208, breakable_p5209) {var c5210 = end5207-start5206;discarded_by_leftovers5203 = c5210+discarded_by_leftovers5203;return c5210;},M3.rvoid);}var spitout5204 = if_res3256;if (end5194) {var if_res3257 = end5194-start5193;} else {var if_res3257 = false;}var end5211 = if_res3257;var let_result3258 = M3.regexp_match_by_end(rx5197,buf5181,0,end5211,spitout5204,ipre5195,max_lookbehind5185);var ms5212 = let_result3258.getAt(0);var ipre5213 = let_result3258.getAt(1);if (ms5212) {var if_res3259 = M3.car(ms5212);} else {var if_res3259 = false;}var m5214 = if_res3259;if (true) {var if_res3260 = M3.get_output_bytes(spitout5204);} else {var if_res3260 = discarded_by_leftovers5203;}var discarded_by_leftovers5215 = if_res3260;if (true) {var if_res3261 = bstring_length(discarded_by_leftovers5215);} else {var if_res3261 = discarded_by_leftovers5215;}var skipped5216 = if_res3261;if (m5214) {var if_res3262 = bstring_length(m5214);} else {var if_res3262 = false;}var got5217 = if_res3262;if (end5211) {if (m5214) {var if_res3263 = end5211-skipped5216-got5217;} else {var if_res3263 = false;}var if_res3264 = if_res3263;} else {var if_res3264 = false;}var end5218 = if_res3264;if (m5214) {var 0_ok_p5219 = M3.not(M3.zero_p(got5217));var if_res3265 = loop5191(false(discarded_by_leftovers5215,ms5212,acc5192),0,end5218,ipre5213,0_ok_p5219);} else {var if_res3265 = false(acc5192,discarded_by_leftovers5215);}var if_res3281 = if_res3265;} else {if (false) {var if_res3266 = M3.regexp_match_peek_positions_by_end(rx5197,buf5181,start5193,end5194,false,ipre5195,max_lookbehind5185);} else {var if_res3266 = M3.regexp_match_positions_by_end(rx5197,buf5181,start5193,end5194,false,ipre5195,max_lookbehind5185);}var let_result3267 = if_res3266;var m5220 = let_result3267.getAt(0);var ipre5221 = let_result3267.getAt(1);if (M3.not(m5220)) {var if_res3280 = (function(acc5222, start5223, end5224) {if (end5224) {var if_res3268 = sub5148(buf5181,start5223,end5224);} else {var if_res3268 = sub5148(buf5181,start5223);}return M3.cons(if_res3268,acc5222);})(acc5192,start5193,end5194);} else {var mstart5225 = M3.caar(m5220);var mend5226 = M3.cdar(m5220);var 0_ok_p5227 = M3.not(M3._eq_(mstart5225,mend5226));if (false) {var if_res3269 = M3.input_port_p(buf5181);} else {var if_res3269 = false;}if (if_res3269) {var if_res3279 = false(function(acc5228, new_start5229, new_end5230) {return loop5191(acc5228,new_start5229,new_end5230,ipre5221,0_ok_p5227);},acc5192,start5193,end5194,m5220);} else {var if_res3279 = loop5191((function(start5231, ms5232, acc5233) {if (M3.procedure_p(replacement5151)) {var let_result3270 = M5.__rjs_quoted__.make_sequence($rjs_core.Pair.makeList($rjs_core.Symbol.make("m")),ms5232);var pos__gt_vals5234 = let_result3270.getAt(0);var pos_next5235 = let_result3270.getAt(1);var init5236 = let_result3270.getAt(2);var pos_cont_p5237 = let_result3270.getAt(3);var val_cont_p5238 = let_result3270.getAt(4);var all_cont_p5239 = let_result3270.getAt(5);M3.rvoid();var for_loop5240 = function(fold_var5241, pos5242) {if (pos_cont_p5237) {var if_res3271 = pos_cont_p5237(pos5242);} else {var if_res3271 = true;}if (if_res3271) {var m5243 = pos__gt_vals5234(pos5242);if (val_cont_p5238) {var if_res3272 = val_cont_p5238(m5243);} else {var if_res3272 = true;}if (if_res3272) {var fold_var5245 = fold_var5241;if (m5243) {var if_res3273 = sub5148(buf5181,M3.car(m5243),M3.cdr(m5243));} else {var if_res3273 = false;}var fold_var5246 = M3.cons(if_res3273,fold_var5245);var fold_var5244 = M3.values(fold_var5246);if (all_cont_p5239) {var if_res3274 = all_cont_p5239(pos5242,m5243);} else {var if_res3274 = true;}if (if_res3274) {var if_res3275 = for_loop5240(fold_var5244,pos_next5235(pos5242));} else {var if_res3275 = fold_var5244;}var if_res3276 = if_res3275;} else {var if_res3276 = fold_var5241;}var if_res3277 = if_res3276;} else {var if_res3277 = fold_var5241;}return if_res3277;};var if_res3278 = check5152(replacement5151,M4.alt_reverse(for_loop5240(M3.rnull,init5236)));} else {var if_res3278 = replac5157(ms5232,replacement5151);}return M3.list_times_(if_res3278,sub5148(buf5181,start5231,M3.caar(ms5232)),acc5233);})(start5193,m5220,acc5192),mend5226,end5194,ipre5221,0_ok_p5227);}var if_res3280 = if_res3279;}var if_res3281 = if_res3280;}return if_res3281;};var r5180 = M3.reverse(loop5191($rjs_core.Pair.Empty,start5144,end5145,ipre5146,true));if (M3.bytes_p(buf5147)) {var if_res3285 = M3.bytes_append;} else {var if_res3285 = M3.string_append;}if (M3._eq_(start5144,0)) {var if_res3282 = M3.not(end5145);} else {var if_res3282 = false;}if (if_res3282) {var if_res3284 = r5180;} else {if (M3.not(end5145)) {var if_res3283 = M3.cons(sub5148(string5142,0,start5144),r5180);} else {var if_res3283 = M3.list_times_(sub5148(string5142,0,start5144),M1.__rjs_quoted__.qq_append(r5180,M3.list(sub5148(string5142,end5145))));}var if_res3284 = if_res3283;}return M3.apply(if_res3285,if_res3284);};var cl3286 = function(pattern5247, string5248, orig_replacement5249) {return core835131(pattern5247,string5248,orig_replacement5249,false,false,false,false,false,false);};var cl3287 = function(pattern5250, string5251, orig_replacement5252, start5253, end5254, ipre765255) {return core835131(pattern5250,string5251,orig_replacement5252,start5253,end5254,ipre765255,true,true,true);};var cl3288 = function(pattern5256, string5257, orig_replacement5258, start5259, end755260) {return core835131(pattern5256,string5257,orig_replacement5258,start5259,end755260,false,true,true,false);};var cl3289 = function(pattern5261, string5262, orig_replacement5263, start745264) {return core835131(pattern5261,string5262,orig_replacement5263,start745264,false,false,true,false,false);};var regexp_replace_times_5130 = $rjs_core.attachProcedureArity(function() {var fixed_lam3290 = {'3':cl3286,'6':cl3287,'5':cl3288,'4':cl3289}[arguments.length];if (fixed_lam3290!==undefined) {return fixed_lam3290.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[3,4,5,6]);var _regexp_replace_times_ = regexp_replace_times_5130;var regexp_match_times_71 = function(gap_select_p605265, gap_select_p625266, match_select595267, match_select615268, pattern695269, string705270, start635271, end645272, ipre655273, start665274, end675275, ipre685276) {var pattern5277 = pattern695269;var string5278 = string705270;if (start665274) {var if_res3291 = start635271;} else {var if_res3291 = 0;}var start5279 = if_res3291;if (end675275) {var if_res3292 = end645272;} else {var if_res3292 = false;}var end5280 = if_res3292;if (ipre685276) {var if_res3293 = ipre655273;} else {var if_res3293 = new Uint8Array([]);}var ipre5281 = if_res3293;if (match_select615268) {var if_res3294 = match_select595267;} else {var if_res3294 = M3.car;}var match_select5282 = if_res3294;if (gap_select_p625266) {var if_res3295 = gap_select_p605265;} else {var if_res3295 = false;}var gap_select5283 = if_res3295;if (M3.not(match_select5282)) {var if_res3296 = M3.not(gap_select5283);} else {var if_res3296 = false;}if (if_res3296) {var if_res3477 = M3.raise(M3.__rjs_quoted__.kernel_exn_fail_contract("regexp-match*: one of `match-select' or `gap-select' must be non-#f",M3.current_continuation_marks()));} else {if (M3.not(match_select5282)) {var if_res3476 = regexp_split(pattern5277,string5278,start5279,end5280,ipre5281);} else {if (M3.not(M3.procedure_p(match_select5282))) {var if_res3475 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"(or/c procedure? #f)",match_select5282);} else {if (M3.not(M3.eq_p(match_select5282,M3.car))) {var let_result3297 = get_buf_plus_sub(string5278,pattern5277);var buf5284 = let_result3297.getAt(0);var sub5285 = let_result3297.getAt(1);if (M3.path_p(buf5284)) {var or_part5287 = M3.string_p(pattern5277);if (or_part5287) {var if_res3298 = or_part5287;} else {var if_res3298 = M3.regexp_p(pattern5277);}if (if_res3298) {var if_res3299 = M3.path__gt_string(buf5284);} else {var if_res3299 = M3.path__gt_bytes(buf5284);}var if_res3300 = if_res3299;} else {var if_res3300 = buf5284;}var buf5286 = if_res3300;if (M3.string_p(buf5286)) {var if_res3302 = M3.string_length(buf5286);} else {if (M3.bytes_p(buf5286)) {var if_res3301 = M3.bytes_length(buf5286);} else {var if_res3301 = false;}var if_res3302 = if_res3301;}var len5288 = if_res3302;if (M3.bytes_p(pattern5277)) {var if_res3306 = M3.byte_regexp(pattern5277);} else {if (M3.string_p(pattern5277)) {var if_res3305 = M3.regexp(pattern5277);} else {if (M3.regexp_p(pattern5277)) {var if_res3304 = pattern5277;} else {if (M3.byte_regexp_p(pattern5277)) {var if_res3303 = pattern5277;} else {var if_res3303 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c regexp? byte-regexp? string? bytes?)",pattern5277);}var if_res3304 = if_res3303;}var if_res3305 = if_res3304;}var if_res3306 = if_res3305;}var orig_rx5289 = if_res3306;var max_lookbehind5290 = M3.regexp_max_lookbehind(orig_rx5289);if (false) {if (M3.input_port_p(buf5286)) {var if_res3307 = M3.rvoid();} else {var if_res3307 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"input-port?",buf5286);}var if_res3310 = if_res3307;} else {var or_part5291 = len5288;if (or_part5291) {var if_res3308 = or_part5291;} else {var if_res3308 = M3.input_port_p(buf5286);}if (if_res3308) {var if_res3309 = M3.rvoid();} else {var if_res3309 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c string? bytes? path? input-port?)",buf5286);}var if_res3310 = if_res3309;}if_res3310;if (M3.number_p(start5279)) {if (M3.exact_p(start5279)) {if (M3.integer_p(start5279)) {var if_res3311 = M3._gt__eq_(start5279,0);} else {var if_res3311 = false;}var if_res3312 = if_res3311;} else {var if_res3312 = false;}var if_res3313 = if_res3312;} else {var if_res3313 = false;}if (if_res3313) {var if_res3314 = M3.rvoid();} else {var if_res3314 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"exact-nonnegative-integer?",start5279);}if_res3314;var or_part5292 = M3.not(end5280);if (or_part5292) {var if_res3318 = or_part5292;} else {if (M3.number_p(end5280)) {if (M3.exact_p(end5280)) {if (M3.integer_p(end5280)) {var if_res3315 = M3._gt__eq_(end5280,0);} else {var if_res3315 = false;}var if_res3316 = if_res3315;} else {var if_res3316 = false;}var if_res3317 = if_res3316;} else {var if_res3317 = false;}var if_res3318 = if_res3317;}if (if_res3318) {var if_res3319 = M3.rvoid();} else {var if_res3319 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c exact-nonnegative-integer? #f)",end5280);}if_res3319;if (M3.bytes_p(ipre5281)) {var if_res3320 = M3.rvoid();} else {var if_res3320 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"bytes?",ipre5281);}if_res3320;var or_part5293 = M3.input_port_p(buf5286);if (or_part5293) {var if_res3322 = or_part5293;} else {if (len5288) {var if_res3321 = M3._lt__eq_(start5279,len5288);} else {var if_res3321 = false;}var if_res3322 = if_res3321;}if (if_res3322) {var if_res3323 = M3.rvoid();} else {var if_res3323 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-explode"),M3.format("starting offset index out of range [0,~a]: ",len5288),start5279);}if_res3323;var or_part5294 = M3.not(end5280);if (or_part5294) {var if_res3327 = or_part5294;} else {if (M3._lt__eq_(start5279,end5280)) {var or_part5295 = M3.input_port_p(buf5286);if (or_part5295) {var if_res3325 = or_part5295;} else {if (len5288) {var if_res3324 = M3._lt__eq_(end5280,len5288);} else {var if_res3324 = false;}var if_res3325 = if_res3324;}var if_res3326 = if_res3325;} else {var if_res3326 = false;}var if_res3327 = if_res3326;}if (if_res3327) {var if_res3328 = M3.rvoid();} else {var if_res3328 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-explode"),M3.format("ending offset index out of range [~a,~a]: ",start5279,len5288),end5280);}if_res3328;var loop5296 = function(acc5297, start5298, end5299, ipre5300, 0_ok_p5301) {if (0_ok_p5301) {var if_res3329 = orig_rx5289;} else {var if_res3329 = no_empty_edge_matches(orig_rx5289,M3.add1(M3.bytes_length(ipre5300)));}var rx5302 = if_res3329;if (function(leftovers5303, ms5304, acc5305) {var temp3331 = match_select5282(ms5304);if (gap_select5283) {var if_res3330 = M3.cons(leftovers5303,acc5305);} else {var if_res3330 = acc5305;}return M3.cons(temp3331,if_res3330);}) {var if_res3332 = M3.input_port_p(buf5286);} else {var if_res3332 = false;}if (if_res3332) {if (M3.positive_p(start5298)) {var s5307 = M3.make_bytes(4096);var loop5308 = function(n5309) {if (M3._eq_(n5309,start5298)) {var if_res3334 = M3.rvoid();} else {var m5310 = M3.read_bytes_avail_bang_(s5307,buf5286,0,M3.min(start5298-n5309,4096));if (M3.eof_object_p(m5310)) {var if_res3333 = M3.rvoid();} else {var if_res3333 = loop5308(n5309+m5310);}var if_res3334 = if_res3333;}return if_res3334;};var if_res3335 = loop5308(0);} else {var if_res3335 = M3.rvoid();}var _5306 = if_res3335;if (gap_select5283) {var if_res3336 = false;} else {var if_res3336 = 0;}var discarded_by_leftovers5311 = if_res3336;if (gap_select5283) {var if_res3337 = M3.open_output_bytes();} else {var if_res3337 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s5313, start5314, end5315, flush_p5316, breakable_p5317) {var c5318 = end5315-start5314;discarded_by_leftovers5311 = c5318+discarded_by_leftovers5311;return c5318;},M3.rvoid);}var spitout5312 = if_res3337;if (end5299) {var if_res3338 = end5299-start5298;} else {var if_res3338 = false;}var end5319 = if_res3338;var let_result3339 = M3.regexp_match_by_end(rx5302,buf5286,0,end5319,spitout5312,ipre5300,max_lookbehind5290);var ms5320 = let_result3339.getAt(0);var ipre5321 = let_result3339.getAt(1);if (ms5320) {var if_res3340 = M3.car(ms5320);} else {var if_res3340 = false;}var m5322 = if_res3340;if (gap_select5283) {var if_res3341 = M3.get_output_bytes(spitout5312);} else {var if_res3341 = discarded_by_leftovers5311;}var discarded_by_leftovers5323 = if_res3341;if (gap_select5283) {var if_res3342 = bstring_length(discarded_by_leftovers5323);} else {var if_res3342 = discarded_by_leftovers5323;}var skipped5324 = if_res3342;if (m5322) {var if_res3343 = bstring_length(m5322);} else {var if_res3343 = false;}var got5325 = if_res3343;if (end5319) {if (m5322) {var if_res3344 = end5319-skipped5324-got5325;} else {var if_res3344 = false;}var if_res3345 = if_res3344;} else {var if_res3345 = false;}var end5326 = if_res3345;if (m5322) {var 0_ok_p5327 = M3.not(M3.zero_p(got5325));var if_res3350 = loop5296((function(leftovers5328, ms5329, acc5330) {var temp3347 = match_select5282(ms5329);if (gap_select5283) {var if_res3346 = M3.cons(leftovers5328,acc5330);} else {var if_res3346 = acc5330;}return M3.cons(temp3347,if_res3346);})(discarded_by_leftovers5323,ms5320,acc5297),0,end5326,ipre5321,0_ok_p5327);} else {var if_res3350 = (function(acc5331, leftover5332) {if (gap_select5283) {var if_res3348 = leftover5332;} else {var if_res3348 = false;}if (if_res3348) {var if_res3349 = M3.cons(leftover5332,acc5331);} else {var if_res3349 = acc5331;}return if_res3349;})(acc5297,discarded_by_leftovers5323);}var if_res3362 = if_res3350;} else {if (false) {var if_res3351 = M3.regexp_match_peek_positions_by_end(rx5302,buf5286,start5298,end5299,false,ipre5300,max_lookbehind5290);} else {var if_res3351 = M3.regexp_match_positions_by_end(rx5302,buf5286,start5298,end5299,false,ipre5300,max_lookbehind5290);}var let_result3352 = if_res3351;var m5333 = let_result3352.getAt(0);var ipre5334 = let_result3352.getAt(1);if (M3.not(m5333)) {var if_res3361 = (function(acc5335, start5336, end5337) {if (gap_select5283) {if (end5337) {var if_res3353 = sub5285(buf5286,start5336,end5337);} else {var if_res3353 = sub5285(buf5286,start5336);}var if_res3354 = M3.cons(if_res3353,acc5335);} else {var if_res3354 = acc5335;}return if_res3354;})(acc5297,start5298,end5299);} else {var mstart5338 = M3.caar(m5333);var mend5339 = M3.cdar(m5333);var 0_ok_p5340 = M3.not(M3._eq_(mstart5338,mend5339));if (false) {var if_res3355 = M3.input_port_p(buf5286);} else {var if_res3355 = false;}if (if_res3355) {var if_res3360 = false(function(acc5341, new_start5342, new_end5343) {return loop5296(acc5341,new_start5342,new_end5343,ipre5334,0_ok_p5340);},acc5297,start5298,end5299,m5333);} else {var if_res3360 = loop5296((function(start5344, ms5345, acc5346) {var s5347 = match_select5282(ms5345);if (M3.not(M3.pair_p(s5347))) {var if_res3359 = s5347;} else {if (M3.integer_p(M3.car(s5347))) {var if_res3358 = sub5285(buf5286,M3.car(s5347),M3.cdr(s5347));} else {var if_res3358 = M2.map(function(m5348) {if (m5348) {var if_res3357 = sub5285(buf5286,M3.car(m5348),M3.cdr(m5348));} else {var if_res3357 = false;}return if_res3357;},s5347);}var if_res3359 = if_res3358;}if (gap_select5283) {var if_res3356 = M3.cons(sub5285(buf5286,start5344,M3.caar(ms5345)),acc5346);} else {var if_res3356 = acc5346;}return M3.cons(if_res3359,if_res3356);})(start5298,m5333,acc5297),mend5339,end5299,ipre5334,0_ok_p5340);}var if_res3361 = if_res3360;}var if_res3362 = if_res3361;}return if_res3362;};var if_res3474 = M3.reverse(loop5296($rjs_core.Pair.Empty,start5279,end5280,ipre5281,true));} else {if (gap_select5283) {var let_result3363 = get_buf_plus_sub(string5278,pattern5277);var buf5349 = let_result3363.getAt(0);var sub5350 = let_result3363.getAt(1);if (M3.path_p(buf5349)) {var or_part5352 = M3.string_p(pattern5277);if (or_part5352) {var if_res3364 = or_part5352;} else {var if_res3364 = M3.regexp_p(pattern5277);}if (if_res3364) {var if_res3365 = M3.path__gt_string(buf5349);} else {var if_res3365 = M3.path__gt_bytes(buf5349);}var if_res3366 = if_res3365;} else {var if_res3366 = buf5349;}var buf5351 = if_res3366;if (M3.string_p(buf5351)) {var if_res3368 = M3.string_length(buf5351);} else {if (M3.bytes_p(buf5351)) {var if_res3367 = M3.bytes_length(buf5351);} else {var if_res3367 = false;}var if_res3368 = if_res3367;}var len5353 = if_res3368;if (M3.bytes_p(pattern5277)) {var if_res3372 = M3.byte_regexp(pattern5277);} else {if (M3.string_p(pattern5277)) {var if_res3371 = M3.regexp(pattern5277);} else {if (M3.regexp_p(pattern5277)) {var if_res3370 = pattern5277;} else {if (M3.byte_regexp_p(pattern5277)) {var if_res3369 = pattern5277;} else {var if_res3369 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c regexp? byte-regexp? string? bytes?)",pattern5277);}var if_res3370 = if_res3369;}var if_res3371 = if_res3370;}var if_res3372 = if_res3371;}var orig_rx5354 = if_res3372;var max_lookbehind5355 = M3.regexp_max_lookbehind(orig_rx5354);if (false) {if (M3.input_port_p(buf5351)) {var if_res3373 = M3.rvoid();} else {var if_res3373 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"input-port?",buf5351);}var if_res3376 = if_res3373;} else {var or_part5356 = len5353;if (or_part5356) {var if_res3374 = or_part5356;} else {var if_res3374 = M3.input_port_p(buf5351);}if (if_res3374) {var if_res3375 = M3.rvoid();} else {var if_res3375 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c string? bytes? path? input-port?)",buf5351);}var if_res3376 = if_res3375;}if_res3376;if (M3.number_p(start5279)) {if (M3.exact_p(start5279)) {if (M3.integer_p(start5279)) {var if_res3377 = M3._gt__eq_(start5279,0);} else {var if_res3377 = false;}var if_res3378 = if_res3377;} else {var if_res3378 = false;}var if_res3379 = if_res3378;} else {var if_res3379 = false;}if (if_res3379) {var if_res3380 = M3.rvoid();} else {var if_res3380 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"exact-nonnegative-integer?",start5279);}if_res3380;var or_part5357 = M3.not(end5280);if (or_part5357) {var if_res3384 = or_part5357;} else {if (M3.number_p(end5280)) {if (M3.exact_p(end5280)) {if (M3.integer_p(end5280)) {var if_res3381 = M3._gt__eq_(end5280,0);} else {var if_res3381 = false;}var if_res3382 = if_res3381;} else {var if_res3382 = false;}var if_res3383 = if_res3382;} else {var if_res3383 = false;}var if_res3384 = if_res3383;}if (if_res3384) {var if_res3385 = M3.rvoid();} else {var if_res3385 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"(or/c exact-nonnegative-integer? #f)",end5280);}if_res3385;if (M3.bytes_p(ipre5281)) {var if_res3386 = M3.rvoid();} else {var if_res3386 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-explode"),"bytes?",ipre5281);}if_res3386;var or_part5358 = M3.input_port_p(buf5351);if (or_part5358) {var if_res3388 = or_part5358;} else {if (len5353) {var if_res3387 = M3._lt__eq_(start5279,len5353);} else {var if_res3387 = false;}var if_res3388 = if_res3387;}if (if_res3388) {var if_res3389 = M3.rvoid();} else {var if_res3389 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-explode"),M3.format("starting offset index out of range [0,~a]: ",len5353),start5279);}if_res3389;var or_part5359 = M3.not(end5280);if (or_part5359) {var if_res3393 = or_part5359;} else {if (M3._lt__eq_(start5279,end5280)) {var or_part5360 = M3.input_port_p(buf5351);if (or_part5360) {var if_res3391 = or_part5360;} else {if (len5353) {var if_res3390 = M3._lt__eq_(end5280,len5353);} else {var if_res3390 = false;}var if_res3391 = if_res3390;}var if_res3392 = if_res3391;} else {var if_res3392 = false;}var if_res3393 = if_res3392;}if (if_res3393) {var if_res3394 = M3.rvoid();} else {var if_res3394 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-explode"),M3.format("ending offset index out of range [~a,~a]: ",start5279,len5353),end5280);}if_res3394;var loop5361 = function(acc5362, start5363, end5364, ipre5365, 0_ok_p5366) {if (0_ok_p5366) {var if_res3395 = orig_rx5354;} else {var if_res3395 = no_empty_edge_matches(orig_rx5354,M3.add1(M3.bytes_length(ipre5365)));}var rx5367 = if_res3395;if (function(leftovers5368, ms5369, acc5370) {return M3.cons(M3.car(ms5369),M3.cons(leftovers5368,acc5370));}) {var if_res3396 = M3.input_port_p(buf5351);} else {var if_res3396 = false;}if (if_res3396) {if (M3.positive_p(start5363)) {var s5372 = M3.make_bytes(4096);var loop5373 = function(n5374) {if (M3._eq_(n5374,start5363)) {var if_res3398 = M3.rvoid();} else {var m5375 = M3.read_bytes_avail_bang_(s5372,buf5351,0,M3.min(start5363-n5374,4096));if (M3.eof_object_p(m5375)) {var if_res3397 = M3.rvoid();} else {var if_res3397 = loop5373(n5374+m5375);}var if_res3398 = if_res3397;}return if_res3398;};var if_res3399 = loop5373(0);} else {var if_res3399 = M3.rvoid();}var _5371 = if_res3399;if (gap_select5283) {var if_res3400 = false;} else {var if_res3400 = 0;}var discarded_by_leftovers5376 = if_res3400;if (gap_select5283) {var if_res3401 = M3.open_output_bytes();} else {var if_res3401 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s5378, start5379, end5380, flush_p5381, breakable_p5382) {var c5383 = end5380-start5379;discarded_by_leftovers5376 = c5383+discarded_by_leftovers5376;return c5383;},M3.rvoid);}var spitout5377 = if_res3401;if (end5364) {var if_res3402 = end5364-start5363;} else {var if_res3402 = false;}var end5384 = if_res3402;var let_result3403 = M3.regexp_match_by_end(rx5367,buf5351,0,end5384,spitout5377,ipre5365,max_lookbehind5355);var ms5385 = let_result3403.getAt(0);var ipre5386 = let_result3403.getAt(1);if (ms5385) {var if_res3404 = M3.car(ms5385);} else {var if_res3404 = false;}var m5387 = if_res3404;if (gap_select5283) {var if_res3405 = M3.get_output_bytes(spitout5377);} else {var if_res3405 = discarded_by_leftovers5376;}var discarded_by_leftovers5388 = if_res3405;if (gap_select5283) {var if_res3406 = bstring_length(discarded_by_leftovers5388);} else {var if_res3406 = discarded_by_leftovers5388;}var skipped5389 = if_res3406;if (m5387) {var if_res3407 = bstring_length(m5387);} else {var if_res3407 = false;}var got5390 = if_res3407;if (end5384) {if (m5387) {var if_res3408 = end5384-skipped5389-got5390;} else {var if_res3408 = false;}var if_res3409 = if_res3408;} else {var if_res3409 = false;}var end5391 = if_res3409;if (m5387) {var 0_ok_p5392 = M3.not(M3.zero_p(got5390));var if_res3411 = loop5361((function(leftovers5393, ms5394, acc5395) {return M3.cons(M3.car(ms5394),M3.cons(leftovers5393,acc5395));})(discarded_by_leftovers5388,ms5385,acc5362),0,end5391,ipre5386,0_ok_p5392);} else {var if_res3411 = (function(acc5396, leftover5397) {if (leftover5397) {var if_res3410 = M3.cons(leftover5397,acc5396);} else {var if_res3410 = acc5396;}return if_res3410;})(acc5362,discarded_by_leftovers5388);}var if_res3418 = if_res3411;} else {if (false) {var if_res3412 = M3.regexp_match_peek_positions_by_end(rx5367,buf5351,start5363,end5364,false,ipre5365,max_lookbehind5355);} else {var if_res3412 = M3.regexp_match_positions_by_end(rx5367,buf5351,start5363,end5364,false,ipre5365,max_lookbehind5355);}var let_result3413 = if_res3412;var m5398 = let_result3413.getAt(0);var ipre5399 = let_result3413.getAt(1);if (M3.not(m5398)) {var if_res3417 = (function(acc5400, start5401, end5402) {if (end5402) {var if_res3414 = sub5350(buf5351,start5401,end5402);} else {var if_res3414 = sub5350(buf5351,start5401);}return M3.cons(if_res3414,acc5400);})(acc5362,start5363,end5364);} else {var mstart5403 = M3.caar(m5398);var mend5404 = M3.cdar(m5398);var 0_ok_p5405 = M3.not(M3._eq_(mstart5403,mend5404));if (false) {var if_res3415 = M3.input_port_p(buf5351);} else {var if_res3415 = false;}if (if_res3415) {var if_res3416 = false(function(acc5406, new_start5407, new_end5408) {return loop5361(acc5406,new_start5407,new_end5408,ipre5399,0_ok_p5405);},acc5362,start5363,end5364,m5398);} else {var if_res3416 = loop5361((function(start5409, ms5410, acc5411) {return M3.cons(sub5350(buf5351,M3.caar(ms5410),M3.cdar(ms5410)),M3.cons(sub5350(buf5351,start5409,M3.caar(ms5410)),acc5411));})(start5363,m5398,acc5362),mend5404,end5364,ipre5399,0_ok_p5405);}var if_res3417 = if_res3416;}var if_res3418 = if_res3417;}return if_res3418;};var if_res3473 = M3.reverse(loop5361($rjs_core.Pair.Empty,start5279,end5280,ipre5281,true));} else {var let_result3419 = get_buf_plus_sub(string5278,pattern5277);var buf5412 = let_result3419.getAt(0);var sub5413 = let_result3419.getAt(1);if (M3.path_p(buf5412)) {var or_part5415 = M3.string_p(pattern5277);if (or_part5415) {var if_res3420 = or_part5415;} else {var if_res3420 = M3.regexp_p(pattern5277);}if (if_res3420) {var if_res3421 = M3.path__gt_string(buf5412);} else {var if_res3421 = M3.path__gt_bytes(buf5412);}var if_res3422 = if_res3421;} else {var if_res3422 = buf5412;}var buf5414 = if_res3422;if (M3.string_p(buf5414)) {var if_res3424 = M3.string_length(buf5414);} else {if (M3.bytes_p(buf5414)) {var if_res3423 = M3.bytes_length(buf5414);} else {var if_res3423 = false;}var if_res3424 = if_res3423;}var len5416 = if_res3424;if (M3.bytes_p(pattern5277)) {var if_res3428 = M3.byte_regexp(pattern5277);} else {if (M3.string_p(pattern5277)) {var if_res3427 = M3.regexp(pattern5277);} else {if (M3.regexp_p(pattern5277)) {var if_res3426 = pattern5277;} else {if (M3.byte_regexp_p(pattern5277)) {var if_res3425 = pattern5277;} else {var if_res3425 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"(or/c regexp? byte-regexp? string? bytes?)",pattern5277);}var if_res3426 = if_res3425;}var if_res3427 = if_res3426;}var if_res3428 = if_res3427;}var orig_rx5417 = if_res3428;var max_lookbehind5418 = M3.regexp_max_lookbehind(orig_rx5417);if (false) {if (M3.input_port_p(buf5414)) {var if_res3429 = M3.rvoid();} else {var if_res3429 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"input-port?",buf5414);}var if_res3432 = if_res3429;} else {var or_part5419 = len5416;if (or_part5419) {var if_res3430 = or_part5419;} else {var if_res3430 = M3.input_port_p(buf5414);}if (if_res3430) {var if_res3431 = M3.rvoid();} else {var if_res3431 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"(or/c string? bytes? path? input-port?)",buf5414);}var if_res3432 = if_res3431;}if_res3432;if (M3.number_p(start5279)) {if (M3.exact_p(start5279)) {if (M3.integer_p(start5279)) {var if_res3433 = M3._gt__eq_(start5279,0);} else {var if_res3433 = false;}var if_res3434 = if_res3433;} else {var if_res3434 = false;}var if_res3435 = if_res3434;} else {var if_res3435 = false;}if (if_res3435) {var if_res3436 = M3.rvoid();} else {var if_res3436 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"exact-nonnegative-integer?",start5279);}if_res3436;var or_part5420 = M3.not(end5280);if (or_part5420) {var if_res3440 = or_part5420;} else {if (M3.number_p(end5280)) {if (M3.exact_p(end5280)) {if (M3.integer_p(end5280)) {var if_res3437 = M3._gt__eq_(end5280,0);} else {var if_res3437 = false;}var if_res3438 = if_res3437;} else {var if_res3438 = false;}var if_res3439 = if_res3438;} else {var if_res3439 = false;}var if_res3440 = if_res3439;}if (if_res3440) {var if_res3441 = M3.rvoid();} else {var if_res3441 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"(or/c exact-nonnegative-integer? #f)",end5280);}if_res3441;if (M3.bytes_p(ipre5281)) {var if_res3442 = M3.rvoid();} else {var if_res3442 = M3.raise_argument_error($rjs_core.Symbol.make("regexp-match*"),"bytes?",ipre5281);}if_res3442;var or_part5421 = M3.input_port_p(buf5414);if (or_part5421) {var if_res3444 = or_part5421;} else {if (len5416) {var if_res3443 = M3._lt__eq_(start5279,len5416);} else {var if_res3443 = false;}var if_res3444 = if_res3443;}if (if_res3444) {var if_res3445 = M3.rvoid();} else {var if_res3445 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match*"),M3.format("starting offset index out of range [0,~a]: ",len5416),start5279);}if_res3445;var or_part5422 = M3.not(end5280);if (or_part5422) {var if_res3449 = or_part5422;} else {if (M3._lt__eq_(start5279,end5280)) {var or_part5423 = M3.input_port_p(buf5414);if (or_part5423) {var if_res3447 = or_part5423;} else {if (len5416) {var if_res3446 = M3._lt__eq_(end5280,len5416);} else {var if_res3446 = false;}var if_res3447 = if_res3446;}var if_res3448 = if_res3447;} else {var if_res3448 = false;}var if_res3449 = if_res3448;}if (if_res3449) {var if_res3450 = M3.rvoid();} else {var if_res3450 = M3.raise_mismatch_error($rjs_core.Symbol.make("regexp-match*"),M3.format("ending offset index out of range [~a,~a]: ",start5279,len5416),end5280);}if_res3450;var loop5424 = function(acc5425, start5426, end5427, ipre5428, 0_ok_p5429) {if (0_ok_p5429) {var if_res3451 = orig_rx5417;} else {var if_res3451 = no_empty_edge_matches(orig_rx5417,M3.add1(M3.bytes_length(ipre5428)));}var rx5430 = if_res3451;if (function(leftovers5431, ms5432, acc5433) {return M3.cons(M3.car(ms5432),acc5433);}) {var if_res3452 = M3.input_port_p(buf5414);} else {var if_res3452 = false;}if (if_res3452) {if (M3.positive_p(start5426)) {var s5435 = M3.make_bytes(4096);var loop5436 = function(n5437) {if (M3._eq_(n5437,start5426)) {var if_res3454 = M3.rvoid();} else {var m5438 = M3.read_bytes_avail_bang_(s5435,buf5414,0,M3.min(start5426-n5437,4096));if (M3.eof_object_p(m5438)) {var if_res3453 = M3.rvoid();} else {var if_res3453 = loop5436(n5437+m5438);}var if_res3454 = if_res3453;}return if_res3454;};var if_res3455 = loop5436(0);} else {var if_res3455 = M3.rvoid();}var _5434 = if_res3455;if (false) {var if_res3456 = false;} else {var if_res3456 = 0;}var discarded_by_leftovers5439 = if_res3456;if (false) {var if_res3457 = M3.open_output_bytes();} else {var if_res3457 = M3.make_output_port($rjs_core.Symbol.make("counter"),M3.always_evt,function(s5441, start5442, end5443, flush_p5444, breakable_p5445) {var c5446 = end5443-start5442;discarded_by_leftovers5439 = c5446+discarded_by_leftovers5439;return c5446;},M3.rvoid);}var spitout5440 = if_res3457;if (end5427) {var if_res3458 = end5427-start5426;} else {var if_res3458 = false;}var end5447 = if_res3458;var let_result3459 = M3.regexp_match_by_end(rx5430,buf5414,0,end5447,spitout5440,ipre5428,max_lookbehind5418);var ms5448 = let_result3459.getAt(0);var ipre5449 = let_result3459.getAt(1);if (ms5448) {var if_res3460 = M3.car(ms5448);} else {var if_res3460 = false;}var m5450 = if_res3460;if (false) {var if_res3461 = M3.get_output_bytes(spitout5440);} else {var if_res3461 = discarded_by_leftovers5439;}var discarded_by_leftovers5451 = if_res3461;if (false) {var if_res3462 = bstring_length(discarded_by_leftovers5451);} else {var if_res3462 = discarded_by_leftovers5451;}var skipped5452 = if_res3462;if (m5450) {var if_res3463 = bstring_length(m5450);} else {var if_res3463 = false;}var got5453 = if_res3463;if (end5447) {if (m5450) {var if_res3464 = end5447-skipped5452-got5453;} else {var if_res3464 = false;}var if_res3465 = if_res3464;} else {var if_res3465 = false;}var end5454 = if_res3465;if (m5450) {var 0_ok_p5455 = M3.not(M3.zero_p(got5453));var if_res3466 = loop5424((function(leftovers5456, ms5457, acc5458) {return M3.cons(M3.car(ms5457),acc5458);})(discarded_by_leftovers5451,ms5448,acc5425),0,end5454,ipre5449,0_ok_p5455);} else {var if_res3466 = (function(acc5459, leftover5460) {return acc5459;})(acc5425,discarded_by_leftovers5451);}var if_res3472 = if_res3466;} else {if (false) {var if_res3467 = M3.regexp_match_peek_positions_by_end(rx5430,buf5414,start5426,end5427,false,ipre5428,max_lookbehind5418);} else {var if_res3467 = M3.regexp_match_positions_by_end(rx5430,buf5414,start5426,end5427,false,ipre5428,max_lookbehind5418);}var let_result3468 = if_res3467;var m5461 = let_result3468.getAt(0);var ipre5462 = let_result3468.getAt(1);if (M3.not(m5461)) {var if_res3471 = (function(acc5463, start5464, end5465) {return acc5463;})(acc5425,start5426,end5427);} else {var mstart5466 = M3.caar(m5461);var mend5467 = M3.cdar(m5461);var 0_ok_p5468 = M3.not(M3._eq_(mstart5466,mend5467));if (false) {var if_res3469 = M3.input_port_p(buf5414);} else {var if_res3469 = false;}if (if_res3469) {var if_res3470 = false(function(acc5469, new_start5470, new_end5471) {return loop5424(acc5469,new_start5470,new_end5471,ipre5462,0_ok_p5468);},acc5425,start5426,end5427,m5461);} else {var if_res3470 = loop5424((function(start5472, ms5473, acc5474) {return M3.cons(sub5413(buf5414,M3.caar(ms5473),M3.cdar(ms5473)),acc5474);})(start5426,m5461,acc5425),mend5467,end5427,ipre5462,0_ok_p5468);}var if_res3471 = if_res3470;}var if_res3472 = if_res3471;}return if_res3472;};var if_res3473 = M3.reverse(loop5424($rjs_core.Pair.Empty,start5279,end5280,ipre5281,true));}var if_res3474 = if_res3473;}var if_res3475 = if_res3474;}var if_res3476 = if_res3475;}var if_res3477 = if_res3476;}return if_res3477;};var unpack72 = function(given_kws5475, given_args5476, pattern695477, string705478, start635479, end645480, ipre655481, start665482, end675483, ipre685484) {if (M3.pair_p(given_kws5475)) {var if_res3478 = M3.eq_p($rjs_core.Keyword.make('#:gap-select?'),M3.car(given_kws5475));} else {var if_res3478 = false;}var gap_select_p625485 = if_res3478;if (gap_select_p625485) {var if_res3479 = M3.car(given_args5476);} else {var if_res3479 = M3.rvoid();}var gap_select_p605486 = if_res3479;if (gap_select_p625485) {var if_res3480 = M3.cdr(given_kws5475);} else {var if_res3480 = given_kws5475;}var given_kws5487 = if_res3480;if (gap_select_p625485) {var if_res3481 = M3.cdr(given_args5476);} else {var if_res3481 = given_args5476;}var given_args5488 = if_res3481;var match_select615489 = M3.pair_p(given_kws5487);if (match_select615489) {var if_res3482 = M3.car(given_args5488);} else {var if_res3482 = M3.rvoid();}var match_select595490 = if_res3482;return regexp_match_times_71(gap_select_p605486,gap_select_p625485,match_select595490,match_select615489,pattern695477,string705478,start635479,end645480,ipre655481,start665482,end675483,ipre685484);};var cl3488 = function(given_kws5497, given_args5498, pattern5499, string5500) {return unpack72(given_kws5497,given_args5498,pattern5499,string5500,false,false,false,false,false,false);};var cl3489 = function(given_kws5501, given_args5502, pattern5503, string5504, start5505, end5506, ipre655507) {return unpack72(given_kws5501,given_args5502,pattern5503,string5504,start5505,end5506,ipre655507,true,true,true);};var cl3490 = function(given_kws5508, given_args5509, pattern5510, string5511, start5512, end645513) {return unpack72(given_kws5508,given_args5509,pattern5510,string5511,start5512,end645513,false,true,true,false);};var cl3491 = function(given_kws5514, given_args5515, pattern5516, string5517, start635518) {return unpack72(given_kws5514,given_args5515,pattern5516,string5517,start635518,false,false,true,false,false);};var temp3493 = $rjs_core.attachProcedureArity(function() {var fixed_lam3492 = {'4':cl3488,'7':cl3489,'6':cl3490,'5':cl3491}[arguments.length];if (fixed_lam3492!==undefined) {return fixed_lam3492.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[4,5,6,7]);var cl3483 = function(pattern5520, string5521) {return unpack72(M3.rnull,M3.rnull,pattern5520,string5521,false,false,false,false,false,false);};var cl3484 = function(pattern5522, string5523, start5524, end5525, ipre655526) {return unpack72(M3.rnull,M3.rnull,pattern5522,string5523,start5524,end5525,ipre655526,true,true,true);};var cl3485 = function(pattern5527, string5528, start5529, end645530) {return unpack72(M3.rnull,M3.rnull,pattern5527,string5528,start5529,end645530,false,true,true,false);};var cl3486 = function(pattern5531, string5532, start635533) {return unpack72(M3.rnull,M3.rnull,pattern5531,string5532,start635533,false,false,true,false,false);};var regexp_match_times_5519 = $rjs_core.attachProcedureArity(function() {var fixed_lam3487 = {'2':cl3483,'5':cl3484,'4':cl3485,'3':cl3486}[arguments.length];if (fixed_lam3487!==undefined) {return fixed_lam3487.apply(null,arguments);} else {return M3.error("case-lambda: invalid case");}},[2,3,4,5]);var regexp_match_times_73 = M0.__rjs_quoted__.make_optional_keyword_procedure(function(given_kws5491, given_argc5492) {if (M3._gt__eq_(given_argc5492,4)) {var if_res3494 = M3._lt__eq_(given_argc5492,7);} else {var if_res3494 = false;}if (if_res3494) {var l15493 = given_kws5491;if (M3.null_p(l15493)) {var if_res3496 = l15493;} else {if (M3.eq_p(M3.car(l15493),$rjs_core.Keyword.make('#:gap-select?'))) {var if_res3495 = M3.cdr(l15493);} else {var if_res3495 = l15493;}var if_res3496 = if_res3495;}var l15494 = if_res3496;var l15495 = l15494;if (M3.null_p(l15495)) {var if_res3498 = l15495;} else {if (M3.eq_p(M3.car(l15495),$rjs_core.Keyword.make('#:match-select'))) {var if_res3497 = M3.cdr(l15495);} else {var if_res3497 = l15495;}var if_res3498 = if_res3497;}var l15496 = if_res3498;var if_res3499 = M3.null_p(l15496);} else {var if_res3499 = false;}return if_res3499;},temp3493,M3.rnull,$rjs_core.Pair.makeList($rjs_core.Keyword.make('#:gap-select?'), $rjs_core.Keyword.make('#:match-select')),regexp_match_times_5519);var regexp_match_exact_p = function(p5534, s5535) {var m5536 = M3.regexp_match_positions(p5534,s5535);if (m5536) {if (M3.zero_p(M3.caar(m5536))) {var temp3505 = M3.cdar(m5536);if (M3.bytes_p(s5535)) {var if_res3504 = M3.bytes_length(s5535);} else {var or_part5537 = M3.byte_regexp_p(p5534);if (or_part5537) {var if_res3500 = or_part5537;} else {var if_res3500 = M3.bytes_p(p5534);}if (if_res3500) {if (M3.path_p(s5535)) {var if_res3501 = M3.bytes_length(M3.path__gt_bytes(s5535));} else {var if_res3501 = M3.string_utf_8_length(s5535);}var if_res3503 = if_res3501;} else {if (M3.path_p(s5535)) {var if_res3502 = M3.string_length(M3.path__gt_string(s5535));} else {var if_res3502 = M3.string_length(s5535);}var if_res3503 = if_res3502;}var if_res3504 = if_res3503;}var if_res3506 = M3._eq_(temp3505,if_res3504);} else {var if_res3506 = false;}var if_res3507 = if_res3506;} else {var if_res3507 = false;}return if_res3507;};var regexp_replaces = function(string5538, replacements5539) {var loop5540 = function(str5541, rs5542) {if (M3.null_p(rs5542)) {var if_res3508 = str5541;} else {var if_res3508 = loop5540(M3.regexp_replace_times_(M3.caar(rs5542),str5541,M3.cadar(rs5542)),M3.cdr(rs5542));}return if_res3508;};return loop5540(string5538,replacements5539);};var __rjs_quoted__ = {};__rjs_quoted__.regexp_match_positions_times_35 = regexp_match_positions_times_35;__rjs_quoted__.bstring_length = bstring_length;__rjs_quoted__.regexp_match_positions_times_33 = regexp_match_positions_times_33;__rjs_quoted__.regexp_match_times_71 = regexp_match_times_71;__rjs_quoted__.regexp_match_peek_positions_times_46 = regexp_match_peek_positions_times_46;__rjs_quoted__.regexp_match_times_73 = regexp_match_times_73;__rjs_quoted__.regexp_match_peek_positions_times_48 = regexp_match_peek_positions_times_48;__rjs_quoted__.no_empty_edge_matches = no_empty_edge_matches;export { __rjs_quoted__,regexp_replaces,_regexp_replace_times_,regexp_try_match,regexp_match_exact_p,regexp_split,regexp_replace_quote,regexp_quote,real__gt_decimal_string };