import * as $rjs_core from '../../../runtime/core.js';import * as M0 from "../../../runtime/kernel.rkt.js";import * as M1 from "../../../runtime/unsafe.rkt.js";var let_result1900 = M0.make_struct_type_property($rjs_core.Symbol.make("keyword-impersonator"));var prop_keyword_impersonator = let_result1900.getAt(0);var keyword_impersonator_p = let_result1900.getAt(1);var keyword_impersonator_ref = let_result1900.getAt(2);var keyword_procedure_impersonator_of = function(v3162) {if (keyword_impersonator_p(v3162)) {var if_res1901 = keyword_impersonator_ref(v3162)(v3162);} else {var if_res1901 = false;}return if_res1901;};var let_result1902 = M0.make_struct_type($rjs_core.Symbol.make("keyword-procedure"),false,4,0,false,M0.list(M0.cons(M0.prop_checked_procedure,true),M0.cons(M0.prop_impersonator_of,keyword_procedure_impersonator_of)),M0.current_inspector(),false,$rjs_core.Pair.makeList(0, 1, 2, 3));var struct_keyword_procedure = let_result1902.getAt(0);var mk_kw_proc = let_result1902.getAt(1);var keyword_procedure_p = let_result1902.getAt(2);var keyword_procedure_ref = let_result1902.getAt(3);var keyword_procedure_set_bang_ = let_result1902.getAt(4);var keyword_procedure_checker = M0.make_struct_field_accessor(keyword_procedure_ref,0);var keyword_procedure_proc = M0.make_struct_field_accessor(keyword_procedure_ref,1);var keyword_procedure_required = M0.make_struct_field_accessor(keyword_procedure_ref,2);var keyword_procedure_allowed = M0.make_struct_field_accessor(keyword_procedure_ref,3);var let_result1903 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_keyword_procedure,0,0,false,M0.list(M0.cons(M0.prop_method_arity_error,true)));var struct_keyword_method = let_result1903.getAt(0);var make_km = let_result1903.getAt(1);var keyword_method_p = let_result1903.getAt(2);var km_ref = let_result1903.getAt(3);var km_set_bang_ = let_result1903.getAt(4);var generate_arity_string = function(proc3163) {var let_result1904 = procedure_keywords(proc3163);var req3164 = let_result1904.getAt(0);var allowed3165 = let_result1904.getAt(1);var a3166 = M0.procedure_arity(proc3163);var keywords_desc3167 = function(opt3169, req3170) {if (M0.null_p(M0.cdr(req3170))) {var if_res1909 = M0.format("an ~aargument",opt3169);} else {var if_res1909 = M0.format("~aarguments",opt3169);}if (M0.null_p(M0.cdr(req3170))) {var if_res1908 = "";} else {var if_res1908 = "s";}var tmp3171 = M0.length(req3170);if (M0.equal_p(tmp3171,1)) {var if_res1907 = M0.format(" ~a",M0.car(req3170));} else {if (M0.equal_p(tmp3171,2)) {var if_res1906 = M0.format(" ~a and ~a",M0.car(req3170),M0.cadr(req3170));} else {var loop3172 = function(req3173) {if (M0.null_p(M0.cdr(req3173))) {var if_res1905 = M0.format(" and ~a",M0.car(req3173));} else {var if_res1905 = M0.format(" ~a,~a",M0.car(req3173),loop3172(M0.cdr(req3173)));}return if_res1905;};var if_res1906 = loop3172(req3170);}var if_res1907 = if_res1906;}return M0.format("~a with keyword~a~a",if_res1909,if_res1908,if_res1907);};var method_adjust3168 = function(a3174) {var or_part3175 = okm_p(proc3163);if (or_part3175) {var if_res1910 = or_part3175;} else {var if_res1910 = keyword_method_p(proc3163);}if (if_res1910) {if (M0.zero_p(a3174)) {var if_res1911 = 0;} else {var if_res1911 = M0.sub1(a3174);}var if_res1912 = if_res1911;} else {var if_res1912 = a3174;}return if_res1912;};if (M0.number_p(a3166)) {var a3176 = method_adjust3168(a3166);var if_res1919 = M0.format("~a",a3176);} else {if (M0.arity_at_least_p(a3166)) {var a3177 = method_adjust3168(M0.arity_at_least_value(a3166));var if_res1918 = M0.format("at least ~a",a3177);} else {var if_res1918 = "a different number";}var if_res1919 = if_res1918;}if (M0.null_p(req3164)) {var if_res1917 = "";} else {var if_res1917 = M0.format(" plus ~a",keywords_desc3167("",req3164));}if (allowed3165) {var loop3179 = function(req3180, allowed3181) {if (M0.null_p(req3180)) {var if_res1914 = allowed3181;} else {if (M0.eq_p(M0.car(req3180),M0.car(allowed3181))) {var if_res1913 = loop3179(M0.cdr(req3180),M0.cdr(allowed3181));} else {var if_res1913 = M0.cons(M0.car(allowed3181),loop3179(req3180,M0.cdr(allowed3181)));}var if_res1914 = if_res1913;}return if_res1914;};var others3178 = loop3179(req3164,allowed3165);if (M0.null_p(others3178)) {var if_res1915 = "";} else {var if_res1915 = M0.format(" plus ~a",keywords_desc3167("optional ",others3178));}var if_res1916 = if_res1915;} else {var if_res1916 = " plus arbitrary keyword arguments";}return M0.string_append(if_res1919,if_res1917,if_res1916);};var let_result1920 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_keyword_procedure,1,0,false,M0.list(M0.cons(M0.prop_arity_string,generate_arity_string)),M0.current_inspector(),0);var struct_okp = let_result1920.getAt(0);var make_optional_keyword_procedure = let_result1920.getAt(1);var okp_p = let_result1920.getAt(2);var okp_ref = let_result1920.getAt(3);var okp_set_bang_ = let_result1920.getAt(4);var let_result1921 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_okp,0,0,false,M0.list(M0.cons(M0.prop_method_arity_error,true)));var struct_okm = let_result1921.getAt(0);var make_optional_keyword_method = let_result1921.getAt(1);var okm_p = let_result1921.getAt(2);var okm_ref = let_result1921.getAt(3);var okm_set_bang_ = let_result1921.getAt(4);var let_result1922 = M0.make_struct_type_property($rjs_core.Symbol.make("named-keyword-procedure"));var prop_named_keyword_procedure = let_result1922.getAt(0);var named_keyword_procedure_p = let_result1922.getAt(1);var keyword_procedure_name_plus_fail = let_result1922.getAt(2);var make_required = function(name3182, fail_proc3183, method_p3184, impersonator_p3185) {var or_part3191 = name3182;if (or_part3191) {var if_res1926 = or_part3191;} else {var if_res1926 = $rjs_core.Symbol.make("unknown");}if (impersonator_p3185) {if (method_p3184) {var if_res1923 = struct_keyword_method_impersonator;} else {var if_res1923 = struct_keyword_procedure_impersonator;}var if_res1925 = if_res1923;} else {if (method_p3184) {var if_res1924 = struct_keyword_method;} else {var if_res1924 = struct_keyword_procedure;}var if_res1925 = if_res1924;}var let_result1927 = M0.make_struct_type(if_res1926,if_res1925,0,0,false,M0.list(M0.cons(M0.prop_arity_string,generate_arity_string),M0.cons(prop_named_keyword_procedure,M0.cons(name3182,fail_proc3183)),M0.cons(M0.prop_incomplete_arity,true)),M0.current_inspector(),fail_proc3183);var s_3186 = let_result1927.getAt(0);var mk3187 = let_result1927.getAt(1);var _p3188 = let_result1927.getAt(2);var _ref3189 = let_result1927.getAt(3);var _set_bang_3190 = let_result1927.getAt(4);return mk3187;};var let_result1929 = M0.make_struct_type_property($rjs_core.Symbol.make("procedure"),function(v3192, info_l3193) {if (M0.exact_integer_p(v3192)) {var if_res1928 = M0.make_struct_field_accessor(M0.list_ref(info_l3193,3),v3192);} else {var if_res1928 = false;}return if_res1928;});var prop_procedure_accessor = let_result1929.getAt(0);var procedure_accessor_p = let_result1929.getAt(1);var procedure_accessor_ref = let_result1929.getAt(2);var let_result1930 = M0.make_struct_type_property($rjs_core.Symbol.make("procedure"),false,M0.list(M0.cons(M0.prop_procedure,M0.values),M0.cons(prop_procedure_accessor,M0.values)));var new_prop_procedure = let_result1930.getAt(0);var new_procedure_p = let_result1930.getAt(1);var new_procedure_ref = let_result1930.getAt(2);var let_result1931 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_keyword_procedure,1,0,false,M0.list(M0.cons(prop_keyword_impersonator,function(v3194) {return kpp_ref(v3194,0);})));var struct_keyword_procedure_impersonator = let_result1931.getAt(0);var make_kpp = let_result1931.getAt(1);var keyword_procedure_impersonator_p = let_result1931.getAt(2);var kpp_ref = let_result1931.getAt(3);var kpp_set_bang_ = let_result1931.getAt(4);var let_result1932 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_keyword_method,1,0,false,M0.list(M0.cons(prop_keyword_impersonator,function(v3195) {return kmp_ref(v3195,0);})));var struct_keyword_method_impersonator = let_result1932.getAt(0);var make_kmp = let_result1932.getAt(1);var keyword_method_impersonator_p = let_result1932.getAt(2);var kmp_ref = let_result1932.getAt(3);var kmp_set_bang_ = let_result1932.getAt(4);var let_result1933 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_okp,1,0,false,M0.list(M0.cons(prop_keyword_impersonator,function(v3196) {return okpp_ref(v3196,0);})));var struct_okpp = let_result1933.getAt(0);var make_optional_keyword_procedure_impersonator = let_result1933.getAt(1);var okpp_p = let_result1933.getAt(2);var okpp_ref = let_result1933.getAt(3);var okpp_set_bang_ = let_result1933.getAt(4);var let_result1934 = M0.make_struct_type($rjs_core.Symbol.make("procedure"),struct_okp,1,0,false,M0.list(M0.cons(prop_keyword_impersonator,function(v3197) {return okmp_ref(v3197,0);})));var struct_okmp = let_result1934.getAt(0);var make_optional_keyword_method_impersonator = let_result1934.getAt(1);var okmp_p = let_result1934.getAt(2);var okmp_ref = let_result1934.getAt(3);var okmp_set_bang_ = let_result1934.getAt(4);var cl1935 = function(proc3198) {return make_keyword_procedure(proc3198,$rjs_core.attachProcedureArity(function() {var args3199 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));return M0.apply(proc3198,M0.rnull,M0.rnull,args3199);}));};var cl1936 = function(proc3200, plain_proc3201) {return make_optional_keyword_procedure(make_keyword_checker(M0.rnull,false,M0.procedure_arity(proc3200)),proc3200,M0.rnull,false,plain_proc3201);};var make_keyword_procedure = $rjs_core.attachProcedureArity(function() {var fixed_lam1937 = {'1':cl1935,'2':cl1936}[arguments.length];if (fixed_lam1937!==undefined) {return fixed_lam1937.apply(null,arguments);} else {return M0.error("case-lambda: invalid case");}},[1,2]);var keyword_apply = $rjs_core.attachProcedureArity(function(proc3202, kws3203, kw_vals3204, normal_args3205) {var normal_argss3206 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),4));var type_error3207 = function(what3208, which3209) {return M0.apply(M0.raise_argument_error,$rjs_core.Symbol.make("keyword-apply"),what3208,which3209,proc3202,kws3203,kw_vals3204,normal_args3205,normal_argss3206);};if (M0.procedure_p(proc3202)) {var if_res1938 = M0.rvoid();} else {var if_res1938 = type_error3207("procedure?",0);}if_res1938;var loop3210 = function(ks3211) {if (M0.null_p(ks3211)) {var if_res1945 = M0.rvoid();} else {var or_part3212 = M0.not(M0.pair_p(ks3211));if (or_part3212) {var if_res1939 = or_part3212;} else {var if_res1939 = M0.not(M0.__rjs_quoted__.keyword_p(M0.car(ks3211)));}if (if_res1939) {var if_res1944 = type_error3207("(listof keyword?)",1);} else {if (M0.null_p(M0.cdr(ks3211))) {var if_res1943 = M0.rvoid();} else {var or_part3213 = M0.not(M0.pair_p(M0.cdr(ks3211)));if (or_part3213) {var if_res1940 = or_part3213;} else {var if_res1940 = M0.not(M0.__rjs_quoted__.keyword_p(M0.cadr(ks3211)));}if (if_res1940) {var if_res1942 = loop3210(M0.cdr(ks3211));} else {if (M0.__rjs_quoted__.keyword_lt__p(M0.car(ks3211),M0.cadr(ks3211))) {var if_res1941 = loop3210(M0.cdr(ks3211));} else {var if_res1941 = type_error3207("(and/c (listof? keyword?) sorted? distinct?)",1);}var if_res1942 = if_res1941;}var if_res1943 = if_res1942;}var if_res1944 = if_res1943;}var if_res1945 = if_res1944;}return if_res1945;};loop3210(kws3203);if (M0.list_p(kw_vals3204)) {var if_res1946 = M0.rvoid();} else {var if_res1946 = type_error3207("list?",2);}if_res1946;if (M0._eq_(M0.length(kws3203),M0.length(kw_vals3204))) {var if_res1947 = M0.rvoid();} else {var if_res1947 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword-apply"),"keyword list length does not match value list length","keyword list length",M0.length(kws3203),"value list length",M0.length(kw_vals3204),"keyword list",kws3203,"value list",kw_vals3204);}if_res1947;var loop3215 = function(normal_argss3216, pos3217) {if (M0.null_p(M0.cdr(normal_argss3216))) {var l3218 = M0.car(normal_argss3216);if (M0.list_p(l3218)) {var if_res1948 = l3218;} else {var if_res1948 = type_error3207("list?",pos3217);}var if_res1949 = if_res1948;} else {var if_res1949 = M0.cons(M0.car(normal_argss3216),loop3215(M0.cdr(normal_argss3216),M0.add1(pos3217)));}return if_res1949;};var normal_args3214 = loop3215(M0.cons(normal_args3205,normal_argss3206),3);if (M0.null_p(kws3203)) {var if_res1950 = M0.apply(proc3202,normal_args3214);} else {var if_res1950 = M0.apply(keyword_procedure_extract_by_method(kws3203,2+M0.length(normal_args3214),proc3202,0),kws3203,kw_vals3204,normal_args3214);}return if_res1950;});var procedure_keywords = function(p3219) {if (keyword_procedure_p(p3219)) {var if_res1955 = M0.values(keyword_procedure_required(p3219),keyword_procedure_allowed(p3219));} else {if (M0.procedure_p(p3219)) {if (new_procedure_p(p3219)) {var v3220 = new_procedure_ref(p3219);if (M0.procedure_p(v3220)) {var if_res1952 = procedure_keywords(v3220);} else {var a3221 = procedure_accessor_ref(p3219);if (a3221) {var if_res1951 = procedure_keywords(a3221(p3219));} else {var if_res1951 = M0.values(M0.rnull,M0.rnull);}var if_res1952 = if_res1951;}var if_res1953 = if_res1952;} else {var if_res1953 = M0.values(M0.rnull,M0.rnull);}var if_res1954 = if_res1953;} else {var if_res1954 = M0.raise_argument_error($rjs_core.Symbol.make("procedure-keywords"),"procedure?",p3219);}var if_res1955 = if_res1954;}return if_res1955;};var missing_kw = $rjs_core.attachProcedureArity(function(proc3222) {var args3223 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),1));return M0.apply(keyword_procedure_extract_by_method(M0.rnull,0,proc3222,0),M0.rnull,M0.rnull,args3223);});var check_kw_args = function(p3224, kws3225) {var loop3226 = function(kws3227, required3228, allowed3229) {if (M0.null_p(kws3227)) {if (M0.null_p(required3228)) {var if_res1956 = M0.values(false,false);} else {var if_res1956 = M0.values(M0.car(required3228),false);}var if_res1965 = if_res1956;} else {if (M0.pair_p(required3228)) {var if_res1957 = M0.eq_p(M0.car(required3228),M0.car(kws3227));} else {var if_res1957 = false;}if (if_res1957) {var temp1960 = M0.cdr(kws3227);var temp1959 = M0.cdr(required3228);if (allowed3229) {var if_res1958 = M0.cdr(allowed3229);} else {var if_res1958 = false;}var if_res1964 = loop3226(temp1960,temp1959,if_res1958);} else {if (M0.not(allowed3229)) {var if_res1963 = loop3226(M0.cdr(kws3227),required3228,false);} else {if (M0.pair_p(allowed3229)) {if (M0.eq_p(M0.car(allowed3229),M0.car(kws3227))) {var if_res1961 = loop3226(M0.cdr(kws3227),required3228,M0.cdr(allowed3229));} else {var if_res1961 = loop3226(kws3227,required3228,M0.cdr(allowed3229));}var if_res1962 = if_res1961;} else {var if_res1962 = M0.values(false,M0.car(kws3227));}var if_res1963 = if_res1962;}var if_res1964 = if_res1963;}var if_res1965 = if_res1964;}return if_res1965;};return loop3226(kws3225,keyword_procedure_required(p3224),keyword_procedure_allowed(p3224));};var make_keyword_checker = function(req_kws3230, allowed_kws3231, arity3232) {if (M0.not(allowed_kws3231)) {if (M0.null_p(req_kws3230)) {if (M0.integer_p(arity3232)) {var if_res1970 = function(kws3233, a3234) {if (true) {var if_res1966 = M0._eq_(a3234,arity3232);} else {var if_res1966 = false;}return if_res1966;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3235 = M0.arity_at_least_value(arity3232);var if_res1969 = function(kws3236, a3237) {if (true) {var if_res1967 = M0._gt__eq_(a3237,arity3235);} else {var if_res1967 = false;}return if_res1967;};} else {var if_res1969 = function(kws3238, a3239) {if (true) {var if_res1968 = arity_includes_p(arity3232,a3239);} else {var if_res1968 = false;}return if_res1968;};}var if_res1970 = if_res1969;}var if_res1976 = if_res1970;} else {if (M0.integer_p(arity3232)) {var if_res1975 = function(kws3240, a3241) {if (subset_p(req_kws3230,kws3240)) {var if_res1971 = M0._eq_(a3241,arity3232);} else {var if_res1971 = false;}return if_res1971;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3242 = M0.arity_at_least_value(arity3232);var if_res1974 = function(kws3243, a3244) {if (subset_p(req_kws3230,kws3243)) {var if_res1972 = M0._gt__eq_(a3244,arity3242);} else {var if_res1972 = false;}return if_res1972;};} else {var if_res1974 = function(kws3245, a3246) {if (subset_p(req_kws3230,kws3245)) {var if_res1973 = arity_includes_p(arity3232,a3246);} else {var if_res1973 = false;}return if_res1973;};}var if_res1975 = if_res1974;}var if_res1976 = if_res1975;}var if_res2009 = if_res1976;} else {if (M0.null_p(allowed_kws3231)) {if (M0.integer_p(arity3232)) {var if_res1981 = function(kws3247, a3248) {if (M0.null_p(kws3247)) {var if_res1977 = M0._eq_(a3248,arity3232);} else {var if_res1977 = false;}return if_res1977;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3249 = M0.arity_at_least_value(arity3232);var if_res1980 = function(kws3250, a3251) {if (M0.null_p(kws3250)) {var if_res1978 = M0._gt__eq_(a3251,arity3249);} else {var if_res1978 = false;}return if_res1978;};} else {var if_res1980 = function(kws3252, a3253) {if (M0.null_p(kws3252)) {var if_res1979 = arity_includes_p(arity3232,a3253);} else {var if_res1979 = false;}return if_res1979;};}var if_res1981 = if_res1980;}var if_res2008 = if_res1981;} else {if (M0.null_p(req_kws3230)) {if (M0.integer_p(arity3232)) {var if_res1986 = function(kws3254, a3255) {if (subset_p(kws3254,allowed_kws3231)) {var if_res1982 = M0._eq_(a3255,arity3232);} else {var if_res1982 = false;}return if_res1982;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3256 = M0.arity_at_least_value(arity3232);var if_res1985 = function(kws3257, a3258) {if (subset_p(kws3257,allowed_kws3231)) {var if_res1983 = M0._gt__eq_(a3258,arity3256);} else {var if_res1983 = false;}return if_res1983;};} else {var if_res1985 = function(kws3259, a3260) {if (subset_p(kws3259,allowed_kws3231)) {var if_res1984 = arity_includes_p(arity3232,a3260);} else {var if_res1984 = false;}return if_res1984;};}var if_res1986 = if_res1985;}var if_res2007 = if_res1986;} else {if (M0.equal_p(req_kws3230,allowed_kws3231)) {if (M0.integer_p(arity3232)) {var if_res2000 = function(kws3261, a3262) {var loop3263 = function(kws3264, req_kws3265) {if (M0.null_p(req_kws3265)) {var if_res1989 = M0.null_p(kws3264);} else {if (M0.null_p(kws3264)) {var if_res1988 = false;} else {if (M0.eq_p(M0.car(kws3264),M0.car(req_kws3265))) {var if_res1987 = loop3263(M0.cdr(kws3264),M0.cdr(req_kws3265));} else {var if_res1987 = false;}var if_res1988 = if_res1987;}var if_res1989 = if_res1988;}return if_res1989;};if (loop3263(kws3261,req_kws3230)) {var if_res1990 = M0._eq_(a3262,arity3232);} else {var if_res1990 = false;}return if_res1990;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3266 = M0.arity_at_least_value(arity3232);var if_res1999 = function(kws3267, a3268) {var loop3269 = function(kws3270, req_kws3271) {if (M0.null_p(req_kws3271)) {var if_res1993 = M0.null_p(kws3270);} else {if (M0.null_p(kws3270)) {var if_res1992 = false;} else {if (M0.eq_p(M0.car(kws3270),M0.car(req_kws3271))) {var if_res1991 = loop3269(M0.cdr(kws3270),M0.cdr(req_kws3271));} else {var if_res1991 = false;}var if_res1992 = if_res1991;}var if_res1993 = if_res1992;}return if_res1993;};if (loop3269(kws3267,req_kws3230)) {var if_res1994 = M0._gt__eq_(a3268,arity3266);} else {var if_res1994 = false;}return if_res1994;};} else {var if_res1999 = function(kws3272, a3273) {var loop3274 = function(kws3275, req_kws3276) {if (M0.null_p(req_kws3276)) {var if_res1997 = M0.null_p(kws3275);} else {if (M0.null_p(kws3275)) {var if_res1996 = false;} else {if (M0.eq_p(M0.car(kws3275),M0.car(req_kws3276))) {var if_res1995 = loop3274(M0.cdr(kws3275),M0.cdr(req_kws3276));} else {var if_res1995 = false;}var if_res1996 = if_res1995;}var if_res1997 = if_res1996;}return if_res1997;};if (loop3274(kws3272,req_kws3230)) {var if_res1998 = arity_includes_p(arity3232,a3273);} else {var if_res1998 = false;}return if_res1998;};}var if_res2000 = if_res1999;}var if_res2006 = if_res2000;} else {if (M0.integer_p(arity3232)) {var if_res2005 = function(kws3277, a3278) {if (subsets_p(req_kws3230,kws3277,allowed_kws3231)) {var if_res2001 = M0._eq_(a3278,arity3232);} else {var if_res2001 = false;}return if_res2001;};} else {if (M0.arity_at_least_p(arity3232)) {var arity3279 = M0.arity_at_least_value(arity3232);var if_res2004 = function(kws3280, a3281) {if (subsets_p(req_kws3230,kws3280,allowed_kws3231)) {var if_res2002 = M0._gt__eq_(a3281,arity3279);} else {var if_res2002 = false;}return if_res2002;};} else {var if_res2004 = function(kws3282, a3283) {if (subsets_p(req_kws3230,kws3282,allowed_kws3231)) {var if_res2003 = arity_includes_p(arity3232,a3283);} else {var if_res2003 = false;}return if_res2003;};}var if_res2005 = if_res2004;}var if_res2006 = if_res2005;}var if_res2007 = if_res2006;}var if_res2008 = if_res2007;}var if_res2009 = if_res2008;}return if_res2009;};var arity_includes_p = function(arity3284, a3285) {if (M0.integer_p(arity3284)) {var if_res2011 = M0._eq_(arity3284,a3285);} else {if (M0.arity_at_least_p(arity3284)) {var if_res2010 = M0._gt__eq_(a3285,M0.arity_at_least_value(a3285));} else {var if_res2010 = M0.ormap(function(ar3286) {return arity_includes_p(ar3286,a3285);},arity3284);}var if_res2011 = if_res2010;}return if_res2011;};var subset_p = function(l13287, l23288) {if (M0.null_p(l13287)) {var if_res2014 = true;} else {if (M0.null_p(l23288)) {var if_res2013 = false;} else {if (M0.eq_p(M0.car(l13287),M0.car(l23288))) {var if_res2012 = subset_p(M0.cdr(l13287),M0.cdr(l23288));} else {var if_res2012 = subset_p(l13287,M0.cdr(l23288));}var if_res2013 = if_res2012;}var if_res2014 = if_res2013;}return if_res2014;};var subsets_p = function(l13289, l23290, l33291) {if (M0.null_p(l13289)) {var if_res2019 = subset_p(l23290,l33291);} else {if (M0.null_p(l23290)) {var if_res2018 = false;} else {if (M0.null_p(l33291)) {var if_res2017 = false;} else {var v23292 = M0.car(l23290);if (M0.eq_p(M0.car(l13289),v23292)) {var if_res2016 = subsets_p(M0.cdr(l13289),M0.cdr(l23290),M0.cdr(l33291));} else {if (M0.eq_p(v23292,M0.car(l33291))) {var if_res2015 = subsets_p(l13289,M0.cdr(l23290),M0.cdr(l33291));} else {var if_res2015 = subsets_p(l13289,l23290,M0.cdr(l33291));}var if_res2016 = if_res2015;}var if_res2017 = if_res2016;}var if_res2018 = if_res2017;}var if_res2019 = if_res2018;}return if_res2019;};var keyword_procedure_extract_by_method = function(kws3293, n3294, p3295, method_n3296) {if (keyword_procedure_p(p3295)) {var if_res2020 = keyword_procedure_checker(p3295)(kws3293,n3294);} else {var if_res2020 = false;}if (if_res2020) {var if_res2046 = keyword_procedure_proc(p3295);} else {if (M0.not(keyword_procedure_p(p3295))) {if (M0.procedure_p(p3295)) {if (new_procedure_p(p3295)) {var a3299 = procedure_accessor_ref(p3295);if (a3299) {var if_res2021 = a3299(p3295);} else {var if_res2021 = false;}var if_res2022 = if_res2021;} else {var if_res2022 = false;}var or_part3298 = if_res2022;if (or_part3298) {var if_res2025 = or_part3298;} else {var or_part3300 = M0.__rjs_quoted__.procedure_extract_target(p3295);if (or_part3300) {var if_res2024 = or_part3300;} else {if (new_procedure_p(p3295)) {var if_res2023 = $rjs_core.Symbol.make("method");} else {var if_res2023 = false;}var if_res2024 = if_res2023;}var if_res2025 = if_res2024;}var if_res2026 = if_res2025;} else {var if_res2026 = false;}var if_res2027 = if_res2026;} else {var if_res2027 = false;}var p23297 = if_res2027;if (p23297) {if (M0.eq_p(p23297,$rjs_core.Symbol.make("method"))) {var p33301 = keyword_procedure_extract_by_method(kws3293,M0.add1(n3294),new_procedure_ref(p3295),M0.add1(method_n3296));var if_res2028 = $rjs_core.attachProcedureArity(function(kws3302, kw_args3303) {var args3304 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return M0.apply(p33301,kws3302,kw_args3303,M0.cons(p3295,args3304));});} else {var if_res2028 = keyword_procedure_extract_by_method(kws3293,n3294,p23297,method_n3296);}var if_res2045 = if_res2028;} else {var if_res2045 = $rjs_core.attachProcedureArity(function(kws3305, kw_args3306) {var args3307 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));if (keyword_procedure_p(p3295)) {var if_res2029 = check_kw_args(p3295,kws3305);} else {var if_res2029 = M0.values(false,M0.car(kws3305));}var let_result2030 = if_res2029;var missing_kw3308 = let_result2030.getAt(0);var extra_kw3309 = let_result2030.getAt(1);var or_part3314 = keyword_method_p(p3295);if (or_part3314) {var if_res2031 = or_part3314;} else {var if_res2031 = okm_p(p3295);}if (if_res2031) {var if_res2032 = 1;} else {var if_res2032 = 0;}var method_n3313 = method_n3296+if_res2032;if (M0._gt__eq_(n3294,method_n3313)) {var if_res2033 = n3294-method_n3313;} else {var if_res2033 = n3294;}var n3310 = if_res2033;if (M0.null_p(args3307)) {var if_res2034 = M0.null_p(kws3305);} else {var if_res2034 = false;}if (if_res2034) {var if_res2035 = "";} else {var if_res2035 = M0.apply(M0.string_append,"\n  arguments...:",M0.append(M0.map(function(v3315) {return M0.format("\n   ~e",v3315);},args3307),M0.map(function(kw3316, kw_arg3317) {return M0.format("\n   ~a ~e",kw3316,kw_arg3317);},kws3305,kw_args3306)));}var args_str3311 = if_res2035;var proc_name3312 = function(p3318) {if (named_keyword_procedure_p(p3318)) {var if_res2036 = M0.car(keyword_procedure_name_plus_fail(p3318));} else {var if_res2036 = false;}var or_part3319 = if_res2036;if (or_part3319) {var if_res2038 = or_part3319;} else {var or_part3320 = M0.__rjs_quoted__.object_name(p3318);if (or_part3320) {var if_res2037 = or_part3320;} else {var if_res2037 = p3318;}var if_res2038 = if_res2037;}return if_res2038;};if (extra_kw3309) {if (keyword_procedure_p(p3295)) {var if_res2040 = M0.format(M0.string_append("application: procedure does not expect an argument with given keyword\n","  procedure: ~a\n","  given keyword: ~a","~a"),proc_name3312(p3295),extra_kw3309,args_str3311);} else {if (M0.procedure_p(p3295)) {var if_res2039 = M0.format(M0.string_append("application: procedure does not accept keyword arguments\n","  procedure: ~a","~a"),proc_name3312(p3295),args_str3311);} else {var if_res2039 = M0.format(M0.string_append("application: not a procedure;\n"," expected a procedure that can be applied to arguments\n","  given: ~e","~a"),p3295,args_str3311);}var if_res2040 = if_res2039;}var if_res2044 = if_res2040;} else {if (missing_kw3308) {var if_res2043 = M0.format(M0.string_append("application: required keyword argument not supplied\n","  procedure: ~a\n","  required keyword: ~a","~a"),proc_name3312(p3295),missing_kw3308,args_str3311);} else {var temp2042 = M0.string_append("application: no case matching ~a non-keyword argument~a\n","  procedure: ~a","~a");if (M0._eq_(1,n3310-2)) {var if_res2041 = "";} else {var if_res2041 = "s";}var if_res2043 = M0.format(temp2042,n3310-2,if_res2041,proc_name3312(p3295),args_str3311);}var if_res2044 = if_res2043;}return M0.raise(M0.__rjs_quoted__.exn_fail_contract(if_res2044,M0.current_continuation_marks()));});}var if_res2046 = if_res2045;}return if_res2046;};var keyword_procedure_extract = function(p3321, kws3322, n3323) {return keyword_procedure_extract_by_method(kws3322,n3323,p3321,0);};var procedure_reduce_keyword_arity = function(proc3324, arity3325, req_kw3326, allowed_kw3327) {if (okp_p(proc3324)) {var if_res2047 = okp_ref(proc3324,0);} else {var if_res2047 = proc3324;}var plain_proc3328 = M0.__rjs_quoted__.procedure_reduce_arity(if_res2047,arity3325);var sorted_p3329 = function(kws3330) {var loop3331 = function(kws3332) {if (M0.null_p(kws3332)) {var if_res2050 = true;} else {if (M0.null_p(M0.cdr(kws3332))) {var if_res2049 = true;} else {if (M0.__rjs_quoted__.keyword_lt__p(M0.car(kws3332),M0.cadr(kws3332))) {var if_res2048 = loop3331(M0.cdr(kws3332));} else {var if_res2048 = false;}var if_res2049 = if_res2048;}var if_res2050 = if_res2049;}return if_res2050;};return loop3331(kws3330);};if (M0.list_p(req_kw3326)) {if (M0.andmap(M0.__rjs_quoted__.keyword_p,req_kw3326)) {var if_res2051 = sorted_p3329(req_kw3326);} else {var if_res2051 = false;}var if_res2052 = if_res2051;} else {var if_res2052 = false;}if (if_res2052) {var if_res2053 = M0.rvoid();} else {var if_res2053 = M0.raise_argument_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"(and/c (listof? keyword?) sorted? distinct?)",2,proc3324,arity3325,req_kw3326,allowed_kw3327);}if_res2053;if (allowed_kw3327) {if (M0.list_p(allowed_kw3327)) {if (M0.andmap(M0.__rjs_quoted__.keyword_p,allowed_kw3327)) {var if_res2054 = sorted_p3329(allowed_kw3327);} else {var if_res2054 = false;}var if_res2055 = if_res2054;} else {var if_res2055 = false;}if (if_res2055) {var if_res2056 = M0.rvoid();} else {var if_res2056 = M0.raise_argument_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"(or/c (and/c (listof? keyword?) sorted? distinct?) #f)",3,proc3324,arity3325,req_kw3326,allowed_kw3327);}if_res2056;if (subset_p(req_kw3326,allowed_kw3327)) {var if_res2057 = M0.rvoid();} else {var if_res2057 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"allowed-keyword list does not include all required keywords","allowed-keyword list",allowed_kw3327,"required keywords",req_kw3326);}var if_res2058 = if_res2057;} else {var if_res2058 = M0.rvoid();}if_res2058;var let_result2059 = procedure_keywords(proc3324);var old_req3333 = let_result2059.getAt(0);var old_allowed3334 = let_result2059.getAt(1);if (subset_p(old_req3333,req_kw3326)) {var if_res2060 = M0.rvoid();} else {var if_res2060 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"cannot reduce required keyword set","required keywords",old_req3333,"requested required keywords",req_kw3326);}if_res2060;if (old_allowed3334) {if (subset_p(req_kw3326,old_allowed3334)) {var if_res2061 = M0.rvoid();} else {var if_res2061 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"cannot require keywords not in original allowed set","original allowed keywords",old_allowed3334,"requested required keywords",req_kw3326);}if_res2061;var or_part3335 = M0.not(allowed_kw3327);if (or_part3335) {var if_res2062 = or_part3335;} else {var if_res2062 = subset_p(allowed_kw3327,old_allowed3334);}if (if_res2062) {var if_res2063 = M0.rvoid();} else {var if_res2063 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("procedure-reduce-keyword-arity"),"cannot allow keywords not in original allowed set","original allowed keywords",old_allowed3334,"requested allowed keywords",allowed_kw3327);}var if_res2064 = if_res2063;} else {var if_res2064 = M0.rvoid();}if_res2064;if (M0.null_p(allowed_kw3327)) {var if_res2073 = plain_proc3328;} else {var inc_arity3336 = function(arity3337, delta3338) {var loop3339 = function(a3340) {if (M0.integer_p(a3340)) {var if_res2066 = a3340+delta3338;} else {if (M0.arity_at_least_p(a3340)) {var if_res2065 = M0.arity_at_least(M0.arity_at_least_value(a3340)+delta3338);} else {var if_res2065 = M0.map(loop3339,a3340);}var if_res2066 = if_res2065;}return if_res2066;};return loop3339(arity3337);};var new_arity3341 = inc_arity3336(arity3325,2);var kw_checker3342 = make_keyword_checker(req_kw3326,allowed_kw3327,new_arity3341);var proc3343 = normalize_proc(proc3324);var new_kw_proc3344 = M0.__rjs_quoted__.procedure_reduce_arity(keyword_procedure_proc(proc3343),new_arity3341);if (M0.null_p(req_kw3326)) {if (okm_p(proc3343)) {var if_res2067 = make_optional_keyword_method;} else {var if_res2067 = make_optional_keyword_procedure;}var if_res2072 = if_res2067(kw_checker3342,new_kw_proc3344,req_kw3326,allowed_kw3327,plain_proc3328);} else {if (named_keyword_procedure_p(proc3343)) {var if_res2070 = M0.car(keyword_procedure_name_plus_fail(proc3343));} else {var if_res2070 = false;}var or_part3345 = if_res2070;if (or_part3345) {var if_res2071 = or_part3345;} else {var if_res2071 = M0.__rjs_quoted__.object_name(proc3343);}var temp2069 = M0.__rjs_quoted__.procedure_reduce_arity(missing_kw,inc_arity3336(arity3325,1));var or_part3346 = okm_p(proc3343);if (or_part3346) {var if_res2068 = or_part3346;} else {var if_res2068 = keyword_method_p(proc3343);}var if_res2072 = make_required(if_res2071,temp2069,if_res2068,false)(kw_checker3342,new_kw_proc3344,req_kw3326,allowed_kw3327);}var if_res2073 = if_res2072;}return if_res2073;};var procedure_reduce_arity3347 = function(proc3348, arity3349) {if (M0.procedure_p(proc3348)) {var let_result2074 = procedure_keywords(proc3348);var req3350 = let_result2074.getAt(0);var allows3351 = let_result2074.getAt(1);if (M0.pair_p(req3350)) {var if_res2075 = M0.not(M0.null_p(arity3349));} else {var if_res2075 = false;}var if_res2076 = if_res2075;} else {var if_res2076 = false;}if (if_res2076) {var if_res2078 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("procedure-reduce-arity"),"procedure has required keyword arguments","procedure",proc3348);} else {if (okm_p(proc3348)) {var if_res2077 = M0.__rjs_quoted__.procedure__gt_method(proc3348);} else {var if_res2077 = proc3348;}var if_res2078 = M0.__rjs_quoted__.procedure_reduce_arity(if_res2077,arity3349);}return if_res2078;};var new_procedure_reduce_arity = procedure_reduce_arity3347;var procedure__gt_method3352 = function(proc3353) {var proc3354 = normalize_proc(proc3353);if (keyword_procedure_p(proc3354)) {if (okm_p(proc3354)) {var if_res2081 = proc3354;} else {if (keyword_method_p(proc3354)) {var if_res2080 = proc3354;} else {if (okp_p(proc3354)) {var if_res2079 = make_optional_keyword_method(keyword_procedure_checker(proc3354),keyword_procedure_proc(proc3354),keyword_procedure_required(proc3354),keyword_procedure_allowed(proc3354),okp_ref(proc3354,0));} else {var name_plus_fail3355 = keyword_procedure_name_plus_fail(proc3354);var mk3356 = make_required(M0.car(name_plus_fail3355),M0.cdr(name_plus_fail3355),true,false);var if_res2079 = mk3356(keyword_procedure_checker(proc3354),keyword_procedure_proc(proc3354),keyword_procedure_required(proc3354),keyword_procedure_allowed(proc3354));}var if_res2080 = if_res2079;}var if_res2081 = if_res2080;}var if_res2082 = if_res2081;} else {var if_res2082 = M0.__rjs_quoted__.procedure__gt_method(proc3354);}return if_res2082;};var new_procedure__gt_method = procedure__gt_method3352;var procedure_rename3357 = function(proc3358, name3359) {if (keyword_procedure_p(proc3358)) {var if_res2083 = M0.symbol_p(name3359);} else {var if_res2083 = false;}if (M0.not(if_res2083)) {var if_res2086 = M0.__rjs_quoted__.procedure_rename(proc3358,name3359);} else {if (okp_p(proc3358)) {if (okm_p(proc3358)) {var if_res2084 = make_optional_keyword_procedure;} else {var if_res2084 = make_optional_keyword_method;}var if_res2085 = if_res2084(keyword_procedure_checker(proc3358),keyword_procedure_proc(proc3358),keyword_procedure_required(proc3358),keyword_procedure_allowed(proc3358),M0.__rjs_quoted__.procedure_rename(okp_ref(proc3358,0),name3359));} else {var name_plus_fail3360 = keyword_procedure_name_plus_fail(proc3358);var mk3361 = make_required(name3359,M0.cdr(name_plus_fail3360),keyword_method_p(proc3358),false);var if_res2085 = mk3361(keyword_procedure_checker(proc3358),keyword_procedure_proc(proc3358),keyword_procedure_required(proc3358),keyword_procedure_allowed(proc3358));}var if_res2086 = if_res2085;}return if_res2086;};var new_procedure_rename = procedure_rename3357;var chaperone_procedure3362 = $rjs_core.attachProcedureArity(function(proc3363, wrap_proc3364) {var props3365 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_chaperone_procedure(false,false,M0.__rjs_quoted__.chaperone_procedure,$rjs_core.Symbol.make("chaperone-procedure"),proc3363,wrap_proc3364,props3365);});var new_chaperone_procedure = chaperone_procedure3362;var unsafe_chaperone_procedure3366 = $rjs_core.attachProcedureArity(function(proc3367, wrap_proc3368) {var props3369 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_unsafe_chaperone_procedure(M1.__rjs_quoted__.unsafe_chaperone_procedure,$rjs_core.Symbol.make("unsafe-chaperone-procedure"),proc3367,wrap_proc3368,props3369);});var new_unsafe_chaperone_procedure = unsafe_chaperone_procedure3366;var impersonate_procedure3370 = $rjs_core.attachProcedureArity(function(proc3371, wrap_proc3372) {var props3373 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_chaperone_procedure(true,false,M0.__rjs_quoted__.impersonate_procedure,$rjs_core.Symbol.make("impersonate-procedure"),proc3371,wrap_proc3372,props3373);});var new_impersonate_procedure = impersonate_procedure3370;var unsafe_impersonate_procedure3374 = $rjs_core.attachProcedureArity(function(proc3375, wrap_proc3376) {var props3377 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_unsafe_chaperone_procedure(M1.__rjs_quoted__.unsafe_impersonate_procedure,$rjs_core.Symbol.make("unsafe-impersonate-procedure"),proc3375,wrap_proc3376,props3377);});var new_unsafe_impersonate_procedure = unsafe_impersonate_procedure3374;var chaperone_procedure_times_3378 = $rjs_core.attachProcedureArity(function(proc3379, wrap_proc3380) {var props3381 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_chaperone_procedure(false,true,M0.__rjs_quoted__.chaperone_procedure_times_,$rjs_core.Symbol.make("chaperone-procedure"),proc3379,wrap_proc3380,props3381);});var new_chaperone_procedure_times_ = chaperone_procedure_times_3378;var impersonate_procedure_times_3382 = $rjs_core.attachProcedureArity(function(proc3383, wrap_proc3384) {var props3385 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return do_chaperone_procedure(true,true,M0.__rjs_quoted__.impersonate_procedure_times_,$rjs_core.Symbol.make("impersonate-procedure"),proc3383,wrap_proc3384,props3385);});var new_impersonate_procedure_times_ = impersonate_procedure_times_3382;var do_chaperone_procedure = function(is_impersonator_p3386, self_arg_p3387, chaperone_procedure3388, name3389, proc3390, wrap_proc3391, props3392) {var n_proc3393 = normalize_proc(proc3390);var n_wrap_proc3394 = normalize_proc(wrap_proc3391);var or_part3395 = M0.not(keyword_procedure_p(n_proc3393));if (or_part3395) {var if_res2088 = or_part3395;} else {var or_part3396 = M0.not(M0.procedure_p(wrap_proc3391));if (or_part3396) {var if_res2087 = or_part3396;} else {var if_res2087 = bad_props_p(props3392);}var if_res2088 = if_res2087;}if (if_res2088) {var if_res2131 = M0.apply(chaperone_procedure3388,proc3390,wrap_proc3391,props3392);} else {chaperone_arity_match_checking(self_arg_p3387,name3389,proc3390,wrap_proc3391,props3392);var p3398 = keyword_procedure_proc(n_wrap_proc3394);if (self_arg_p3387) {var cl2089 = $rjs_core.attachProcedureArity(function(self_proc3399, kws3400, args3401) {var rest3402 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),3));return M0.call_with_values(function() {return M0.apply(p3398,kws3400,args3401,self_proc3399,rest3402);},$rjs_core.attachProcedureArity(function() {var results3403 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));var len3404 = M0.length(results3403);var alen3405 = M0.length(rest3402);if (M0._lt_(len3404,alen3405+1)) {var if_res2094 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),"wrong number of results from wrapper procedure","expected minimum number of results",alen3405+1,"received number of results",len3404,"wrapper procedure",wrap_proc3391);} else {var if_res2094 = M0.rvoid();}if_res2094;var num_extra3406 = len3404-(alen3405+1);var new_args3407 = M0.list_ref(results3403,num_extra3406);if (M0.list_p(new_args3407)) {var if_res2095 = M0._eq_(M0.length(new_args3407),M0.length(args3401));} else {var if_res2095 = false;}if (if_res2095) {var if_res2097 = M0.rvoid();} else {if (M0._eq_(len3404,alen3405)) {var if_res2096 = "";} else {var if_res2096 = " (after the result-wrapper procedure or mark specifications)";}var if_res2097 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),M0.format("expected a list of keyword-argument values as first result~a from wrapper procedure",if_res2096),"first result",new_args3407,"wrapper procedure",wrap_proc3391);}if_res2097;M0.for_each(function(kw3408, new_arg3409, arg3410) {if (is_impersonator_p3386) {var if_res2099 = M0.rvoid();} else {if (M0.__rjs_quoted__.chaperone_of_p(new_arg3409,arg3410)) {var if_res2098 = M0.rvoid();} else {var if_res2098 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),M0.format("~a keyword result is not a chaperone of original argument from chaperoning procedure",kw3408),"result",new_arg3409,"wrapper procedure",wrap_proc3391);}var if_res2099 = if_res2098;}return if_res2099;},kws3400,new_args3407,args3401);var tmp3411 = num_extra3406;if (M0.equal_p(tmp3411,0)) {var if_res2102 = M0.apply(M0.values,kws3400,results3403);} else {if (M0.equal_p(tmp3411,1)) {var if_res2101 = M0.apply(M0.values,M0.car(results3403),kws3400,M0.cdr(results3403));} else {var loop3412 = function(results3413, c3414) {if (M0.zero_p(c3414)) {var if_res2100 = M0.cons(kws3400,results3413);} else {var if_res2100 = M0.cons(M0.car(results3413),loop3412(M0.cdr(results3413),M0.sub1(c3414)));}return if_res2100;};var if_res2101 = M0.apply(M0.values,loop3412(results3403,num_extra3406));}var if_res2102 = if_res2101;}return if_res2102;}));});var cl2090 = $rjs_core.attachProcedureArity(function() {var other3415 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));return M0.error("shouldn't get here");});var if_res2117 = $rjs_core.attachProcedureArity(function() {var fixed_lam2091 = {}[arguments.length];if (fixed_lam2091!==undefined) {return fixed_lam2091.apply(null,arguments);} else {if (M0._gt__eq_(cl2089.length,1)) {var if_res2093 = cl2089.apply(null,arguments);} else {if (true) {var if_res2092 = cl2090.apply(null,arguments);} else {var if_res2092 = M0.error("case-lambda: invalid case");}var if_res2093 = if_res2092;}return if_res2093;}},[M0.make_arity_at_least(0)]);} else {var cl2103 = $rjs_core.attachProcedureArity(function(kws3416, args3417) {var rest3418 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return M0.call_with_values(function() {return M0.apply(p3398,kws3416,args3417,rest3418);},$rjs_core.attachProcedureArity(function() {var results3419 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));var len3420 = M0.length(results3419);var alen3421 = M0.length(rest3418);if (M0._lt_(len3420,alen3421+1)) {var if_res2108 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),"wrong number of results from wrapper procedure","expected minimum number of results",alen3421+1,"received number of results",len3420,"wrapper procedure",wrap_proc3391);} else {var if_res2108 = M0.rvoid();}if_res2108;var num_extra3422 = len3420-(alen3421+1);var new_args3423 = M0.list_ref(results3419,num_extra3422);if (M0.list_p(new_args3423)) {var if_res2109 = M0._eq_(M0.length(new_args3423),M0.length(args3417));} else {var if_res2109 = false;}if (if_res2109) {var if_res2111 = M0.rvoid();} else {if (M0._eq_(len3420,alen3421)) {var if_res2110 = "";} else {var if_res2110 = " (after the result-wrapper procedure or mark specifications)";}var if_res2111 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),M0.format("expected a list of keyword-argument values as first result~a from wrapper procedure",if_res2110),"first result",new_args3423,"wrapper procedure",wrap_proc3391);}if_res2111;M0.for_each(function(kw3424, new_arg3425, arg3426) {if (is_impersonator_p3386) {var if_res2113 = M0.rvoid();} else {if (M0.__rjs_quoted__.chaperone_of_p(new_arg3425,arg3426)) {var if_res2112 = M0.rvoid();} else {var if_res2112 = M0.__rjs_quoted__.raise_arguments_error($rjs_core.Symbol.make("keyword procedure chaperone"),M0.format("~a keyword result is not a chaperone of original argument from chaperoning procedure",kw3424),"result",new_arg3425,"wrapper procedure",wrap_proc3391);}var if_res2113 = if_res2112;}return if_res2113;},kws3416,new_args3423,args3417);var tmp3427 = num_extra3422;if (M0.equal_p(tmp3427,0)) {var if_res2116 = M0.apply(M0.values,kws3416,results3419);} else {if (M0.equal_p(tmp3427,1)) {var if_res2115 = M0.apply(M0.values,M0.car(results3419),kws3416,M0.cdr(results3419));} else {var loop3428 = function(results3429, c3430) {if (M0.zero_p(c3430)) {var if_res2114 = M0.cons(kws3416,results3429);} else {var if_res2114 = M0.cons(M0.car(results3429),loop3428(M0.cdr(results3429),M0.sub1(c3430)));}return if_res2114;};var if_res2115 = M0.apply(M0.values,loop3428(results3419,num_extra3422));}var if_res2116 = if_res2115;}return if_res2116;}));});var cl2104 = $rjs_core.attachProcedureArity(function() {var other3431 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));return M0.error("shouldn't get here");});var if_res2117 = $rjs_core.attachProcedureArity(function() {var fixed_lam2105 = {}[arguments.length];if (fixed_lam2105!==undefined) {return fixed_lam2105.apply(null,arguments);} else {if (M0._gt__eq_(cl2103.length,1)) {var if_res2107 = cl2103.apply(null,arguments);} else {if (true) {var if_res2106 = cl2104.apply(null,arguments);} else {var if_res2106 = M0.error("case-lambda: invalid case");}var if_res2107 = if_res2106;}return if_res2107;}},[M0.make_arity_at_least(0)]);}var kw_chaperone3397 = if_res2117;var wrap3434 = function(proc3435, n_proc3436) {if (M0.not(M0.eq_p(n_proc3436,proc3435))) {var if_res2118 = new_procedure_p(proc3435);} else {var if_res2118 = false;}if (if_res2118) {var v3437 = new_procedure_ref(proc3435);if (M0.exact_integer_p(v3437)) {var acc3438 = procedure_accessor_ref(proc3435);var if_res2123 = M0.values(M0.__rjs_quoted__.chaperone_struct(proc3435,acc3438,function(self3439, sub_proc3440) {var let_result2119 = wrap3434(sub_proc3440,normalize_proc(sub_proc3440));var f3441 = let_result2119.getAt(0);var acc3442 = let_result2119.getAt(1);return f3441;}),acc3438);} else {var if_res2123 = M0.values(M0.__rjs_quoted__.chaperone_struct(proc3435,new_procedure_ref,function(self3443, proc3444) {if (self_arg_p3387) {var if_res2122 = $rjs_core.attachProcedureArity(function(proc_self3445, kws3446, kw_args3447, self3448) {var args3449 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),4));var len3450 = M0.length(args3449);return M0.call_with_values(function() {return M0.apply(kw_chaperone3397,proc_self3445,kws3446,kw_args3447,args3449);},$rjs_core.attachProcedureArity(function() {var results3451 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));if (M0._eq_(M0.length(results3451),M0.add1(len3450))) {var if_res2120 = M0.apply(M0.values,M0.car(results3451),self3448,M0.cdr(results3451));} else {var if_res2120 = M0.apply(M0.values,M0.car(results3451),M0.cadr(results3451),self3448,M0.cddr(results3451));}return if_res2120;}));});} else {var if_res2122 = $rjs_core.attachProcedureArity(function(kws3452, kw_args3453, self3454) {var args3455 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),3));var len3456 = M0.length(args3455);return M0.call_with_values(function() {return M0.apply(kw_chaperone3397,kws3452,kw_args3453,args3455);},$rjs_core.attachProcedureArity(function() {var results3457 = $rjs_core.Pair.listFromArray($rjs_core.argumentsToArray(arguments));if (M0._eq_(M0.length(results3457),M0.add1(len3456))) {var if_res2121 = M0.apply(M0.values,M0.car(results3457),self3454,M0.cdr(results3457));} else {var if_res2121 = M0.apply(M0.values,M0.car(results3457),M0.cadr(results3457),self3454,M0.cddr(results3457));}return if_res2121;}));});}return chaperone_procedure3388(proc3444,make_keyword_procedure(if_res2122));}),new_procedure_ref);}var if_res2128 = if_res2123;} else {if (okp_p(n_proc3436)) {if (is_impersonator_p3386) {if (okm_p(n_proc3436)) {var if_res2124 = make_optional_keyword_method_impersonator;} else {var if_res2124 = make_optional_keyword_procedure_impersonator;}var if_res2125 = if_res2124(keyword_procedure_checker(n_proc3436),chaperone_procedure3388(keyword_procedure_proc(n_proc3436),kw_chaperone3397),keyword_procedure_required(n_proc3436),keyword_procedure_allowed(n_proc3436),chaperone_procedure3388(okp_ref(n_proc3436,0),okp_ref(n_wrap_proc3394,0)),n_proc3436);} else {var if_res2125 = M0.__rjs_quoted__.chaperone_struct(proc3435,keyword_procedure_proc,function(self3458, proc3459) {return chaperone_procedure3388(proc3459,kw_chaperone3397);},M0.make_struct_field_accessor(okp_ref,0),function(self3460, proc3461) {return chaperone_procedure3388(proc3461,okp_ref(n_wrap_proc3394,0));});}var if_res2127 = M0.values(if_res2125,keyword_procedure_proc);} else {if (is_impersonator_p3386) {var name_plus_fail3462 = keyword_procedure_name_plus_fail(n_proc3436);var mk3463 = make_required(M0.car(name_plus_fail3462),M0.cdr(name_plus_fail3462),keyword_method_p(n_proc3436),true);var if_res2126 = mk3463(keyword_procedure_checker(n_proc3436),chaperone_procedure3388(keyword_procedure_proc(n_proc3436),kw_chaperone3397),keyword_procedure_required(n_proc3436),keyword_procedure_allowed(n_proc3436),n_proc3436);} else {var if_res2126 = M0.__rjs_quoted__.chaperone_struct(n_proc3436,keyword_procedure_proc,function(self3464, proc3465) {return chaperone_procedure3388(proc3465,kw_chaperone3397);});}var if_res2127 = M0.values(if_res2126,keyword_procedure_proc);}var if_res2128 = if_res2127;}return if_res2128;};var let_result2129 = wrap3434(proc3390,n_proc3393);var new_proc3432 = let_result2129.getAt(0);var chap_accessor3433 = let_result2129.getAt(1);if (M0.null_p(props3392)) {var if_res2130 = new_proc3432;} else {var if_res2130 = M0.apply(M0.__rjs_quoted__.chaperone_struct,new_proc3432,chap_accessor3433,false,props3392);}var if_res2131 = if_res2130;}return if_res2131;};var do_unsafe_chaperone_procedure = function(unsafe_chaperone_procedure3466, name3467, proc3468, wrap_proc3469, props3470) {var n_proc3471 = normalize_proc(proc3468);var n_wrap_proc3472 = normalize_proc(wrap_proc3469);var or_part3473 = M0.not(keyword_procedure_p(n_proc3471));if (or_part3473) {var if_res2133 = or_part3473;} else {var or_part3474 = M0.not(M0.procedure_p(wrap_proc3469));if (or_part3474) {var if_res2132 = or_part3474;} else {var if_res2132 = bad_props_p(props3470);}var if_res2133 = if_res2132;}if (if_res2133) {var if_res2134 = M0.apply(unsafe_chaperone_procedure3466,proc3468,wrap_proc3469,props3470);} else {chaperone_arity_match_checking(false,name3467,proc3468,wrap_proc3469,props3470);var if_res2134 = M0.apply(unsafe_chaperone_procedure3466,proc3468,wrap_proc3469,props3470);}return if_res2134;};var bad_props_p = function(props3475) {var loop3476 = function(props3477) {if (M0.null_p(props3477)) {var if_res2137 = false;} else {if (M0.__rjs_quoted__.impersonator_property_p(M0.car(props3477))) {var props3478 = M0.cdr(props3477);var or_part3479 = M0.null_p(props3478);if (or_part3479) {var if_res2135 = or_part3479;} else {var if_res2135 = loop3476(M0.cdr(props3478));}var if_res2136 = if_res2135;} else {var if_res2136 = true;}var if_res2137 = if_res2136;}return if_res2137;};return loop3476(props3475);};var chaperone_arity_match_checking = function(self_arg_p3480, name3481, proc3482, wrap_proc3483, props3484) {var a3485 = M0.procedure_arity(proc3482);var b3486 = M0.procedure_arity(wrap_proc3483);if (self_arg_p3480) {var if_res2138 = 1;} else {var if_res2138 = 0;}var d3487 = if_res2138;var let_result2139 = procedure_keywords(proc3482);var a_req3488 = let_result2139.getAt(0);var a_allow3489 = let_result2139.getAt(1);var let_result2140 = procedure_keywords(wrap_proc3483);var b_req3490 = let_result2140.getAt(0);var b_allow3491 = let_result2140.getAt(1);var includes_p3492 = function(a3493, b3494) {if (M0.number_p(b3494)) {if (M0.number_p(a3493)) {var if_res2142 = M0._eq_(b3494,a3493+d3487);} else {if (M0.arity_at_least_p(a3493)) {var if_res2141 = M0._gt__eq_(b3494,M0.arity_at_least_value(a3493)+d3487);} else {var if_res2141 = M0.ormap(function(a3495) {return includes_p3492(a3495,b3494);},a3493);}var if_res2142 = if_res2141;}var if_res2146 = if_res2142;} else {if (M0.arity_at_least_p(b3494)) {if (M0.number_p(a3493)) {var if_res2144 = false;} else {if (M0.arity_at_least_p(a3493)) {var if_res2143 = M0._gt__eq_(M0.arity_at_least_value(b3494),M0.arity_at_least_value(a3493)+d3487);} else {var if_res2143 = M0.ormap(function(a3496) {return includes_p3492(b3494,a3496);},a3493);}var if_res2144 = if_res2143;}var if_res2145 = if_res2144;} else {var if_res2145 = M0.andmap(function(b3497) {return includes_p3492(a3493,b3497);},b3494);}var if_res2146 = if_res2145;}return if_res2146;};if (includes_p3492(b3486,a3485)) {var if_res2147 = M0.rvoid();} else {var if_res2147 = M0.apply(M0.__rjs_quoted__.chaperone_procedure,proc3482,wrap_proc3483,props3484);}if_res2147;if (subset_p(b_req3490,a_req3488)) {var if_res2148 = M0.rvoid();} else {var if_res2148 = M0.__rjs_quoted__.raise_arguments_error(name3481,"wrapper procedure requires more keywords than original procedure","wrapper procedure",wrap_proc3483,"original procedure",proc3482);}if_res2148;var or_part3498 = M0.not(b_allow3491);if (or_part3498) {var if_res2150 = or_part3498;} else {if (a_allow3489) {var if_res2149 = subset_p(a_allow3489,b_allow3491);} else {var if_res2149 = false;}var if_res2150 = if_res2149;}if (if_res2150) {var if_res2151 = M0.rvoid();} else {var if_res2151 = M0.__rjs_quoted__.raise_arguments_error(name3481,"wrapper procedure does not accept all keywords of original procedure","wrapper procedure",wrap_proc3483,"original procedure",proc3482);}if_res2151;return M0.rvoid();};var normalize_proc = function(proc3499) {if (keyword_procedure_p(proc3499)) {var if_res2158 = proc3499;} else {if (new_procedure_p(proc3499)) {var let_result2152 = procedure_keywords(proc3499);var req_kws3500 = let_result2152.getAt(0);var allowed_kws3501 = let_result2152.getAt(1);if (M0.null_p(allowed_kws3501)) {var if_res2156 = proc3499;} else {var if_res2156 = make_optional_keyword_procedure(function(given_kws3502, given_argc3503) {if (M0.procedure_arity_includes_p(proc3499,given_argc3503-2,true)) {var or_part3504 = M0.not(allowed_kws3501);if (or_part3504) {var if_res2153 = or_part3504;} else {var if_res2153 = subset_p(given_kws3502,allowed_kws3501);}if (if_res2153) {var if_res2154 = subset_p(req_kws3500,given_kws3502);} else {var if_res2154 = false;}var if_res2155 = if_res2154;} else {var if_res2155 = false;}return if_res2155;},$rjs_core.attachProcedureArity(function(kws3505, kw_args3506) {var vals3507 = $rjs_core.Pair.listFromArray($rjs_core.argumentsSlice($rjs_core.argumentsToArray(arguments),2));return keyword_apply(proc3499,kws3505,kw_args3506,vals3507);}),req_kws3500,allowed_kws3501,proc3499);}var if_res2157 = if_res2156;} else {var if_res2157 = proc3499;}var if_res2158 = if_res2157;}return if_res2158;};var __rjs_quoted__ = {};__rjs_quoted__.make_required = make_required;__rjs_quoted__.keyword_procedure_extract = keyword_procedure_extract;__rjs_quoted__.make_optional_keyword_method = make_optional_keyword_method;__rjs_quoted__.subsets_p = subsets_p;__rjs_quoted__.subset_p = subset_p;__rjs_quoted__.missing_kw = missing_kw;__rjs_quoted__.make_optional_keyword_procedure = make_optional_keyword_procedure;__rjs_quoted__.struct_keyword_procedure = struct_keyword_procedure;export { __rjs_quoted__,new_impersonate_procedure_times_,new_chaperone_procedure_times_,new_impersonate_procedure,new_chaperone_procedure,new_procedure_rename,new_procedure__gt_method,new_prop_procedure,procedure_reduce_keyword_arity,new_procedure_reduce_arity,procedure_keywords,keyword_apply,make_keyword_procedure };