"use strict";
exports.__esModule = true;
var c151a835ceacdb11090d1960ae92771fe;
if (typeof c151a835ceacdb11090d1960ae92771fe === "undefined")
    c151a835ceacdb11090d1960ae92771fe = $ir_contract_for("number");
$ir_obj_def_const(this, "c151a835ceacdb11090d1960ae92771fec", c151a835ceacdb11090d1960ae92771fe, true);
var c39c6844c921cf69656adaa2a8e4aea0c;
if (typeof c39c6844c921cf69656adaa2a8e4aea0c === "undefined")
    c39c6844c921cf69656adaa2a8e4aea0c = $ir_contract_for("string");
$ir_obj_def_const(this, "c39c6844c921cf69656adaa2a8e4aea0cc", c39c6844c921cf69656adaa2a8e4aea0c, true);
function c662ea7dc8a9f859acf376aa67873938ff() {
    "Array";
    if (typeof c662ea7dc8a9f859acf376aa67873938f !== "undefined")
        return c662ea7dc8a9f859acf376aa67873938f;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "length", co);
    c = $ir_contract_oblige_array(c, co);
    c662ea7dc8a9f859acf376aa67873938f = c;
    $ir_contract_oblige_member(c, "length", c151a835ceacdb11090d1960ae92771fe);
    c = $ir_contract_oblige_array(c, c39c6844c921cf69656adaa2a8e4aea0c);
    return c;
}
var c662ea7dc8a9f859acf376aa67873938f;
if (typeof c662ea7dc8a9f859acf376aa67873938f === "undefined")
    c662ea7dc8a9f859acf376aa67873938f = c662ea7dc8a9f859acf376aa67873938ff();
$ir_obj_def_const(this, "c662ea7dc8a9f859acf376aa67873938fc", c662ea7dc8a9f859acf376aa67873938f, true);
function cec88372874868d65bd05d6a88c713cddf() {
    "Label";
    if (typeof cec88372874868d65bd05d6a88c713cdd !== "undefined")
        return cec88372874868d65bd05d6a88c713cdd;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "datum", co);
    c = $ir_contract_oblige_member(c, "i", co);
    c = $ir_contract_oblige_member(c, "j", co);
    cec88372874868d65bd05d6a88c713cdd = c;
    $ir_contract_oblige_member(c, "datum", c39c6844c921cf69656adaa2a8e4aea0c);
    $ir_contract_oblige_member(c, "i", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "j", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var cec88372874868d65bd05d6a88c713cdd;
if (typeof cec88372874868d65bd05d6a88c713cdd === "undefined")
    cec88372874868d65bd05d6a88c713cdd = cec88372874868d65bd05d6a88c713cddf();
$ir_obj_def_const(this, "cec88372874868d65bd05d6a88c713cddc", cec88372874868d65bd05d6a88c713cdd, true);
function c84fb510a892c3bfcd3fbde636cfc1fdcf() {
    "Array";
    if (typeof c84fb510a892c3bfcd3fbde636cfc1fdc !== "undefined")
        return c84fb510a892c3bfcd3fbde636cfc1fdc;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "length", co);
    c = $ir_contract_oblige_array(c, co);
    c84fb510a892c3bfcd3fbde636cfc1fdc = c;
    $ir_contract_oblige_member(c, "length", c151a835ceacdb11090d1960ae92771fe);
    c = $ir_contract_oblige_array(c, c1919ec94bf6e77835438f19b15184bdbf());
    return c;
}
var c84fb510a892c3bfcd3fbde636cfc1fdc;
if (typeof c84fb510a892c3bfcd3fbde636cfc1fdc === "undefined")
    c84fb510a892c3bfcd3fbde636cfc1fdc = c84fb510a892c3bfcd3fbde636cfc1fdcf();
$ir_obj_def_const(this, "c84fb510a892c3bfcd3fbde636cfc1fdcc", c84fb510a892c3bfcd3fbde636cfc1fdc, true);
function c1919ec94bf6e77835438f19b15184bdbf() {
    "STNode";
    if (typeof c1919ec94bf6e77835438f19b15184bdb !== "undefined")
        return c1919ec94bf6e77835438f19b15184bdb;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "upLabel", co);
    c = $ir_contract_oblige_member(c, "parent", co);
    c = $ir_contract_oblige_member(c, "children", co);
    c = $ir_contract_oblige_member(c, "suffixLink", co);
    c = $ir_contract_oblige_member(c, "spID", co);
    c1919ec94bf6e77835438f19b15184bdb = c;
    $ir_contract_oblige_member(c, "upLabel", cec88372874868d65bd05d6a88c713cddf());
    $ir_contract_oblige_member(c, "parent", c1919ec94bf6e77835438f19b15184bdbf());
    $ir_contract_oblige_member(c, "children", c84fb510a892c3bfcd3fbde636cfc1fdcf());
    $ir_contract_oblige_member(c, "suffixLink", c1919ec94bf6e77835438f19b15184bdbf());
    $ir_contract_oblige_member(c, "spID", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var c1919ec94bf6e77835438f19b15184bdb;
if (typeof c1919ec94bf6e77835438f19b15184bdb === "undefined")
    c1919ec94bf6e77835438f19b15184bdb = c1919ec94bf6e77835438f19b15184bdbf();
$ir_obj_def_const(this, "c1919ec94bf6e77835438f19b15184bdbc", c1919ec94bf6e77835438f19b15184bdb, true);
function c039618a25fe49bc46e3571a10332d667f() {
    "SuffixTree";
    if (typeof c039618a25fe49bc46e3571a10332d667 !== "undefined")
        return c039618a25fe49bc46e3571a10332d667;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "root", co);
    c039618a25fe49bc46e3571a10332d667 = c;
    $ir_contract_oblige_member(c, "root", c1919ec94bf6e77835438f19b15184bdbf());
    return c;
}
var c039618a25fe49bc46e3571a10332d667;
if (typeof c039618a25fe49bc46e3571a10332d667 === "undefined")
    c039618a25fe49bc46e3571a10332d667 = c039618a25fe49bc46e3571a10332d667f();
$ir_obj_def_const(this, "c039618a25fe49bc46e3571a10332d667c", c039618a25fe49bc46e3571a10332d667, true);
var data_1 = require("./data");
var label_1 = require("./label");
var ukkonen_1 = require("./ukkonen");
var LCS;
(function (LCS) {
    var suffixTreeAddBang = ukkonen_1.Ukkonen.suffixTreeAddBang;
    function pathLabel(node) {
        $rt_addContract(node, c1919ec94bf6e77835438f19b15184bdbc, "lcs.ts(9,20)");
        var buildNewLabel = function (labels, totalLength) {
            var v = [];
            var retStr = "";
            for (var i = labels.length - 1; i >= 0; i--) {
                var curLab = labels[i];
                for (var j = 0; j < curLab.length(); j++) {
                    retStr += curLab.labelRef(j);
                }
            }
            return new data_1.Data.Label(retStr);
        };
        var collectLoop = function (currentNode, collectedLabels, totalLength) {
            if (currentNode) {
                collectedLabels.push(currentNode.upLabel);
                return collectLoop(currentNode.parent, collectedLabels, totalLength + currentNode.upLabel.length());
            }
            else {
                return buildNewLabel(collectedLabels, totalLength);
            }
        };
        return collectLoop(node, [], 0);
    }
    function longestCommonSublabel(label1, label2) {
        $rt_addContract(label1, cec88372874868d65bd05d6a88c713cddc, "lcs.ts(39,32)");
        $rt_addContract(label2, cec88372874868d65bd05d6a88c713cddc, "lcs.ts(39,49)");
        var label1Marks = {};
        var label2Marks = {};
        var deepestNode = new data_1.Data.STNode(new data_1.Data.Label("no lcs"), undefined, [], undefined);
        var deepestDepth = 0;
        var absorbChildrenMarks = function (node, depth) {
            for (var i = 0; i < node.children.length; i++) {
                var child = node.children[i];
                if (label1Marks[child.spID]) {
                    label1Marks[node.spID] = true;
                }
                if (label2Marks[child.spID]) {
                    label2Marks[node.spID] = true;
                }
            }
            if ((label1Marks[node.spID] && label2Marks[node.spID]) &&
                (depth > deepestDepth)) {
                //
                deepestDepth = depth;
                deepestNode = node;
            }
        };
        var markUpInnerNodesBang = function (node, depth) {
            if (node.children.length == 0) {
                if (node.upLabel.isSourceEqual(label1)) {
                    label1Marks[node.spID] = true;
                }
                if (node.upLabel.isSourceEqual(label2)) {
                    label2Marks[node.spID] = true;
                }
            }
            else {
                for (var i = 0; i < node.children.length; i++) {
                    var child = node.children[i];
                    var k = depth + child.upLabel.length();
                    markUpInnerNodesBang(child, k);
                }
                absorbChildrenMarks(node, depth);
            }
        };
        var main = function () {
            var tree = new data_1.Data.SuffixTree();
            // add both words to the suffixtree
            suffixTreeAddBang(tree, label1);
            suffixTreeAddBang(tree, label2);
            markUpInnerNodesBang(tree.root, 0);
            return pathLabel(deepestNode);
        };
        if ((label1.length() == 0) || (label2.length() == 0)) {
            return label_1.Label.stringToLabel("");
        }
        else {
            var ret = main();
            return ret;
        }
    }
    function longestCommonSubstring(s1, s2) {
        $rt_check(s1, "string");
        $rt_check(s2, "string");
        return longestCommonSublabel(label_1.Label.stringToLabelWithSentinel(s1), label_1.Label.stringToLabelWithSentinel(s2)).toString();
    }
    LCS.longestCommonSubstring = longestCommonSubstring;
})(LCS = exports.LCS || (exports.LCS = {}));
