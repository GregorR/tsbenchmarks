"use strict";
exports.__esModule = true;
var c151a835ceacdb11090d1960ae92771fe;
if (typeof c151a835ceacdb11090d1960ae92771fe === "undefined")
    c151a835ceacdb11090d1960ae92771fe = $ir_contract_for("number");
$ir_obj_def_const(this, "c151a835ceacdb11090d1960ae92771fec", c151a835ceacdb11090d1960ae92771fe, true);
function c9deb2b0cfd31e008a148d99a841154baf() {
    "Array";
    if (typeof c9deb2b0cfd31e008a148d99a841154ba !== "undefined")
        return c9deb2b0cfd31e008a148d99a841154ba;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "length", co);
    c = $ir_contract_oblige_array(c, co);
    c9deb2b0cfd31e008a148d99a841154ba = c;
    $ir_contract_oblige_member(c, "length", c151a835ceacdb11090d1960ae92771fe);
    c = $ir_contract_oblige_array(c, c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var c9deb2b0cfd31e008a148d99a841154ba;
if (typeof c9deb2b0cfd31e008a148d99a841154ba === "undefined")
    c9deb2b0cfd31e008a148d99a841154ba = c9deb2b0cfd31e008a148d99a841154baf();
$ir_obj_def_const(this, "c9deb2b0cfd31e008a148d99a841154bac", c9deb2b0cfd31e008a148d99a841154ba, true);
function cba231f20fb6fc388eee39c06308fe87ef() {
    "BigInt";
    if (typeof cba231f20fb6fc388eee39c06308fe87e !== "undefined")
        return cba231f20fb6fc388eee39c06308fe87e;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "value", co);
    c = $ir_contract_oblige_member(c, "arrayValue", co);
    c = $ir_contract_oblige_member(c, "sign", co);
    c = $ir_contract_oblige_member(c, "howDecimal", co);
    cba231f20fb6fc388eee39c06308fe87e = c;
    $ir_contract_oblige_member(c, "value", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "arrayValue", c9deb2b0cfd31e008a148d99a841154baf());
    $ir_contract_oblige_member(c, "sign", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "howDecimal", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var cba231f20fb6fc388eee39c06308fe87e;
if (typeof cba231f20fb6fc388eee39c06308fe87e === "undefined")
    cba231f20fb6fc388eee39c06308fe87e = cba231f20fb6fc388eee39c06308fe87ef();
$ir_obj_def_const(this, "cba231f20fb6fc388eee39c06308fe87ec", cba231f20fb6fc388eee39c06308fe87e, true);
function cb428ee35dde1daf8172dc14bf3090eabf() {
    "ExactRational";
    if (typeof cb428ee35dde1daf8172dc14bf3090eab !== "undefined")
        return cb428ee35dde1daf8172dc14bf3090eab;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "num", co);
    c = $ir_contract_oblige_member(c, "denom", co);
    cb428ee35dde1daf8172dc14bf3090eab = c;
    $ir_contract_oblige_member(c, "num", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "denom", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var cb428ee35dde1daf8172dc14bf3090eab;
if (typeof cb428ee35dde1daf8172dc14bf3090eab === "undefined")
    cb428ee35dde1daf8172dc14bf3090eab = cb428ee35dde1daf8172dc14bf3090eabf();
$ir_obj_def_const(this, "cb428ee35dde1daf8172dc14bf3090eabc", cb428ee35dde1daf8172dc14bf3090eab, true);
function c9c3d4cbbdeb15660563c128f0c7311a1f() {
    "Consts";
    if (typeof c9c3d4cbbdeb15660563c128f0c7311a1 !== "undefined")
        return c9c3d4cbbdeb15660563c128f0c7311a1;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "NS_SECOND", co);
    c = $ir_contract_oblige_member(c, "NS_MILLI", co);
    c = $ir_contract_oblige_member(c, "NS_MICRO", co);
    c = $ir_contract_oblige_member(c, "NS_MINUTE", co);
    c = $ir_contract_oblige_member(c, "NS_HOUR", co);
    c = $ir_contract_oblige_member(c, "NS_DAY", co);
    c = $ir_contract_oblige_member(c, "MILLI_DAY", co);
    c = $ir_contract_oblige_member(c, "DAYS_NS", co);
    c9c3d4cbbdeb15660563c128f0c7311a1 = c;
    $ir_contract_oblige_member(c, "NS_SECOND", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "NS_MILLI", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "NS_MICRO", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "NS_MINUTE", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "NS_HOUR", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "NS_DAY", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "MILLI_DAY", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "DAYS_NS", cb428ee35dde1daf8172dc14bf3090eabf());
    return c;
}
var c9c3d4cbbdeb15660563c128f0c7311a1;
if (typeof c9c3d4cbbdeb15660563c128f0c7311a1 === "undefined")
    c9c3d4cbbdeb15660563c128f0c7311a1 = c9c3d4cbbdeb15660563c128f0c7311a1f();
$ir_obj_def_const(this, "c9c3d4cbbdeb15660563c128f0c7311a1c", c9c3d4cbbdeb15660563c128f0c7311a1, true);
function ce47d9450624f1d498b2010288b025110f() {
    "HMSN";
    if (typeof ce47d9450624f1d498b2010288b025110 !== "undefined")
        return ce47d9450624f1d498b2010288b025110;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "h", co);
    c = $ir_contract_oblige_member(c, "m", co);
    c = $ir_contract_oblige_member(c, "s", co);
    c = $ir_contract_oblige_member(c, "n", co);
    ce47d9450624f1d498b2010288b025110 = c;
    $ir_contract_oblige_member(c, "h", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "m", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "s", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "n", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var ce47d9450624f1d498b2010288b025110;
if (typeof ce47d9450624f1d498b2010288b025110 === "undefined")
    ce47d9450624f1d498b2010288b025110 = ce47d9450624f1d498b2010288b025110f();
$ir_obj_def_const(this, "ce47d9450624f1d498b2010288b025110c", ce47d9450624f1d498b2010288b025110, true);
function c9d621ec1593b6269e269fe4abfa7644af() {
    "YMD";
    if (typeof c9d621ec1593b6269e269fe4abfa7644a !== "undefined")
        return c9d621ec1593b6269e269fe4abfa7644a;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "y", co);
    c = $ir_contract_oblige_member(c, "d", co);
    c9d621ec1593b6269e269fe4abfa7644a = c;
    $ir_contract_oblige_member(c, "y", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "d", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var c9d621ec1593b6269e269fe4abfa7644a;
if (typeof c9d621ec1593b6269e269fe4abfa7644a === "undefined")
    c9d621ec1593b6269e269fe4abfa7644a = c9d621ec1593b6269e269fe4abfa7644af();
$ir_obj_def_const(this, "c9d621ec1593b6269e269fe4abfa7644ac", c9d621ec1593b6269e269fe4abfa7644a, true);
function c88c4fc9dc6ad49b94a0acac0da2a67adf() {
    "Date";
    if (typeof c88c4fc9dc6ad49b94a0acac0da2a67ad !== "undefined")
        return c88c4fc9dc6ad49b94a0acac0da2a67ad;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "ymd", co);
    c = $ir_contract_oblige_member(c, "jdn", co);
    c88c4fc9dc6ad49b94a0acac0da2a67ad = c;
    $ir_contract_oblige_member(c, "ymd", c9d621ec1593b6269e269fe4abfa7644af());
    $ir_contract_oblige_member(c, "jdn", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var c88c4fc9dc6ad49b94a0acac0da2a67ad;
if (typeof c88c4fc9dc6ad49b94a0acac0da2a67ad === "undefined")
    c88c4fc9dc6ad49b94a0acac0da2a67ad = c88c4fc9dc6ad49b94a0acac0da2a67adf();
$ir_obj_def_const(this, "c88c4fc9dc6ad49b94a0acac0da2a67adc", c88c4fc9dc6ad49b94a0acac0da2a67ad, true);
function c2a02e0ed7f0f2f04419c984bc1c284ccf() {
    "Pair";
    if (typeof c2a02e0ed7f0f2f04419c984bc1c284cc !== "undefined")
        return c2a02e0ed7f0f2f04419c984bc1c284cc;
    var co = $ir_contract_for("object");
    var c = co;
    c2a02e0ed7f0f2f04419c984bc1c284cc = c;
    return c;
}
var c2a02e0ed7f0f2f04419c984bc1c284cc;
if (typeof c2a02e0ed7f0f2f04419c984bc1c284cc === "undefined")
    c2a02e0ed7f0f2f04419c984bc1c284cc = c2a02e0ed7f0f2f04419c984bc1c284ccf();
$ir_obj_def_const(this, "c2a02e0ed7f0f2f04419c984bc1c284ccc", c2a02e0ed7f0f2f04419c984bc1c284cc, true);
function c9ef09708d50df0c2e65c55893ccf3b54f() {
    "Time";
    if (typeof c9ef09708d50df0c2e65c55893ccf3b54 !== "undefined")
        return c9ef09708d50df0c2e65c55893ccf3b54;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "hmsn", co);
    c = $ir_contract_oblige_member(c, "ns", co);
    c9ef09708d50df0c2e65c55893ccf3b54 = c;
    $ir_contract_oblige_member(c, "hmsn", ce47d9450624f1d498b2010288b025110f());
    $ir_contract_oblige_member(c, "ns", c151a835ceacdb11090d1960ae92771fe);
    return c;
}
var c9ef09708d50df0c2e65c55893ccf3b54;
if (typeof c9ef09708d50df0c2e65c55893ccf3b54 === "undefined")
    c9ef09708d50df0c2e65c55893ccf3b54 = c9ef09708d50df0c2e65c55893ccf3b54f();
$ir_obj_def_const(this, "c9ef09708d50df0c2e65c55893ccf3b54c", c9ef09708d50df0c2e65c55893ccf3b54, true);
function c185d0e943cabad3e294825d3b5c26f96f() {
    "DateTime";
    if (typeof c185d0e943cabad3e294825d3b5c26f96 !== "undefined")
        return c185d0e943cabad3e294825d3b5c26f96;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "date", co);
    c = $ir_contract_oblige_member(c, "time", co);
    c = $ir_contract_oblige_member(c, "jd", co);
    c185d0e943cabad3e294825d3b5c26f96 = c;
    $ir_contract_oblige_member(c, "date", c88c4fc9dc6ad49b94a0acac0da2a67adf());
    $ir_contract_oblige_member(c, "time", c9ef09708d50df0c2e65c55893ccf3b54f());
    $ir_contract_oblige_member(c, "jd", cb428ee35dde1daf8172dc14bf3090eabf());
    return c;
}
var c185d0e943cabad3e294825d3b5c26f96;
if (typeof c185d0e943cabad3e294825d3b5c26f96 === "undefined")
    c185d0e943cabad3e294825d3b5c26f96 = c185d0e943cabad3e294825d3b5c26f96f();
$ir_obj_def_const(this, "c185d0e943cabad3e294825d3b5c26f96c", c185d0e943cabad3e294825d3b5c26f96, true);
var c39c6844c921cf69656adaa2a8e4aea0c;
if (typeof c39c6844c921cf69656adaa2a8e4aea0c === "undefined")
    c39c6844c921cf69656adaa2a8e4aea0c = $ir_contract_for("string");
$ir_obj_def_const(this, "c39c6844c921cf69656adaa2a8e4aea0cc", c39c6844c921cf69656adaa2a8e4aea0c, true);
function ca606bc0b6ddd960bfdef94094110a768f() {
    "Moment";
    if (typeof ca606bc0b6ddd960bfdef94094110a768 !== "undefined")
        return ca606bc0b6ddd960bfdef94094110a768;
    var co = $ir_contract_for("object");
    var c = co;
    c = $ir_contract_oblige_member(c, "dateTimeLocal", co);
    c = $ir_contract_oblige_member(c, "UTCOffset", co);
    c = $ir_contract_oblige_member(c, "zone", co);
    ca606bc0b6ddd960bfdef94094110a768 = c;
    $ir_contract_oblige_member(c, "dateTimeLocal", c185d0e943cabad3e294825d3b5c26f96f());
    $ir_contract_oblige_member(c, "UTCOffset", c151a835ceacdb11090d1960ae92771fe);
    $ir_contract_oblige_member(c, "zone", c39c6844c921cf69656adaa2a8e4aea0c);
    return c;
}
var ca606bc0b6ddd960bfdef94094110a768;
if (typeof ca606bc0b6ddd960bfdef94094110a768 === "undefined")
    ca606bc0b6ddd960bfdef94094110a768 = ca606bc0b6ddd960bfdef94094110a768f();
$ir_obj_def_const(this, "ca606bc0b6ddd960bfdef94094110a768c", ca606bc0b6ddd960bfdef94094110a768, true);
// this file is equivalent to difference.rkt
// this is the main file which uses the BigInt to avoid precision-based
// rounding errors
// note that there are still some rounding errors which occur in the division 
// at the precision specified; but this was a choice made to have a reasonable running 
// speed (at the precision necessary to produce the same results as the racket original,
// the division algorithm was unusably slow)
var CoreClasses_1 = require("./CoreClasses");
var DateTimeHelpers_1 = require("./DateTimeHelpers");
var DateHelpers_1 = require("./DateHelpers");
var HMSN_1 = require("./HMSN");
var BigInteger_1 = require("./BigInteger");
var Difference;
(function (Difference) {
    function datetime_months_between(dt1, dt2) {
        $rt_addContract(dt1, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(16,41)");
        $rt_addContract(dt2, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(16,58)");
        if (dt2.lt(dt1)) {
            return (-1) * datetime_months_between(dt2, dt1);
        }
        var d1 = dt1.date;
        var d2 = dt2.date;
        var ymd1 = DateHelpers_1.DateHelpers.date_to_ymd(d1);
        var ymd2 = DateHelpers_1.DateHelpers.date_to_ymd(d2);
        var y1 = ymd1.y;
        var y2 = ymd2.y;
        var m1 = $rt_check(ymd1.m, "number");
        var m2 = $rt_check(ymd2.m, "number");
        var dd1 = ymd1.d;
        var dd2 = ymd2.d;
        var diff = (y2 - y1) * 12 + (m2 - m1);
        var start_dom = ((dd1 > dd2) && (days_in_month(y2, m2) == dd2)) ? dd2 : dd1;
        var dt1a = DateTimeHelpers_1.DateTimeHelpers.date_and_time_to_dateTime(DateHelpers_1.DateHelpers.date(y1, m1, start_dom), DateTimeHelpers_1.DateTimeHelpers.dateTime_to_time(dt1));
        var ts1 = DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt1a).add((new CoreClasses_1.CoreClasses.ExactRational(-1, 1)).mul(DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(DateTimeHelpers_1.DateTimeHelpers.datetime(y1, m1))));
        var ts2 = DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt2).add((new CoreClasses_1.CoreClasses.ExactRational(-1, 1)).mul(DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(DateTimeHelpers_1.DateTimeHelpers.datetime(y2, m2))));
        if (ts2 < ts1) {
            diff -= 1;
        }
        return diff;
    }
    Difference.datetime_months_between = datetime_months_between;
    function dateTime_days_between(dt1, dt2) {
        $rt_addContract(dt1, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(50,39)");
        $rt_addContract(dt2, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(50,56)");
        return Math.floor(DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt2).ieEval() - DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt1).ieEval());
    }
    Difference.dateTime_days_between = dateTime_days_between;
    function dateTime_nanoseconds_between(dt1, dt2) {
        $rt_addContract(dt1, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(55,46)");
        $rt_addContract(dt2, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(55,63)");
        // here there was some rounding error
        // so use the BigInt class 
        var bi1 = new BigInteger_1.BigInteger.BigInt(dateTime_to_jdns(dt1));
        var bi2 = new BigInteger_1.BigInteger.BigInt(dateTime_to_jdns(dt2));
        var toRet = bi2.sub(bi1);
        return toRet.getValue();
    }
    Difference.dateTime_nanoseconds_between = dateTime_nanoseconds_between;
    function dateTime_to_jdns(dt) {
        $rt_addContract(dt, c185d0e943cabad3e294825d3b5c26f96c, "Difference.ts(65,34)");
        var c = new HMSN_1.HMSN.Consts();
        // also rounding errors were happening here
        var bNum = new BigInteger_1.BigInteger.BigInt(DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt).num);
        var bDenom = new BigInteger_1.BigInteger.BigInt(DateTimeHelpers_1.DateTimeHelpers.dateTime_to_jd(dt).denom);
        var intFrac = bNum.divide(bDenom);
        var end = intFrac.multiply(new BigInteger_1.BigInteger.BigInt(c.NS_DAY));
        return end.getValue();
    }
    Difference.dateTime_to_jdns = dateTime_to_jdns;
    function days_in_month(y, m) {
        $rt_check(y, "number");
        $rt_check(m, "number");
        // months with 31 days: jan=1, mar=3, may=5, jul=7, aug=8, oct=10, dec=12
        // months with 30 days: apr=4, jun=6, sep=9, nov=11
        // feb=2 depends on the year
        // if (year is not divisible by 4) then (it is a common year)
        // else if (year is not divisible by 100) then (it is a leap year)
        // else if (year is not divisible by 400) then (it is a common year)
        // else (it is a leap year)
        if (m < 1 || m > 12) {
            return -1; // error
        }
        if (m == 1 || m == 3 || m == 5 || m == 7 || m == 8 || m == 10 || m == 12) {
            return 31;
        }
        else if (m == 4 || m == 6 || m == 9 || m == 11) {
            return 30;
        }
        else if (m == 2 && y % 4 != 0) {
            return 28;
        }
        else if (m == 2 && y % 100 != 0) {
            return 29;
        }
        else if (m == 2 && y % 400 != 0) {
            return 28;
        }
        else {
            return 29;
        }
    }
    Difference.days_in_month = days_in_month;
})(Difference = exports.Difference || (exports.Difference = {}));
